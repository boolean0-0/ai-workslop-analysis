<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="norton-safeweb-site-verification" content="24usqpep0ejc5w6hod3dulxwciwp0djs6c6ufp96av3t4whuxovj72wfkdjxu82yacb7430qjm8adbd5ezlt4592dq4zrvadcn9j9n-0btgdzpiojfzno16-fnsnu7xd" />
        
        <link rel="preconnect" href="https://substackcdn.com" />
        

        
            <title data-rh="true">How Kafka Works - by Neo Kim and Stanislav Kozlovski</title>
            
            <meta data-rh="true" name="theme-color" content="#ffffff"/><meta data-rh="true" property="og:type" content="article"/><meta data-rh="true" property="og:title" content="How Kafka Works"/><meta data-rh="true" name="twitter:title" content="How Kafka Works"/><meta data-rh="true" name="description" content="Learn Everything About Apache Kafka’s Architecture, Including Brokers, Kraft, Topic Partitions, Tiered Storage, Exactly Once, Kafka Connect, Kafka Schema Registry and Kafka Streams"/><meta data-rh="true" property="og:description" content="#91: Learn Everything About Apache Kafka’s Architecture, Including Brokers, KRaft, Topic Partitions, Tiered Storage, Exactly Once, Kafka Connect, Kafka Schema Registry and Kafka Streams"/><meta data-rh="true" name="twitter:description" content="#91: Learn Everything About Apache Kafka’s Architecture, Including Brokers, KRaft, Topic Partitions, Tiered Storage, Exactly Once, Kafka Connect, Kafka Schema Registry and Kafka Streams"/><meta data-rh="true" property="og:image" content="https://substackcdn.com/image/fetch/$s_!QV8V!,w_1200,h_600,c_fill,f_jpg,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff3135c16-7ad0-4de4-a4d7-483c91e84c36_1280x720.png"/><meta data-rh="true" name="twitter:image" content="https://substackcdn.com/image/fetch/$s_!8Sk9!,f_auto,q_auto:best,fl_progressive:steep/https%3A%2F%2Fsystemdesignone.substack.com%2Fapi%2Fv1%2Fpost_preview%2F174189967%2Ftwitter.jpg%3Fversion%3D4"/><meta data-rh="true" name="twitter:card" content="summary_large_image"/><meta data-rh="true" property="interactionStatistic" content="[{&quot;@type&quot;:&quot;InteractionCounter&quot;,&quot;interactionType&quot;:&quot;https://schema.org/LikeAction&quot;,&quot;userInteractionCount&quot;:356},{&quot;@type&quot;:&quot;InteractionCounter&quot;,&quot;interactionType&quot;:&quot;https://schema.org/CommentAction&quot;,&quot;userInteractionCount&quot;:6}]"/>
            
            
        

        

        <style>
          @layer legacy, tailwind, pencraftReset, pencraft;
        </style>

        
        <link rel="preload" as="style" href="https://substackcdn.com/bundle/theme/main.05b92a85b37ccec1d021.css" />
        
        
        

        
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/static/css/main.64f5d860.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/static/css/9282.4480ab95.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/static/css/6576.b271d044.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/static/css/8268.a0c3f211.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/static/css/1620.c033ea38.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/static/css/4238.e2a51217.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/static/css/2888.93d50087.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/static/css/7758.5cbb9479.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/static/css/6930.dcc5dc64.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/static/css/5133.e4e843ae.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/static/css/833.4a942b03.css" />
            
        

        
        
        
        
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
        <meta name="author" content="Neo Kim" />
        <meta property="og:url" content="https://newsletter.systemdesign.one/p/how-kafka-works" />
        
        
        <link rel="canonical" href="https://newsletter.systemdesign.one/p/how-kafka-works" />
        

        

        

        
            
                <link rel="shortcut icon" href="https://substackcdn.com/image/fetch/$s_!HZBi!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Ffavicon.ico">
            
        
            
                <link rel="icon" type="image/png" sizes="16x16" href="https://substackcdn.com/image/fetch/$s_!Pkwj!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Ffavicon-16x16.png">
            
        
            
                <link rel="icon" type="image/png" sizes="32x32" href="https://substackcdn.com/image/fetch/$s_!8oHg!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Ffavicon-32x32.png">
            
        
            
                <link rel="icon" type="image/png" sizes="48x48" href="https://substackcdn.com/image/fetch/$s_!A0se!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Ffavicon-48x48.png">
            
        
            
                <link rel="apple-touch-icon" sizes="57x57" href="https://substackcdn.com/image/fetch/$s_!G-ot!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Fapple-touch-icon-57x57.png">
            
        
            
                <link rel="apple-touch-icon" sizes="60x60" href="https://substackcdn.com/image/fetch/$s_!SssC!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Fapple-touch-icon-60x60.png">
            
        
            
                <link rel="apple-touch-icon" sizes="72x72" href="https://substackcdn.com/image/fetch/$s_!U_TI!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Fapple-touch-icon-72x72.png">
            
        
            
                <link rel="apple-touch-icon" sizes="76x76" href="https://substackcdn.com/image/fetch/$s_!iRQ0!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Fapple-touch-icon-76x76.png">
            
        
            
                <link rel="apple-touch-icon" sizes="114x114" href="https://substackcdn.com/image/fetch/$s_!Uhde!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Fapple-touch-icon-114x114.png">
            
        
            
                <link rel="apple-touch-icon" sizes="120x120" href="https://substackcdn.com/image/fetch/$s_!qmFK!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Fapple-touch-icon-120x120.png">
            
        
            
                <link rel="apple-touch-icon" sizes="144x144" href="https://substackcdn.com/image/fetch/$s_!1syg!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Fapple-touch-icon-144x144.png">
            
        
            
                <link rel="apple-touch-icon" sizes="152x152" href="https://substackcdn.com/image/fetch/$s_!HYVT!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Fapple-touch-icon-152x152.png">
            
        
            
                <link rel="apple-touch-icon" sizes="167x167" href="https://substackcdn.com/image/fetch/$s_!HeMs!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Fapple-touch-icon-167x167.png">
            
        
            
                <link rel="apple-touch-icon" sizes="180x180" href="https://substackcdn.com/image/fetch/$s_!jyzj!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Fapple-touch-icon-180x180.png">
            
        
            
                <link rel="apple-touch-icon" sizes="1024x1024" href="https://substackcdn.com/image/fetch/$s_!vNhZ!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F1074cccf-d3e3-4f9c-a93d-ddc0e33904a4%2Fapple-touch-icon-1024x1024.png">
            
        
            
        
            
        
            
        

        

        
            <link rel="alternate" type="application/rss+xml" href="/feed" title="The System Design Newsletter"/>
        

        
        
          <style>
            
            @font-face{font-family:'Roboto Slab';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/robotoslab/v25/BngMUXZYTXPIvIBgJJSb6ufA5qWr4xCCQ_k.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Slab';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/robotoslab/v25/BngMUXZYTXPIvIBgJJSb6ufJ5qWr4xCCQ_k.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Slab';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/robotoslab/v25/BngMUXZYTXPIvIBgJJSb6ufB5qWr4xCCQ_k.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto Slab';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/robotoslab/v25/BngMUXZYTXPIvIBgJJSb6ufO5qWr4xCCQ_k.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Slab';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/robotoslab/v25/BngMUXZYTXPIvIBgJJSb6ufC5qWr4xCCQ_k.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Slab';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/robotoslab/v25/BngMUXZYTXPIvIBgJJSb6ufD5qWr4xCCQ_k.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Slab';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/robotoslab/v25/BngMUXZYTXPIvIBgJJSb6ufN5qWr4xCC.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Roboto Slab';font-style:normal;font-weight:700;font-display:fallback;src:url(https://fonts.gstatic.com/s/robotoslab/v25/BngMUXZYTXPIvIBgJJSb6ufA5qWr4xCCQ_k.woff2) format('woff2');unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:'Roboto Slab';font-style:normal;font-weight:700;font-display:fallback;src:url(https://fonts.gstatic.com/s/robotoslab/v25/BngMUXZYTXPIvIBgJJSb6ufJ5qWr4xCCQ_k.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Roboto Slab';font-style:normal;font-weight:700;font-display:fallback;src:url(https://fonts.gstatic.com/s/robotoslab/v25/BngMUXZYTXPIvIBgJJSb6ufB5qWr4xCCQ_k.woff2) format('woff2');unicode-range:U+1F00-1FFF}@font-face{font-family:'Roboto Slab';font-style:normal;font-weight:700;font-display:fallback;src:url(https://fonts.gstatic.com/s/robotoslab/v25/BngMUXZYTXPIvIBgJJSb6ufO5qWr4xCCQ_k.woff2) format('woff2');unicode-range:U+0370-03FF}@font-face{font-family:'Roboto Slab';font-style:normal;font-weight:700;font-display:fallback;src:url(https://fonts.gstatic.com/s/robotoslab/v25/BngMUXZYTXPIvIBgJJSb6ufC5qWr4xCCQ_k.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Roboto Slab';font-style:normal;font-weight:700;font-display:fallback;src:url(https://fonts.gstatic.com/s/robotoslab/v25/BngMUXZYTXPIvIBgJJSb6ufD5qWr4xCCQ_k.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Roboto Slab';font-style:normal;font-weight:700;font-display:fallback;src:url(https://fonts.gstatic.com/s/robotoslab/v25/BngMUXZYTXPIvIBgJJSb6ufN5qWr4xCC.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}
          </style>
        
        

        <style>:root{--color_theme_bg_pop:#538cfa;--background_pop:#538cfa;--color_theme_bg_web:#ffffff;--cover_bg_color:#ffffff;--background_pop_darken:#3a7bf9;--print_on_pop:#ffffff;--color_theme_bg_pop_darken:#3a7bf9;--color_theme_print_on_pop:#ffffff;--color_theme_bg_pop_20:rgba(83, 140, 250, 0.2);--color_theme_bg_pop_30:rgba(83, 140, 250, 0.3);--border_subtle:rgba(204, 204, 204, 0.5);--background_subtle:rgba(229, 238, 254, 0.4);--print_pop:#538cfa;--color_theme_accent:#538cfa;--cover_print_primary:#363737;--cover_print_secondary:#757575;--cover_print_tertiary:#b6b6b6;--cover_border_color:#538cfa;--font_family_headings_preset:'Roboto Slab',sans-serif;--font_weight_headings_preset:700;--font_family_body_preset:'SF Pro Display', -apple-system, system-ui, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol';--font_weight_body_preset:400;--font_preset_heading:slab;--font_preset_body:sans;--home_hero:newspaper;--home_posts:custom;--home_show_top_posts:true;--web_bg_color:#ffffff;--background_contrast_1:#f0f0f0;--color_theme_bg_contrast_1:#f0f0f0;--background_contrast_2:#dddddd;--color_theme_bg_contrast_2:#dddddd;--background_contrast_3:#b7b7b7;--color_theme_bg_contrast_3:#b7b7b7;--background_contrast_4:#929292;--color_theme_bg_contrast_4:#929292;--background_contrast_5:#515151;--color_theme_bg_contrast_5:#515151;--color_theme_bg_elevated:#ffffff;--color_theme_bg_elevated_secondary:#f0f0f0;--color_theme_detail:#e6e6e6;--background_contrast_pop:rgba(83, 140, 250, 0.4);--color_theme_bg_contrast_pop:rgba(83, 140, 250, 0.4);--input_background:#ffffff;--cover_input_background:#ffffff;--tooltip_background:#191919;--web_bg_color_h:0;--web_bg_color_s:0%;--web_bg_color_l:100%;--print_on_web_bg_color:#363737;--print_secondary_on_web_bg_color:#868787;--selected_comment_background_color:#fdf9f3;--background_pop_rgb:83, 140, 250;--background_pop_rgb_pc:83 140 250;--color_theme_bg_pop_rgb:83, 140, 250;--color_theme_bg_pop_rgb_pc:83 140 250;--color_theme_accent_rgb:83, 140, 250;--color_theme_accent_rgb_pc:83 140 250;}</style>

        
            <link rel="stylesheet" href="https://substackcdn.com/bundle/theme/main.05b92a85b37ccec1d021.css" />
        

        <style></style>

        

        

        

        
            <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-99PY3XXQY0&l=GA4DataLayer" >
            </script>
        
    </head>

    <body class="">
        

        
            <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TR7MRKF" height="0"
                              width="0" style="display:none;visibility:hidden"></iframe></noscript>
        

        

        

        

        

        <div id="entry">
            <div id="main" class="main typography use-theme-bg"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div data-testid="navbar" class="main-menu"><div class="mainMenuContent-DME8DR"><div style="position:relative;height:71px;" class="pencraft pc-display-flex pc-gap-12 pc-paddingLeft-20 pc-paddingRight-20 pc-justifyContent-space-between pc-alignItems-center pc-reset border-bottom-detail-k1F6C4 topBar-pIF0J1"><div style="flex-basis:0px;flex-grow:1;" class="logoContainer-p12gJb"><a href="/" native class="pencraft pc-display-contents pc-reset"><div draggable="false" class="pencraft pc-display-flex pc-position-relative pc-reset"><div style="width:40px;height:40px;" class="pencraft pc-display-flex pc-reset bg-white-ZBV5av pc-borderRadius-sm overflow-hidden-WdpwT6 sizing-border-box-DggLA4"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!1Tqi!,w_80,h_80,c_fill,f_webp,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc307af20-7930-4c70-9a4b-1e800617ef9e_256x256.png"/><img src="https://substackcdn.com/image/fetch/$s_!1Tqi!,w_80,h_80,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc307af20-7930-4c70-9a4b-1e800617ef9e_256x256.png" sizes="100vw" alt="The System Design Newsletter" width="80" height="80" style="width:40px;height:40px;" draggable="false" class="img-OACg1c object-fit-cover-u4ReeV pencraft pc-reset"/></picture></div></div></a></div><div style="flex-grow:0;" class="titleContainer-DJYq5v"><h1 class="pencraft pc-reset font-pub-headings-FE5byy reset-IxiVJZ title-oOnUGd"><a href="/" class="pencraft pc-display-contents pc-reset">The System Design Newsletter</a></h1></div><div style="flex-basis:0px;flex-grow:1;" class="pencraft pc-display-flex pc-justifyContent-flex-end pc-alignItems-center pc-reset"><div class="buttonsContainer-SJBuep"><div class="pencraft pc-display-flex pc-gap-8 pc-justifyContent-flex-end pc-alignItems-center pc-reset navbar-buttons"><div class="pencraft pc-display-flex pc-gap-4 pc-reset"><span><button tabindex="0" type="button" aria-label="Search" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_md-gCDS3o priority_tertiary-rlke8z"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg></button></span><button tabindex="0" type="button" aria-label="Share Publication" id="headlessui-menu-button-P0-4" aria-haspopup="menu" aria-expanded="false" data-headlessui-state class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_md-gCDS3o priority_tertiary-rlke8z"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-share"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" x2="12" y1="2" y2="15"></line></svg></button></div><button tabindex="0" type="button" data-testid="noncontributor-cta-button" class="pencraft pc-reset pencraft buttonBase-GK1x3M buttonText-X0uSmG buttonStyle-r7yGCK priority_primary-RfbeYt size_md-gCDS3o">Subscribe</button><button tabindex="0" type="button" native data-href="https://substack.com/sign-in?redirect=%2Fp%2Fhow-kafka-works&amp;for_pub=systemdesignone" class="pencraft pc-reset pencraft buttonBase-GK1x3M buttonText-X0uSmG buttonStyle-r7yGCK priority_tertiary-rlke8z size_md-gCDS3o">Sign in</button></div></div></div></div></div><div style="height:72px;"></div></div></div><div><script type="application/ld+json">{"@context":"https://schema.org","@type":"NewsArticle","url":"https://newsletter.systemdesign.one/p/how-kafka-works","mainEntityOfPage":"https://newsletter.systemdesign.one/p/how-kafka-works","headline":"How Kafka Works","description":"Learn Everything About Apache Kafka\u2019s Architecture, Including Brokers, Kraft, Topic Partitions, Tiered Storage, Exactly Once, Kafka Connect, Kafka Schema Registry and Kafka Streams","image":[{"@type":"ImageObject","url":"https://substack-post-media.s3.amazonaws.com/public/images/f3135c16-7ad0-4de4-a4d7-483c91e84c36_1280x720.png"}],"datePublished":"2025-09-25T11:03:00+00:00","dateModified":"2025-09-25T11:03:00+00:00","isAccessibleForFree":true,"author":[{"@type":"Person","name":"Neo Kim","url":"https://substack.com/@systemdesignone","description":"I Teach You System Design \u2022 400K+ Audience","identifier":"user:135589200","image":{"@type":"ImageObject","contentUrl":"https://substackcdn.com/image/fetch/$s_!OHOm!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc103940f-0d8b-47e7-9a33-013202e17bb8_389x389.jpeg","thumbnailUrl":"https://substackcdn.com/image/fetch/$s_!OHOm!,w_128,h_128,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc103940f-0d8b-47e7-9a33-013202e17bb8_389x389.jpeg"}},{"@type":"Person","name":"Stanislav Kozlovski","url":"https://substack.com/@stanislavkozlovski","description":"7yr experience with Kafka; committer; writes concisely about kafka and big data engineering","identifier":"user:1057029","image":{"@type":"ImageObject","contentUrl":"https://substackcdn.com/image/fetch/$s_!0lM5!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg","thumbnailUrl":"https://substackcdn.com/image/fetch/$s_!0lM5!,w_128,h_128,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg"}}],"publisher":{"@type":"Organization","name":"The System Design Newsletter","url":"https://newsletter.systemdesign.one","description":"Download my system design playbook on newsletter signup for FREE","interactionStatistic":{"@type":"InteractionCounter","name":"Subscribers","interactionType":"https://schema.org/SubscribeAction","userInteractionCount":100000},"identifier":"pub:1511845","logo":{"@type":"ImageObject","url":"https://substackcdn.com/image/fetch/$s_!1Tqi!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc307af20-7930-4c70-9a4b-1e800617ef9e_256x256.png","contentUrl":"https://substackcdn.com/image/fetch/$s_!1Tqi!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc307af20-7930-4c70-9a4b-1e800617ef9e_256x256.png","thumbnailUrl":"https://substackcdn.com/image/fetch/$s_!1Tqi!,w_128,h_128,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc307af20-7930-4c70-9a4b-1e800617ef9e_256x256.png"},"image":{"@type":"ImageObject","url":"https://substackcdn.com/image/fetch/$s_!1Tqi!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc307af20-7930-4c70-9a4b-1e800617ef9e_256x256.png","contentUrl":"https://substackcdn.com/image/fetch/$s_!1Tqi!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc307af20-7930-4c70-9a4b-1e800617ef9e_256x256.png","thumbnailUrl":"https://substackcdn.com/image/fetch/$s_!1Tqi!,w_128,h_128,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc307af20-7930-4c70-9a4b-1e800617ef9e_256x256.png"}}}</script><div aria-label="Post" role="main" class="single-post-container"><div class="container"><div class="single-post"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><article class="typography newsletter-post post"><div role="region" aria-label="Post header" class="post-header"><h1 dir="auto" class="post-title published title-X77sOw">How Kafka Works</h1><h3 dir="auto" class="subtitle subtitle-HEEcLo">#91: Learn Everything About Apache Kafka’s Architecture, Including Brokers, KRaft, Topic Partitions, Tiered Storage, Exactly Once, Kafka Connect, Kafka Schema Registry and Kafka Streams</h3><div aria-label="Post UFI" role="region" class="pencraft pc-display-flex pc-flexDirection-column pc-paddingBottom-16 pc-reset"><div class="pencraft pc-display-flex pc-flexDirection-column pc-paddingTop-16 pc-paddingBottom-16 pc-reset"><div class="pencraft pc-display-flex pc-gap-12 pc-alignItems-center pc-reset byline-wrapper"><div class="pencraft pc-display-flex pc-reset"><div class="pencraft pc-display-flex pc-flexDirection-row pc-gap-8 pc-alignItems-center pc-justifyContent-flex-start pc-reset"><div style="--scale:36px;--offset:9px;--border-width:4.5px;" class="pencraft pc-display-flex pc-flexDirection-row pc-alignItems-center pc-justifyContent-flex-start pc-reset ltr-qDBmby"><a href="https://substack.com/@systemdesignone" aria-label="View Neo Kim's profile" class="pencraft pc-display-contents pc-reset"><div style="--scale:36px;" tabindex="0" class="pencraft pc-display-flex pc-width-36 pc-height-36 pc-justifyContent-center pc-alignItems-center pc-position-relative pc-reset bg-secondary-UUD3_J flex-auto-j3S2WA animate-XFJxE4 outline-detail-vcQLyr pc-borderRadius-full overflow-hidden-WdpwT6 sizing-border-box-DggLA4 pressable-sm-YIJFKJ showFocus-sk_vEm container-TAtrWj interactive-UkK0V6 avatar-u8q6xB"><div style="--scale:36px;" title="Neo Kim" class="pencraft pc-display-flex pc-width-36 pc-height-36 pc-justifyContent-center pc-alignItems-center pc-position-relative pc-reset bg-secondary-UUD3_J flex-auto-j3S2WA outline-detail-vcQLyr pc-borderRadius-full overflow-hidden-WdpwT6 sizing-border-box-DggLA4 container-TAtrWj"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!OHOm!,w_36,h_36,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc103940f-0d8b-47e7-9a33-013202e17bb8_389x389.jpeg 36w, https://substackcdn.com/image/fetch/$s_!OHOm!,w_72,h_72,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc103940f-0d8b-47e7-9a33-013202e17bb8_389x389.jpeg 72w, https://substackcdn.com/image/fetch/$s_!OHOm!,w_108,h_108,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc103940f-0d8b-47e7-9a33-013202e17bb8_389x389.jpeg 108w" sizes="36px"/><img src="https://substackcdn.com/image/fetch/$s_!OHOm!,w_36,h_36,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc103940f-0d8b-47e7-9a33-013202e17bb8_389x389.jpeg" sizes="36px" alt="Neo Kim's avatar" srcset="https://substackcdn.com/image/fetch/$s_!OHOm!,w_36,h_36,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc103940f-0d8b-47e7-9a33-013202e17bb8_389x389.jpeg 36w, https://substackcdn.com/image/fetch/$s_!OHOm!,w_72,h_72,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc103940f-0d8b-47e7-9a33-013202e17bb8_389x389.jpeg 72w, https://substackcdn.com/image/fetch/$s_!OHOm!,w_108,h_108,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc103940f-0d8b-47e7-9a33-013202e17bb8_389x389.jpeg 108w" width="36" height="36" draggable="false" class="img-OACg1c object-fit-cover-u4ReeV pencraft pc-reset"/></picture></div></div></a><a href="https://substack.com/@stanislavkozlovski" aria-label="View Stanislav Kozlovski's profile" class="pencraft pc-display-contents pc-reset"><div style="--scale:36px;" tabindex="0" class="pencraft pc-display-flex pc-width-36 pc-height-36 pc-justifyContent-center pc-alignItems-center pc-position-relative pc-reset bg-secondary-UUD3_J flex-auto-j3S2WA animate-XFJxE4 outline-detail-vcQLyr pc-borderRadius-full overflow-hidden-WdpwT6 sizing-border-box-DggLA4 pressable-sm-YIJFKJ showFocus-sk_vEm container-TAtrWj interactive-UkK0V6 avatar-u8q6xB overlap-q75iOo last-JfNEJ_"><div style="--scale:36px;" title="Stanislav Kozlovski" class="pencraft pc-display-flex pc-width-36 pc-height-36 pc-justifyContent-center pc-alignItems-center pc-position-relative pc-reset bg-secondary-UUD3_J flex-auto-j3S2WA outline-detail-vcQLyr pc-borderRadius-full overflow-hidden-WdpwT6 sizing-border-box-DggLA4 container-TAtrWj"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!0lM5!,w_36,h_36,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg 36w, https://substackcdn.com/image/fetch/$s_!0lM5!,w_72,h_72,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg 72w, https://substackcdn.com/image/fetch/$s_!0lM5!,w_108,h_108,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg 108w" sizes="36px"/><img src="https://substackcdn.com/image/fetch/$s_!0lM5!,w_36,h_36,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg" sizes="36px" alt="Stanislav Kozlovski's avatar" srcset="https://substackcdn.com/image/fetch/$s_!0lM5!,w_36,h_36,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg 36w, https://substackcdn.com/image/fetch/$s_!0lM5!,w_72,h_72,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg 72w, https://substackcdn.com/image/fetch/$s_!0lM5!,w_108,h_108,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg 108w" width="36" height="36" draggable="false" class="img-OACg1c object-fit-cover-u4ReeV pencraft pc-reset"/></picture></div></div></a></div></div></div><div class="pencraft pc-display-flex pc-flexDirection-column pc-reset"><div class="pencraft pc-reset color-pub-primary-text-NyXPlw line-height-20-t4M0El font-meta-MWBumP size-11-NuY2Zx weight-medium-fw81nC transform-uppercase-yKDgcq reset-IxiVJZ meta-EgzBVA"><div class="profile-hover-card-target profileHoverCardTarget-PBxvGm"><a href="https://substack.com/@systemdesignone" class="pencraft pc-reset decoration-hover-underline-ClDVRM reset-IxiVJZ">Neo Kim</a></div> and <div class="profile-hover-card-target profileHoverCardTarget-PBxvGm"><a href="https://substack.com/@stanislavkozlovski" class="pencraft pc-reset decoration-hover-underline-ClDVRM reset-IxiVJZ">Stanislav Kozlovski</a></div></div><div class="pencraft pc-display-flex pc-gap-4 pc-reset"><div class="pencraft pc-reset color-pub-secondary-text-hGQ02T line-height-20-t4M0El font-meta-MWBumP size-11-NuY2Zx weight-medium-fw81nC transform-uppercase-yKDgcq reset-IxiVJZ meta-EgzBVA">Sep 25, 2025</div></div></div></div></div><div class="pencraft pc-display-flex pc-gap-16 pc-paddingTop-16 pc-paddingBottom-16 pc-justifyContent-space-between pc-alignItems-center pc-reset flex-grow-rzmknG border-top-detail-themed-k9TZAY border-bottom-detail-themed-Ua9186 post-ufi"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="like-button-container post-ufi-button style-button"><a role="button" aria-label="Like (356)" aria-pressed="false" class="post-ufi-button style-button has-label with-border"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 24 24" fill="#000000" stroke-width="2" stroke="#000" xmlns="http://www.w3.org/2000/svg" class="icon"><g><title></title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></svg></g></svg><div class="label">356</div></a></div><a role="button" href="https://newsletter.systemdesign.one/p/how-kafka-works/comments" aria-label="View comments (6)" class="post-ufi-button style-button post-ufi-comment-button has-label with-border"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 24 24" fill="#000000" stroke-width="2" stroke="#000" xmlns="http://www.w3.org/2000/svg" class="icon"><g><title></title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path></svg></g></svg><div class="label">6</div></a><a role="button" class="post-ufi-button style-button has-label with-border"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="#000" xmlns="http://www.w3.org/2000/svg" class="icon"><g><title></title><path d="M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12" stroke-linecap="round" stroke-linejoin="round"></path></g></svg><div class="label">57</div></a></div><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><a role="button" href="javascript:void(0)" class="post-ufi-button style-button no-icon has-label with-border"><div class="label">Share</div></a></div></div></div></div><div class="visibility-check"></div><div><div class="available-content"><div dir="auto" class="body markup"><p>Get my system design playbook for FREE on newsletter signup:</p><div data-component-name="SubscribeWidget" class="subscribe-widget"><div class="pencraft pc-display-flex pc-justifyContent-center pc-reset"><div class="container-IpPqBD"><form action="/api/v1/free?nojs=true" method="post" novalidate class="form form-M5sC90"><input type="hidden" name="first_url" value/><input type="hidden" name="first_referrer" value/><input type="hidden" name="current_url"/><input type="hidden" name="current_referrer"/><input type="hidden" name="first_session_url" value/><input type="hidden" name="first_session_referrer" value/><input type="hidden" name="referral_code"/><input type="hidden" name="source" value="subscribe-widget"/><input type="hidden" name="referring_pub_id"/><input type="hidden" name="additional_referring_pub_ids"/><div class="sideBySideWrap-vGXrwP"><div class="emailInputWrapper-QlA86j"><div class="pencraft pc-display-flex pc-minWidth-0 pc-position-relative pc-reset flex-auto-j3S2WA"><input name="email" placeholder="Type your email..." type="email" class="pencraft emailInput-OkIMeB input-y4v6N4 inputText-pV_yWb"/></div></div><button tabindex="0" type="submit" disabled class="pencraft pc-reset pencraft rightButton primary subscribe-btn button-VFSdkv buttonBase-GK1x3M"><span class="button-text ">Subscribe</span></button></div><div id="error-container"></div></form></div></div></div><div><hr/></div><p><em>This post outlines the Kafka architecture.</em></p><ul><li><p><em><a href="https://newsletter.systemdesign.one/p/how-kafka-works/?action=share" rel>Share this post</a><span> &amp; I'll send you some rewards for the referrals.</span></em></p></li></ul><p>Open any article about Kafka today, and you will see the same words being used to describe it:</p><blockquote><p><em>“It’s an open-source, distributed, durable, very scalable, fault-tolerant pub/sub message system with rich integration and stream processing capabilities.”</em></p></blockquote><p><span>While it’s true, it isn’t helpful for a novice reader being introduced to Kafka for the first time. Today, we will explain Kafka by </span><strong>precisely breaking down</strong><span> what every word in that definition means. Every definition will start with the 💡 symbol. At the end, you will have a complete high-level understanding of Apache Kafka.</span></p><div><hr/></div><p><span>I want to introduce </span><a href="http://linkedin.com/in/stanislavkozlovski" rel>Stanislav Kozlovski</a><span> (“The Kafka Guy”) as a guest author.</span></p><div class="captioned-image-container"><figure><a target="_blank" href="http://linkedin.com/in/stanislavkozlovski" data-component-name="Image2ToDOM" rel class="image-link image2"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!1YEl!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 424w, https://substackcdn.com/image/fetch/$s_!1YEl!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 848w, https://substackcdn.com/image/fetch/$s_!1YEl!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 1272w, https://substackcdn.com/image/fetch/$s_!1YEl!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!1YEl!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png" width="1200" height="630" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:630,&quot;width&quot;:1200,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:263255,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:&quot;http://linkedin.com/in/stanislavkozlovski&quot;,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!1YEl!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 424w, https://substackcdn.com/image/fetch/$s_!1YEl!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 848w, https://substackcdn.com/image/fetch/$s_!1YEl!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 1272w, https://substackcdn.com/image/fetch/$s_!1YEl!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div></div></div></a></figure></div><p>He’s an Apache Kafka committer and software engineer who worked at Confluent (the Kafka company) during its hypergrowth period. </p><p>Check out his newsletter and social media:</p><ul><li><p><a href="https://blog.2minutestreaming.com/" rel>2 Minute Streaming</a><span> (Flagship newsletter)</span></p></li><li><p><a href="https://bigdata.2minutestreaming.com/" rel>Big Data Stream</a></p></li><li><p><a href="http://linkedin.com/in/stanislavkozlovski" rel>LinkedIn</a></p></li><li><p><a href="https://x.com/BdKozlovski" rel>Twitter</a></p></li></ul><p>Currently, he has taken a break from engineering to consult companies and write extensively about Apache Kafka and data engineering.</p><div><hr/></div><h4 class="header-anchor-post">Apache Kafka<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§apache-kafka" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/apache-kafka" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h4><p><span>Apache Kafka is one of the most popular open-source projects in the data infrastructure space. It is a standard tool in every data engineer’s catalog, used by over 70% of Fortune 500 companies and 150,000 organizations.</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-1-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-1-174189967" target="_self" rel class="footnote-anchor">1</a></span></p><p><span>Kafka is a messaging system that was originally developed by LinkedIn in 2010. In 2011, it was open-sourced and donated to the Apache Foundation.</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-2-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-2-174189967" target="_self" rel class="footnote-anchor">2</a></span></p><blockquote><p><strong>💡 </strong><em><strong>open-source (1/8)</strong></em></p></blockquote><p>Today, Confluent is a public company and widely known as the company behind Kafka. It has expanded its business to offer a more complete data streaming platform on top of Kafka.</p><p><span>Nowadays, Kafka is more than a simple messaging system: it’s a larger ecosystem of components that form a</span><em><strong> </strong></em><strong>streaming platform</strong><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-3-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-3-174189967" target="_self" rel class="footnote-anchor">3</a></span><span>. It is frequently called the swiss army knife of data infrastructure.</span></p><p>Onward.</p><div><hr/></div><h3 class="header-anchor-post"><strong><a href="https://coderabbit.link/neo" rel>CodeRabbit: Free AI Code Reviews in CLI (Sponsor)</a></strong><div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§coderabbit-free-ai-code-reviews-in-cli-sponsor" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/coderabbit-free-ai-code-reviews-in-cli-sponsor" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><div class="captioned-image-container"><figure><a target="_blank" href="https://coderabbit.link/neo" data-component-name="Image2ToDOM" rel class="image-link image2"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!5LSQ!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 424w, https://substackcdn.com/image/fetch/$s_!5LSQ!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 848w, https://substackcdn.com/image/fetch/$s_!5LSQ!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 1272w, https://substackcdn.com/image/fetch/$s_!5LSQ!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!5LSQ!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png" width="1456" height="880" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:880,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:118178,&quot;alt&quot;:&quot;CodeRabbit CLI&quot;,&quot;title&quot;:&quot;CodeRabbit CLI&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:&quot;https://coderabbit.link/neo&quot;,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/173381826?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt="CodeRabbit CLI" title="CodeRabbit CLI" srcset="https://substackcdn.com/image/fetch/$s_!5LSQ!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 424w, https://substackcdn.com/image/fetch/$s_!5LSQ!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 848w, https://substackcdn.com/image/fetch/$s_!5LSQ!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 1272w, https://substackcdn.com/image/fetch/$s_!5LSQ!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div></div></div></a></figure></div><p><strong><a href="https://coderabbit.link/neo" rel>CodeRabbit CLI</a></strong><span> is an AI code review tool that runs directly in your terminal. It provides intelligent code analysis, catches issues early, and integrates seamlessly with AI coding agents like Claude Code, Codex CLI, Cursor CLI, and Gemini to ensure your code is production-ready before it ships.</span></p><ul><li><p>Enables pre-commit reviews of both staged and unstaged changes, creating a multi-layered review process.</p></li><li><p>Fits into existing Git workflows. Review uncommitted changes, staged files, specific commits, or entire branches without disrupting your current development process.</p></li><li><p>Reviews specific files, directories, uncommitted changes, staged changes, or entire commits based on your needs.</p></li><li><p>Supports programming languages including JavaScript, TypeScript, Python, Java, C#, C++, Ruby, Rust, Go, PHP, and more.</p></li><li><p>Offers free AI code reviews with rate limits so developers can experience senior-level reviews at no cost.</p></li><li><p>Flags hallucinations, code smells, security issues, and performance problems.</p></li><li><p>Supports guidelines for other AI generators, AST Grep rules, and path-based instructions.</p></li></ul><p data-attrs="{&quot;url&quot;:&quot;https://coderabbit.link/neo&quot;,&quot;text&quot;:&quot;Install CodeRabbit CLI&quot;,&quot;action&quot;:null,&quot;class&quot;:&quot;button-wrapper&quot;}" data-component-name="ButtonCreateButton" class="button-wrapper"><a href="https://coderabbit.link/neo" rel class="button primary button-wrapper"><span>Install CodeRabbit CLI</span></a></p><div><hr/></div><h4 class="header-anchor-post">Kafka’s Story<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§kafkas-story" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/kafkas-story" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h4><p>Why did Kafka become so widely used?</p><p><span>It solved a very important problem - the problem of data integration at scale. LinkedIn had to connect different services to one another. A naive way of achieving this would be to create many custom point-to-point integrations (called </span><strong>data pipelines</strong><span>) between each service. That would have resulted in an </span><strong>O (N^2)</strong><span> mess that would break often and be impossible to maintain when N is in the hundreds</span><strong>.</strong></p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!-az8!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!-az8!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 424w, https://substackcdn.com/image/fetch/$s_!-az8!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 848w, https://substackcdn.com/image/fetch/$s_!-az8!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 1272w, https://substackcdn.com/image/fetch/$s_!-az8!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!-az8!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png" width="1456" height="546" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:546,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:337882,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!-az8!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 424w, https://substackcdn.com/image/fetch/$s_!-az8!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 848w, https://substackcdn.com/image/fetch/$s_!-az8!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 1272w, https://substackcdn.com/image/fetch/$s_!-az8!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><p>Apache Kafka flips this problem on its head. Instead of creating custom pipelines per connection, it encourages organizations to:</p><ol><li><p>Store their data in a central location (Kafka)</p></li><li><p>Use a single standard API (the Kafka API)</p></li><li><p>Have applications subscribe and consume this data in real time</p></li></ol><p>This decouples writers from readers, as writers simply publish to Kafka, and readers subscribe to Kafka.</p><p>The data gets durably persisted to disk for a limited amount of time (e.g., 7 days). Kafka is ideal and was built with read-fanout use cases in mind, where the same message needs to get read by multiple systems. As such, it’s common for the system’s read throughput to be a multiple of its write throughput.</p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!xlWg!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!xlWg!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!xlWg!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!xlWg!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!xlWg!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!xlWg!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png" width="1456" height="801" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:801,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:142750,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!xlWg!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!xlWg!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!xlWg!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!xlWg!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><blockquote><p><span>💡 </span><em><strong>pub-sub messaging system (2/8)</strong></em><span> - this is what a pub/sub messaging system is</span></p></blockquote><p>With Kafka, organizations don’t need to maintain dozens of fragile custom point-to-point pipelines that break whenever a single VM restarts. The data can be written to Kafka once and read as many times as necessary by whatever system needs it.</p><blockquote><p>In this article, we won’t talk further about the use cases of Kafka. If you’re more interested in the reason behind Kafka, I recently covered in-depth why LinkedIn created Kafka. It made the front page of Hacker News.</p></blockquote><blockquote><p><span>✅ Check it out </span><a href="https://bigdatastream.substack.com/p/why-was-apache-kafka-created" rel>here</a><span>.</span></p></blockquote><div><hr/></div><h2 class="header-anchor-post">The Basic Kafka Concepts<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§the-basic-kafka-concepts" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/the-basic-kafka-concepts" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><p>Okay, let’s dive into Kafka now! To truly understand the system, we need to start from the basics.</p><p>Let’s examine its core data structure:</p><h3 class="header-anchor-post">The Log Data Structure<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§the-log-data-structure" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/the-log-data-structure" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p><span>Kafka is built upon the </span><a href="https://topicpartition.io/definitions/the-log" rel>simple log data structure</a><span>.</span></p><p>It is append-only; you can only add records to the end of the log (no deletes or updates allowed). Reads go from left to right, in the order the records were added.</p><p><span>Each record in the log has a unique monotonically increasing number called an </span><strong>offset</strong><span>. The offset refers to the record and denotes its order.</span></p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!nCew!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!nCew!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!nCew!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!nCew!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!nCew!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!nCew!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png" width="1456" height="819" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:819,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:273365,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!nCew!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!nCew!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!nCew!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!nCew!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><p>The API of the log data structure is very simple:</p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!UMlg!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!UMlg!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 424w, https://substackcdn.com/image/fetch/$s_!UMlg!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 848w, https://substackcdn.com/image/fetch/$s_!UMlg!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 1272w, https://substackcdn.com/image/fetch/$s_!UMlg!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!UMlg!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png" width="1456" height="717" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:717,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:467748,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!UMlg!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 424w, https://substackcdn.com/image/fetch/$s_!UMlg!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 848w, https://substackcdn.com/image/fetch/$s_!UMlg!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 1272w, https://substackcdn.com/image/fetch/$s_!UMlg!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><p><span>Kafka keeps the log structure on disk. The log’s sequential operations work very well with HDDs. Hard drives offer very high throughput for sequential</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-4-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-4-174189967" target="_self" rel class="footnote-anchor">4</a></span><span> reads and writes. This differs from random reads and writes, where HDDs don’t perform well.</span></p><h4 class="header-anchor-post">Records<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§records" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/records" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h4><ul><li><p><em><strong>{record, message, event}</strong></em><span>: an entry in the log. I use these words interchangeably when describing data in Kafka.</span></p></li></ul><p><span>Each message is essentially a key-value pair; it consists of a `</span><code>byte[] key</code><span>` and a `</span><code>byte[] value</code><span>` (although other metadata like offset, timestamp, and custom headers exist too). The key is optional; it is valid for a message to only have a value.</span></p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!yFwB!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!yFwB!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 424w, https://substackcdn.com/image/fetch/$s_!yFwB!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 848w, https://substackcdn.com/image/fetch/$s_!yFwB!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 1272w, https://substackcdn.com/image/fetch/$s_!yFwB!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!yFwB!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png" width="1456" height="653" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/b21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:653,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:454476,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!yFwB!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 424w, https://substackcdn.com/image/fetch/$s_!yFwB!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 848w, https://substackcdn.com/image/fetch/$s_!yFwB!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 1272w, https://substackcdn.com/image/fetch/$s_!yFwB!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><p><span>The key thing to remember is that the key/value pairs are </span><strong>raw bytes</strong><span>.</span></p><p>Kafka does not inherently support types (e.g., int64, string, etc.) nor schemas (specific message structures).</p><p>It is the client-side code’s responsibility to apply schemas:</p><ul><li><p><strong>When writing</strong><span>: producer clients convert (serialize) the objects into bytes.</span></p></li><li><p><strong>When reading</strong><span>: consumer clients parse (deserialize) the raw bytes from the network into the object.</span></p></li></ul><h3 class="header-anchor-post">Topics &amp; Partitions<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§topics-and-partitions" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/topics-and-partitions" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><h4 class="header-anchor-post">Topics<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§topics" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/topics" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h4><p>One log is not enough. You want to separate your data into categories. Just as in a database, you would create separate tables for user accounts and customer orders; in Kafka, you would create separate topics.</p><p>It’s common for a Kafka cluster to have hundreds to thousands of topics.</p><h4 class="header-anchor-post">Partitions<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§partitions" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/partitions" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h4><p><span>Kafka is a distributed system designed to scale much further than what a single machine can handle. As such, it uses </span><strong>sharding</strong><span>.</span></p><p>A topic is sharded into one or more partitions.</p><p>Each partition is a separate instance of the log data structure.</p><p>While a topic can have just one partition, it’s very common for it to have dozens, since this helps with parallelization of reads (more on that later).</p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!kVL_!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!kVL_!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!kVL_!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!kVL_!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!kVL_!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!kVL_!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png" width="1456" height="801" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/97951e01-e10d-479c-9022-840a40706cb2_1600x880.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:801,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:223569,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!kVL_!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!kVL_!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!kVL_!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!kVL_!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><h3 class="header-anchor-post">Clients &amp; The API<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§clients-and-the-api" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/clients-and-the-api" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p>Kafka doesn’t use HTTP. It uses its own TCP-based protocol. This means that you need more custom code to send and receive requests; you can’t just use any HTTP library.</p><p><span>Kafka provides its own libraries that implement the underlying protocol. The main clients you’d care about are the </span><strong>Producer</strong><span> and the </span><strong>Consumer</strong><span>.</span></p><ul><li><p>Producer: the class that’s used for writing data to Kafka</p></li><li><p>Consumer: the class that’s used for reading data from Kafka</p></li></ul><p>The Apache Kafka project offers a Java library that implements these:</p><pre><code>import org.apache.kafka.clients.producer.KafkaProducer;

import org.apache.kafka.clients.consumer.KafkaConsumer;</code></pre><p><span>The Producer class allows you to </span><strong>send messages</strong><span> to a topic. You can explicitly choose the partition or allow Kafka to do it automatically for you.</span></p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!CeRS!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png" data-component-name="Image2ToDOM" rel class="image-link image2"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!CeRS!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 424w, https://substackcdn.com/image/fetch/$s_!CeRS!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 848w, https://substackcdn.com/image/fetch/$s_!CeRS!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 1272w, https://substackcdn.com/image/fetch/$s_!CeRS!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!CeRS!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png" width="1456" height="340" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/f802585f-fda1-4fec-8142-3331044acf43_1999x467.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:340,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:308542,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!CeRS!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 424w, https://substackcdn.com/image/fetch/$s_!CeRS!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 848w, https://substackcdn.com/image/fetch/$s_!CeRS!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 1272w, https://substackcdn.com/image/fetch/$s_!CeRS!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div></div></div></a></figure></div><p><span>The Consumer, on the other hand, lets you </span><strong>subscribe</strong><span> to and</span><strong> read</strong><span> the stream of messages coming in from a topic (or specific partition):</span></p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!JGid!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!JGid!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 424w, https://substackcdn.com/image/fetch/$s_!JGid!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 848w, https://substackcdn.com/image/fetch/$s_!JGid!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 1272w, https://substackcdn.com/image/fetch/$s_!JGid!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!JGid!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png" width="1456" height="690" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/bb82d66a-0863-48f2-8327-234def847299_1999x948.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:690,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:553405,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!JGid!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 424w, https://substackcdn.com/image/fetch/$s_!JGid!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 848w, https://substackcdn.com/image/fetch/$s_!JGid!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 1272w, https://substackcdn.com/image/fetch/$s_!JGid!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><p>This is simply the most important API I can show you concisely; a lot more exist. Kafka may seem simple, but it has many details to learn to be effective with it.</p><div><hr/></div><h2 class="header-anchor-post">Kafka as a Distributed System<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§kafka-as-a-distributed-system" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/kafka-as-a-distributed-system" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><h3 class="header-anchor-post">Brokers<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§brokers" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/brokers" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p><span>Apache Kafka is designed to be a </span><em><strong>distributed</strong></em><span> system - one meant to scale horizontally by adding more nodes. As such, any normal deployment of Kafka consists of at least </span><em><strong>three nodes</strong></em><span>.</span></p><ul><li><p><em><strong>Broker</strong></em><span>: an instance of the Kafka server. This is what we call a node in the system.</span></p></li><li><p><em><strong>Cluster</strong></em><span>: all the brokers in the system.</span></p></li></ul><blockquote><p><span>💡 </span><em><strong>distributed (3/8)</strong></em></p></blockquote><h3 class="header-anchor-post">Scalability<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§scalability" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/scalability" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p>Kafka has a ton of interesting performance optimizations (more on this in another article). Its greatest strength is its horizontal scalability.</p><blockquote><p><span>💡 </span><em><strong>scalable (4/8)</strong></em></p></blockquote><p><span>The </span><a href="https://topicpartition.io/definitions/the-log" rel>Log data structure</a><span> is key to Kafka’s scalability - writes on it are O(1) and lock-free. This is because records are simply </span><strong>appended to the end</strong><span> and cannot be updated, nor individually deleted.</span></p><p>Messages within a partition are independent of each other. They have no higher-level guarantees like unique keys. This reduces the need for locking and allows Kafka to append to the Log structure as fast as the disk will allow.</p><p>Because each partition is a separate log, and you can add more brokers to the cluster, your scale is limited by how many brokers you can add.</p><p><span>Nothing theoretically stops you from having a Kafka cluster that accepts </span><strong>50 GiB/s of writes </strong><span>and then scaling it 2x to </span><strong>100 GiB/s</strong><span>.</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-5-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-5-174189967" target="_self" rel class="footnote-anchor">5</a></span></p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!2T4U!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!2T4U!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 424w, https://substackcdn.com/image/fetch/$s_!2T4U!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 848w, https://substackcdn.com/image/fetch/$s_!2T4U!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 1272w, https://substackcdn.com/image/fetch/$s_!2T4U!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!2T4U!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png" width="1456" height="819" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:819,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:432754,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!2T4U!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 424w, https://substackcdn.com/image/fetch/$s_!2T4U!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 848w, https://substackcdn.com/image/fetch/$s_!2T4U!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 1272w, https://substackcdn.com/image/fetch/$s_!2T4U!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><h3 class="header-anchor-post">Replication<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§replication" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/replication" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p>A partition in Kafka doesn’t live only on one broker - it is replicated across many.</p><p><span>A configurable setting (called </span><strong>replication factor</strong><span>) denotes how many copies should exist. The default and most common is </span><strong>three</strong><span>.</span></p><p><span>In other words, we have three copies (called </span><strong>replicas</strong><span>) of the Log data structure. These replicas live on the disks of different brokers.</span></p><p><span>Replication is done for many reasons, one of which is data durability</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-6-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-6-174189967" target="_self" rel class="footnote-anchor">6</a></span><span>: when three copies of the data exist, one disk failing won’t lead to data loss.</span></p><p><span>In modern cloud deployments, brokers are spread across different </span><a href="https://blog.2minutestreaming.com/p/basic-aws-networking-costs#:~:text=AZ%20(Availability%20Zone)%20%2D%20a%20physically%20isolated%20location%20with%20one%20or%20more%20data%20centers%2C%20inside%20a%20region" rel>availability zones</a><span>. This ensures very high durability and availability. Even in the unlikely event of a whole data center burning down, the Kafka cluster would still survive.</span></p><blockquote><p><span>💡 </span><em><strong>durable (5/8)</strong></em></p></blockquote><h3 class="header-anchor-post">Leaders<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§leaders" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/leaders" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p>Once you start maintaining copies of data in a distributed system, you open yourself to a lot of edge cases. Keeping new data in sync is tricky. The copies must match, and the system needs to somehow agree on the latest state.</p><blockquote><p><span>There is a whole class of complex algorithms in computer science called </span><a href="https://sre.google/sre-book/managing-critical-state/" rel>distributed consensus</a><span>, which handle this.</span></p></blockquote><p>Kafka uses a straightforward single-leader replication model. At any time, one replica serves as the leader. The other two replicas act as followers (i.e., hot standbys).</p><p>Only the leader accepts new writes - it serves as the source of truth of the log. The followers actively replicate data from the leader. Reads can be served from both the leader and its followers.</p><p>When a broker node goes offline, the system notices it. Other brokers then take over the leadership of the partitions the dead broker led. This is how Kafka offers high availability.</p><blockquote><p><span>💡 </span><em><strong>fault-tolerant (6/8)</strong></em></p></blockquote><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!v4hU!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!v4hU!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!v4hU!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!v4hU!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!v4hU!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!v4hU!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png" width="1456" height="801" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:801,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:203694,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!v4hU!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!v4hU!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!v4hU!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!v4hU!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">A topic with 4 partitions and a replication factor of 3, with different brokers leading different replicas of the partitions. Brokers with follower replicas send fetch requests to the brokers with leader replicas to replicate the data</figcaption></figure></div><h3 class="header-anchor-post">The Metadata Log<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§the-metadata-log" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/the-metadata-log" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p>In a distributed system, all nodes must agree on the latest state of the cluster. Brokers must coordinate on certain metadata changes, like electing a new leader. This is again a distributed consensus problem. Because it’s too complex for the purposes of introducing Kafka, we will simply gloss over how Kafka solves it.</p><p><span>Kafka uses a </span><strong>centralized coordination model</strong><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-7-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-7-174189967" target="_self" rel class="footnote-anchor">7</a></span><span>. The central coordinator is none other than… </span><strong>a log</strong><span>.</span></p><p><span>Kafka durably stores all metadata changes in a special </span><em><strong>single-partition</strong></em><span> topic called </span><code>__cluster_metadata</code><span>. This storage model inherits all the benefits from topics. It gets fault-tolerance, durability, and most importantly for metadata, </span><strong>ordering</strong><span>.</span></p><p><span>Each record in the log represents a </span><strong>single cluster event</strong><span> (a delta). When replayed fully in the same order, a node can deterministically rebuild the same cluster end state.</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-8-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-8-174189967" target="_self" rel class="footnote-anchor">8</a></span><br/><br/><span>Here is a visual example of how it works in Kafka:</span></p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!YlTG!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!YlTG!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 424w, https://substackcdn.com/image/fetch/$s_!YlTG!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 848w, https://substackcdn.com/image/fetch/$s_!YlTG!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 1272w, https://substackcdn.com/image/fetch/$s_!YlTG!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!YlTG!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png" width="1456" height="1001" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:212789,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!YlTG!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 424w, https://substackcdn.com/image/fetch/$s_!YlTG!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 848w, https://substackcdn.com/image/fetch/$s_!YlTG!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 1272w, https://substackcdn.com/image/fetch/$s_!YlTG!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">A representation of how cluster events represent changes in the cluster state, and how applying one after the other results in the same end-state</figcaption></figure></div><p>In other words, the cluster metadata topic partition is the source of truth for the latest metadata in Kafka.</p><p>Every broker in the cluster is subscribed to this topic. In real time, each broker pulls the latest committed updates. When a new record is fetched, the broker applies it to its in-memory metadata. This builds the broker’s idea of the latest state of the cluster.</p><p>If every broker is a follower of the partition, a natural question arises - who is the leader? What node gets to decide what new metadata is written to this partition?</p><h3 class="header-anchor-post">Controllers<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§controllers" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/controllers" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p>Controllers serve as the control plane for a Kafka cluster. They’re special kinds of brokers that don’t host regular topics - they only do specific cluster-management operations. Usually, you’d deploy three controller brokers.</p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!2FVQ!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!2FVQ!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 424w, https://substackcdn.com/image/fetch/$s_!2FVQ!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 848w, https://substackcdn.com/image/fetch/$s_!2FVQ!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 1272w, https://substackcdn.com/image/fetch/$s_!2FVQ!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!2FVQ!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png" width="1456" height="1001" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/b25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:856249,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!2FVQ!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 424w, https://substackcdn.com/image/fetch/$s_!2FVQ!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 848w, https://substackcdn.com/image/fetch/$s_!2FVQ!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 1272w, https://substackcdn.com/image/fetch/$s_!2FVQ!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">Every broker reads the __cluster_metadata log and replays the event logs to recreate the latest cluster state, regardless of whether it’s a controller broker or a regular broker.</figcaption></figure></div><p>At any one time, there is only one active controller - the leader of the log. Only the active controller can write to the log. The other controllers serve as hot standbys (followers).</p><p>The active controller is responsible for making all metadata decisions in the cluster, like electing new partition leaders (when a broker dies), creating new topics, changing configs at runtime, etc.</p><p><span>Most importantly, it’s responsible for determining broker liveness.</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-9-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-9-174189967" target="_self" rel class="footnote-anchor">9</a></span></p><p><span>Every broker issues </span><strong><a href="https://martinfowler.com/articles/patterns-of-distributed-systems/heartbeat.html" rel>heartbeats</a></strong><span> to the active controller. If a broker does not send heartbeats for 6 seconds straight, it is fenced off from the cluster by the controller. The controller then assigns other brokers to act as the leaders for the partitions the fenced (dead) broker led.</span></p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!PgiQ!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!PgiQ!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 424w, https://substackcdn.com/image/fetch/$s_!PgiQ!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 848w, https://substackcdn.com/image/fetch/$s_!PgiQ!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 1272w, https://substackcdn.com/image/fetch/$s_!PgiQ!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!PgiQ!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png" width="1456" height="1001" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:554785,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!PgiQ!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 424w, https://substackcdn.com/image/fetch/$s_!PgiQ!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 848w, https://substackcdn.com/image/fetch/$s_!PgiQ!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 1272w, https://substackcdn.com/image/fetch/$s_!PgiQ!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><p>The careful reader will now ask:</p><blockquote><p><span>If the active controller is responsible for electing partition leaders, who’s responsible for electing the </span><code>__cluster_metadata</code><span> leader?</span></p></blockquote><p><span>The </span><code>__cluster_metadata</code><span> partition is special. A custom distributed consensus algorithm is used to elect its leader.</span></p><h3 class="header-anchor-post">KRaft<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§kraft" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/kraft" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p>Leader election in a distributed system is a subset of the consensus problem. Many consensus algorithms exist, like Raft, Paxos, Zab, and so on.</p><p><span>Kafka uses its own </span><a href="https://raft.github.io/" rel>Raft</a><span>-inspired algorithm called KRaft (Kafka Raft).</span></p><p>KRaft has two key roles:</p><ol><li><p>Elect the active controller 👑</p><ol><li><p>The controller nodes comprise a Raft quorum</p></li><li><p><span>The quorum runs a Raft election protocol to elect a leader of the </span><code>__cluster_metadata</code><span> partition. The leader of that partition is the active controller</span></p></li></ol></li><li><p>Agree on the latest state of the metadata log</p><ol><li><p>Metadata updates are first appended to the Raft log on the active controller.</p></li><li><p>They are marked committed only when a majority of the quorum has persisted them.</p></li></ol></li></ol><p><span>The active controller determines the leaders for </span><strong>all the other</strong><span> regular topic partitions. It writes it to the metadata log, and once committed by the controller quorum, the decision is set in stone.</span></p><p>In other words, the way leader election in Kafka works is:</p><ul><li><p><span>Leader election </span><em><strong>between the controllers</strong></em><span> (picking the active one) is done through a variant of Raft (KRaft)</span></p></li><li><p><span>Leader election </span><em><strong>between regular brokers</strong></em><span> is done through the controller.</span></p></li></ul><p><span>KRaft is a relatively recent algorithm in Apache Kafka. For many years, Kafka </span><a href="https://stanislavkozlovski.medium.com/apache-kafkas-distributed-system-firefighter-the-controller-broker-1afca1eae302" rel>used ZooKeeper</a><span>. Back then, there was just one controller. It performed the same tasks as today, but critically also had the responsibilities of a regular broker. Its decisions were persisted in </span><a href="https://en.wikipedia.org/wiki/Apache_ZooKeeper" rel>ZooKeeper</a><span>, which used the Zab consensus algorithm behind the scenes.</span></p><p><span>This coordinator-based leader election model differs from other systems. For example, RedPanda</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-10-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-10-174189967" target="_self" rel class="footnote-anchor">10</a></span><span> uses a separate Raft quorum per partition.</span></p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!_BUE!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!_BUE!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!_BUE!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!_BUE!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!_BUE!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!_BUE!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png" width="1456" height="801" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:801,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:1510832,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!_BUE!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!_BUE!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!_BUE!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!_BUE!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><div><hr/></div><h2 class="header-anchor-post">Other Features That Set Kafka Apart<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§other-features-that-set-kafka-apart" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/other-features-that-set-kafka-apart" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><h3 class="header-anchor-post">Data Retention<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§data-retention" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/data-retention" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p>A key motivation in Kafka’s design was to add the ability to replay historical data and decouple data retention from clients. Alternative messaging systems would store messages as long as no client has consumed them, and once consumed, delete them.</p><p>Kafka flips this model - it offers a simple time-based SLA as the message retention policy. A message is automatically deleted if it has been retained in the broker longer than a certain period, typically 7 days. The fact that the Log data structure’s O(1) performance doesn’t degrade with a larger data size makes this feasible.</p><p><span>Through this model, Kafka offers the feature of </span><strong>replayability</strong><span> - the ability to reprocess old historical messages. That is extremely useful in cases where, for example, a consumer has had a dormant bug in it for a while and erroneously processed messages. When the bug is fixed, the correct logic can be rerun on the same messages.</span></p><h3 class="header-anchor-post">Tiered Storage<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§tiered-storage" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/tiered-storage" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p><span>Unfortunately, at scale, it becomes extremely tricky to manage so much historical data. A cluster with 1 GB/s of producer bandwidth would collect 1,772 TB worth of data across the cluster</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-11-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-11-174189967" target="_self" rel class="footnote-anchor">11</a></span><span>. Even spread across 100 brokers, it’s still 17TB worth of data that each broker would have to host on its disk.</span></p><p><span>With so much state, </span><a href="https://blog.2minutestreaming.com/p/apache-kafka-kip-405-tiered-storage" rel>a lot of problems start piling up</a><span>:</span></p><ul><li><p>❌ The system becomes inelastic. This happens because any action or incident requires a massive amount of data to be moved. That takes a long time.</p></li><li><p><span>❌ Further, the way the cloud is priced - </span><a href="https://aiven.io/blog/16-ways-tiered-storage-makes-kafka-better#cost" rel>durably hosting data yourself</a><span> on </span><a href="https://getkafkanated.substack.com/p/how-to-size-your-kafka-tiered-storage-cluster" rel>HDDs tends to cost</a><span> </span><strong>10x more</strong><span> than storing it in S3.</span></p></li></ul><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!YwzE!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!YwzE!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!YwzE!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!YwzE!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!YwzE!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!YwzE!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png" width="1456" height="819" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:819,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:360794,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!YwzE!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!YwzE!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!YwzE!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!YwzE!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><p><span>The Kafka community found an ingenious way to solve </span><a href="https://aiven.io/blog/16-ways-tiered-storage-makes-kafka-better#1-simpler-operations" rel>all these problems</a><span> with one simple idea → outsource them to S3.</span></p><p><span>While it may sound overly simple or lazy, it is an </span><strong>extremely elegant solution</strong><span>. S3 is a </span><a href="https://bigdata.2minutestreaming.com/p/how-aws-s3-scales-with-tens-of-millions-of-hard-drives" rel>marvel of software engineering</a><span> - it is maintained by hundreds of bright Amazon engineers. It is most likely the largest scale storage system known to man.</span></p><p><span>Kafka uses a pluggable interface to store cold data in a secondary storage tier. All three cloud object stores </span><a href="https://github.com/Aiven-Open/tiered-storage-for-apache-kafka" rel>are supported</a><span> as the secondary tier, and you are free to extend it further.</span></p><p>In essence, the data path in modern Kafka looks like this:</p><ul><li><p><strong>Hotset Tier</strong><span>: Write a message to a Kafka broker, which gets replicated across the replicas in the cluster. The message is stored on disk across all three nodes.</span></p><ul><li><p>The message is asynchronously offloaded to S3 (the secondary cold tier)</p></li></ul></li><li><p><strong>Cold Tier</strong><span>: After a configurable amount of time (e.g., 12 hours), the message is deleted from the brokers. Its only source of truth is left in S3. It expires from S3 after a separate configurable period.</span></p></li></ul><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!pCb7!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!pCb7!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!pCb7!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!pCb7!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!pCb7!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!pCb7!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png" width="1456" height="819" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:819,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:481020,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!pCb7!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!pCb7!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!pCb7!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!pCb7!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><p>You can still read the cold historical data from Kafka using the regular APIs. The only change is that the broker now fetches it from S3 instead of its own disk. </p><p>This results in slightly higher latencies when fetching historical data, but can be alleviated through caching. Latency for hot data can improve because it makes it cost-effective to deploy performant SSDs (instead of HDDs). Throughput remains the same very high number. Kafka as a system becomes much more elastic because it no longer needs to move massive amounts of data whenever new brokers are added or removed.</p><p>Storing large amounts of data in Kafka also ends up becoming more than 10x cheaper.</p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!nAHf!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!nAHf!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!nAHf!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!nAHf!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!nAHf!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!nAHf!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png" width="1456" height="819" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:819,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:1548192,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!nAHf!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!nAHf!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!nAHf!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!nAHf!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><h3 class="header-anchor-post">Consumer Groups &amp; Read Parallelization<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§consumer-groups-and-read-parallelization" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/consumer-groups-and-read-parallelization" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p>Recall that the log is read sequentially and in order:</p><ul><li><p>A topic is split into partitions because it’s Big Data™ - a single node shouldn’t be able to consume the whole topic. You need many consumers to handle the high volume of topic data.</p></li><li><p><strong>Only one consumer</strong><span> is meant to read from a partition at a time. This is done to ensure message order without needing locks.</span></p></li><li><p>These consumers need to coordinate on how to split partitions between each other.</p></li><li><p><span>At the same time, Kafka’s goal is to allow </span><strong>parallel</strong><span> consumption (multiple readers) of </span><strong>the same</strong><span> partition(s) for high read-fanout cases.</span></p></li></ul><p><span>Kafka addresses this through</span><strong> consumer</strong><span> </span><strong>groups</strong><span>. These groups are a set of consumer client instances (typically on separate nodes) that operate as one coherent unit. They distribute the work among themselves.</span></p><p>Each consumer group reads topics independently at its own pace. Consumers within the same group split the partitions between each other.</p><p>Consumer Groups support dynamic membership - you can scale consumption up or down by adding or removing members at runtime.</p><p>In essence, read throughput in Kafka can be scaled in two different ways:</p><ol><li><p><span>Add more </span><strong>consumers</strong><span> to your group</span></p><ul><li><p>e.g., your topic went from 10 MB/s to 20 MB/s of throughput, and your two existing consumers can’t keep up. Add more so they take up the extra load.</p></li></ul></li><li><p><span>Add more consumer </span><strong>groups</strong></p><ul><li><p>e.g., your topic is being consumed, but you’d like a new, separate application type to process the data too. For example, a nightly accounting job wants to catch up with the last day’s worth of payments.</p></li></ul></li></ol><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!e37q!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!e37q!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!e37q!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!e37q!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!e37q!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!e37q!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png" width="1456" height="1001" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:566147,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!e37q!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!e37q!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!e37q!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!e37q!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">Two different consumer groups reading the same Kafka topic. The “fraud detection” group is expanding by adding a new consumer. A new “accounting” consumer group consisting of two consumers is starting up too.</figcaption></figure></div><h3 class="header-anchor-post">The Consumer Group Membership Protocol<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§the-consumer-group-membership-protocol" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/the-consumer-group-membership-protocol" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p><span>Consumers within a group form a </span><em><strong>distributed processing system. </strong></em><span>Unsurprisingly, we hit more distributed systems’ problems - how do we coordinate the consumers? They need to:</span></p><ul><li><p>Establish consensus on progress (up to what offset did they read to)</p></li><li><p>Handle liveness (did a consumer go offline, and how do we take over its work)</p></li><li><p>Handle dynamic membership (did a new consumer come online)</p></li><li><p>Distribute work between themselves (which consumer will take which partition)</p></li></ul><p><span>Kafka consumers within the same group don’t talk to each other. They coordinate indirectly through a Kafka broker. The broker that leads a certain group is called the </span><strong>Group Coordinator</strong><span>.</span></p><p><span>Kafka again uses a </span><strong>centralized coordination model</strong><span> - the Group Coordinator makes the decisions. Consumers heartbeat to the coordinator and, through a pull-based model, inform themselves of what work they should do.</span></p><h4 class="header-anchor-post">The __consumer_offsets Topic<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§the-consumeroffsets-topic" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/the-consumeroffsets-topic" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h4><p>The Group Coordinator also acts as the “database” which stores the progress of each consumer.</p><p><span>Consumer Groups store a simple mapping of </span><em><strong>`{partition, offset}</strong></em><span>` in a special Kafka topic called </span><em><strong>`__consumer_offsets`</strong></em><span>. This helps them save the progress on what record they have </span><em><strong>read up to.</strong></em></p><p>When a consumer reads messages, it commits the offset up to which it has processed the log via the coordinator broker. This regular checkpointing allows for smooth failovers. In the event of failure, the consumer can restart and resume from where it ended, or another consumer can come and pick the work back up.</p><p>The special offsets topic has many partitions spread throughout brokers. Each group is associated with a particular partition. The leader of the particular partition that the group is associated with acts as the Group Coordinator for that group. In that sense, every broker in the cluster can act as a coordinator for some consumer group. This prevents hot spots where one broker handles all the consumer groups in the cluster.</p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!fKBi!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!fKBi!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!fKBi!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!fKBi!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!fKBi!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!fKBi!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png" width="1456" height="1001" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/cfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:760599,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!fKBi!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!fKBi!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!fKBi!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!fKBi!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">Two different consumer groups reading the same Kafka topic</figcaption></figure></div><p>The consumer group protocol is a critical part of Kafka.</p><p><span>It is generic enough to support other use cases beyond consumer groups. It therefore provides</span><strong> a way for external distributed systems to establish leader election and durably persist state through Kafka</strong><span>.</span></p><p>Keep this in mind: the next three systems we’ll discuss depend on the group protocol to work as distributed systems.</p><p>But first, a little about transactions:</p><h3 class="header-anchor-post">Transactions &amp; Exactly Once Processing<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§transactions-and-exactly-once-processing" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/transactions-and-exactly-once-processing" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p><span>I will try to keep this brief because it can get pretty complicated - Kafka supports </span><strong>transactions</strong><span>. But they aren’t quite like database transactions - it’s more about message visibility control.</span></p><p>A transaction in Kafka means that:</p><ul><li><p>A producer can send many messages. Those messages can go to different topics or partitions. They can also reach various brokers.</p></li><li><p><span>Those messages will </span><strong>atomically</strong><span> either be committed or aborted across all brokers.</span></p></li></ul><p><span>Technically, this happens </span><em>from the perspective</em><span> </span><em>of a consumer. </em><span>In other words, the messages are still written to the topics, but consumers can be configured to skip non-committed ones. This is client-side filtering at work.</span></p><p>Marking transactions as committed or aborted is achieved through a two-phase commit protocol. It again relies on a centralized coordination model. A Transaction Coordinator broker makes this work. It’s pretty complex.</p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!h6st!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!h6st!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!h6st!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!h6st!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!h6st!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!h6st!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png" width="1456" height="1001" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/badb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:1017211,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!h6st!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!h6st!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!h6st!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!h6st!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">A producer writing messages to multiple topics and partitions in the same transaction. It manages and commits the transaction via the broker acting as the Transaction Coordinator</figcaption></figure></div><p>The important thing with transactions is that they enable message deduplication in common cases.</p><ul><li><p><strong>⚡️ Network/broker blips</strong><span>: if the network drops the broker response packets, or the broker restarts, the same producer client will idempotently</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-12-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-12-174189967" target="_self" rel class="footnote-anchor">12</a></span><span> write its message without creating duplicates.</span></p></li><li><p><strong>💥 Producer client blips</strong><span>: if the producer itself restarts from a clean state, it will fetch its monotonically increasing ID and bump an epoch. This way, a potentially old zombie instance with the old epoch can’t interfere with the transaction.</span></p></li></ul><p><span>This doesn’t remove all cases of duplicates. Edge cases from external systems can still exist.</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-13-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-13-174189967" target="_self" rel class="footnote-anchor">13</a></span></p><p>However, when reads and writes only involve Kafka (and no other external system), exactly once processing is possible.💡</p><p>This is actively supported and used in Kafka Streams, as we will cover shortly 👇</p><div><hr/></div><h3 class="header-anchor-post">Other Kafka Components<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§other-kafka-components" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/other-kafka-components" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p><span>The </span><a href="https://github.com/apache/kafka" rel>Apache Kafka GitHub project</a><span> consists of a few components, two of which we already covered:</span></p><ul><li><p><strong>Kafka Core</strong><span>: the brokers, controllers, and coordinators (back-end).</span></p></li><li><p><strong>Kafka Clients</strong><span>: the Kafka client libraries (producer, consumer).</span></p></li></ul><p>These are two more that we will focus on now:</p><ul><li><p><strong>Kafka Streams</strong></p></li><li><p><strong>Kafka Connect</strong></p></li></ul><h4 class="header-anchor-post">Kafka Streams<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§kafka-streams" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/kafka-streams" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h4><p><span>A </span><em><strong>stream processor</strong></em><span> is an application that:</span></p><ul><li><p>continuously processes messages</p></li><li><p>works performantly and at scale</p></li><li><p>emits the results in real-time</p></li><li><p><span>supports complex stateful operations like windowed aggregations and joins of multiple streams of data</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-14-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-14-174189967" target="_self" rel class="footnote-anchor">14</a></span></p></li></ul><p><strong>Kafka Streams</strong><span> is a high-level </span><a href="https://github.com/apache/kafka/blob/trunk/streams/src/main/java/org/apache/kafka/streams/KafkaStreams.java" rel>client-side stream processing</a><span> Java library for Kafka. It offers rich higher-level stream processing APIs that basically do this:</span></p><ol><li><p>continuously read a stream of messages from a set of Kafka input topics</p></li><li><p>perform processing on these messages (map, filter, joins, sums, stateful window aggregations, etc.)</p></li><li><p>continuously write the results into an output topic</p></li></ol><p>Here is a simple pseudocode example of its declarative API:</p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!uKgV!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!uKgV!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 424w, https://substackcdn.com/image/fetch/$s_!uKgV!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 848w, https://substackcdn.com/image/fetch/$s_!uKgV!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 1272w, https://substackcdn.com/image/fetch/$s_!uKgV!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!uKgV!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png" width="1456" height="779" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/b5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:779,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:558397,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!uKgV!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 424w, https://substackcdn.com/image/fetch/$s_!uKgV!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 848w, https://substackcdn.com/image/fetch/$s_!uKgV!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 1272w, https://substackcdn.com/image/fetch/$s_!uKgV!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><p>This code continuously counts the sum of human page views over the last minute and produces it in a new topic. Here is an example of what the Kafka topics would look like:</p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!Ee47!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!Ee47!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!Ee47!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!Ee47!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!Ee47!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!Ee47!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png" width="1456" height="1001" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:652482,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!Ee47!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!Ee47!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!Ee47!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!Ee47!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">An example of how the records in the source page view topic get processed into page traffic sums</figcaption></figure></div><p><span>This API is intended to be used within your own Java applications. It works like the consumer. It helps you scale by spreading the stream processing work over multiple applications (just like consumer groups do). One difference is that it also lets you spread the work through </span><strong>threads</strong><span>. It uses the same consumer group protocol underneath to coordinate work between instances.</span></p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!76zL!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!76zL!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!76zL!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!76zL!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!76zL!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!76zL!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png" width="1456" height="1001" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:637472,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!76zL!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!76zL!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!76zL!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!76zL!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">An example two-node stream processing job</figcaption></figure></div><p>It is technically possible to achieve this with your own code using the simple producer/consumer libraries, but it’d be a lot of work. Kafka Streams is a higher-level abstraction above both clients with a ton of extra processing, orchestration, and stateful logic on top. 👌</p><p><span>Kafka Streams only works with Kafka. It takes input from a Kafka topic and sends output to another Kafka topic. This setup allows Kafka Streams to guarantee exactly once processing by using Kafka Transactions. Practically speaking, this means that it can </span><em><strong>atomically</strong></em><span> process data.</span></p><p>For example, it could read a set of payment messages in a Kafka topic, calculate the sum, and persist the result in another Kafka topic, with a 100% guarantee that no message was lost or double-counted in the process.</p><blockquote><p><span>If interested in more, here is a quick introduction to </span><a href="https://bigdata.2minutestreaming.com/p/what-is-kafka-streams-api-guide" rel>Kafka Streams</a><span>.</span></p></blockquote><h4 class="header-anchor-post">Schema Registry<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§schema-registry" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/schema-registry" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h4><p><span>Kafka does not support types (e.g., int64) nor schemas</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-15-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-15-174189967" target="_self" rel class="footnote-anchor">15</a></span><span>. Messages are just raw bytes</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-16-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-16-174189967" target="_self" rel class="footnote-anchor">16</a></span><span>. To process a message, like summing order payment values, you need to be able to parse the message structure and the exact value field. How is this achieved, then?</span></p><p>There’s no “official” way, because the open source Apache project does not support schemas. There is a common convention, though. That is to use an external HTTP service with a database that stores the schemas.</p><p><span>In practice, a Kafka topic acts as this database. It stores a simple pair of </span><em><strong>{schema, topic}</strong></em><span>. Kafka clients connect to the service, download the schema, and use it whenever they serialize/deserialize messages.</span></p><p><span>The first such registry was a </span><a href="https://github.com/confluentinc/schema-registry" rel>source-available project</a><span> by Confluent called Schema Registry. However, without official Apache support or a truly open-source license, the ecosystem has fragmented. There are many different service implementations</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-17-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-17-174189967" target="_self" rel class="footnote-anchor">17</a></span><span> today. Many Kafka users also opt to manage schemas in their own unconventional ways.</span></p><p>The way the end-to-end path conventionally works with schemas:</p><ol><li><p>Producers decide on a schema, associate it with a topic, and register it in the registry</p></li><li><p>Producers then serialize the message in the correct structure (including the unique schema ID in the message) and write it to Kafka</p></li><li><p>Consumers download the message, parse the schema ID, then fetch (and cache) the schema from the registry</p></li><li><p>Consumers use the schema to deserialize the message</p></li></ol><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!be6u!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!be6u!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!be6u!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!be6u!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!be6u!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!be6u!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png" width="1456" height="1001" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/e7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:517026,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!be6u!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!be6u!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!be6u!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!be6u!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><h4 class="header-anchor-post">Kafka Connect<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§kafka-connect" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/kafka-connect" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h4><p><span>Kafka </span><a href="https://bigdatastream.substack.com/p/why-was-apache-kafka-created" rel>was created to solve LinkedIn’s data integration problem</a><span>. It is meant to move data between different systems. This can be difficult because each system can have its own API, its own protocol (TCP, HTTP, JDBC, etc.), its own format (XML, JSON, Protobuf, Avro), and different compatibility guarantees.</span></p><p><span>Kafka Connect helps standardize this. Connect is both a framework (set of APIs) and a </span><strong>runtime</strong><span> for plugins that connect Kafka with external systems</span><span class="footnote-hovercard-target"><a data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-18-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-18-174189967" target="_self" rel class="footnote-anchor">18</a></span><span>.</span></p><p>For the end user, it’s a no-code/low-code framework to plumb popular systems to Kafka and back (think ElasticSearch, Snowflake, PostgreSQL, BigQuery).</p><p>This ensures a single, standardized way to integrate systems together. The tricky bits of code that guarantee fault-tolerance, ordering, and exactly-once processing are written once (in the form of plugins) and battle-tested.</p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!aKO3!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!aKO3!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!aKO3!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!aKO3!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!aKO3!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!aKO3!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png" width="1456" height="1001" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/d4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:552140,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt srcset="https://substackcdn.com/image/fetch/$s_!aKO3!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!aKO3!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!aKO3!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!aKO3!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">An example of Kafka Connect integrating data into Kafka. Source Connectors read data from MongoDB and write to Kafka. Sink Connectors read data from Kafka and write it to Snowflake.</figcaption></figure></div><p>Connect has three main terms one should know about:</p><ul><li><p><strong>Connect Workers</strong><span>: the simple nodes that form a distributed Connect Cluster</span></p></li><li><p><strong>Connect Herder</strong><span>: a worker that acts as the manager of the cluster. It exposes a REST API with which users can check the status of tasks, start new ones, etc</span></p></li><li><p><strong>Connectors</strong><span>: the plugins (or libraries) that run on the workers. They contain the code needed to integrate with other systems</span></p><ul><li><p><span>A </span><strong>Source</strong><span> Connector reads data from an external system and writes it to Kafka (System->Kafka)</span></p></li><li><p><span>A </span><strong>Sink</strong><span> Connector reads data from Kafka and writes it to an external system (Kafka->System)</span></p></li></ul></li></ul><p>The end user spins up a cluster with several Worker nodes. They install the particular Connector plugin jars on these nodes. Then, they start the integration with a simple HTTP POST request.</p><p>This again forms another distributed processing system. The Herder leader election, general cluster membership, and the distribution of new tasks throughout the group of Workers are all done transparently via Kafka’s Consumer Group protocol.</p><p><span>Essentially, Connect is a lot of plugin-specific integration logic on top of the regular KafkaProducer and KafkaConsumer APIs. </span><a href="https://www.confluent.io/hub/" rel>Hundreds of Connector plugins</a><span> exist, which give Kafka its incredibly rich integration capabilities.</span></p><blockquote><p><strong>💡 </strong><em><strong>rich integration (8/8)</strong></em></p></blockquote><div><hr/></div><h3 class="header-anchor-post">🎬 Conclusion<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div id="§conclusion" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" aria-label="Link" data-href="https://newsletter.systemdesign.one/i/174189967/conclusion" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_secondary-S63h9o"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h3><p>With that, we’ve gone over all the important internals of Apache Kafka. I repeat the introductory sentence, which you can now hopefully understand much better:</p><blockquote><p>💡 Kafka is an open-source, distributed, durable, very scalable, fault-tolerant pub/sub messaging system with rich integration and stream processing capabilities.</p></blockquote><p>It achieves this through many internal details, including but not limited to:</p><ul><li><p>The Producer &amp; Consumer libraries &amp; APIs</p></li><li><p>Topics, Partitions, and Replicas</p></li><li><p>Brokers and KRaft Controller Quorums</p></li><li><p>Idempotency, Transactions, and Exactly-Once Processing</p></li><li><p>Tiered Storage</p></li><li><p>Consumer Groups &amp; the Consumer Group Protocol</p></li><li><p>Kafka Streams</p></li><li><p>Kafka Connect</p></li><li><p>Schema Registry</p></li></ul><p>This is why Kafka is the Swiss army knife of data engineering.</p><p>It is a very active open-source project that is constantly evolving. A few notable features that are currently being worked on are:</p><ul><li><p><a href="https://blog.2minutestreaming.com/p/apache-kafka-share-group-queues-kip-932" rel>Queues</a><span>: the ability to read a partition with queue-like semantics. Queues have no ordering but allow for multiple consumers to read from the same log with per-record acknowledgement. This is different from Kafka’s exclusive one-consumer-per-partition model. In that model, consumers read data in order and only know “I’ve read </span><strong>up until</strong><span> this message”.</span></p></li><li><p><a href="https://blog.2minutestreaming.com/p/diskless-kafka-topics-kip-1150" rel>Diskless Topics</a><span>: the ability to host topic partitions in a leaderless way. This happens by leveraging object storage (S3) as the data layer instead of brokers’ disks. This feature can cut cloud costs by </span><strong>90%</strong><span>+ (!), further boost scalability, and simplify managing Kafka.</span></p></li><li><p><a href="https://aiven.io/blog/iceberg-topics-for-apache-kafka-zero-etl-zero-copy" rel>Iceberg Topics</a><span>: the ability to store your Kafka data in an </span><a href="https://bigdata.2minutestreaming.com/p/meet-your-new-data-lakehouse-s3-iceberg" rel>open table format</a><span> (Iceberg) in a zero-copy way.</span></p></li></ul><p>Many alternative proprietary systems compete with Apache Kafka. The one common denominator is that they all use the same Kafka protocol and API. They just implement it differently. These include, but are not limited to, Confluent Kora, AWS MSK, RedPanda, WarpStream, BufStream, Aiven Inkless, AutoMQ, and more.</p><p>The space is incredibly rich and rapidly evolving. If you’re further interested in the world of event streaming and Apache Kafka, make sure to stay in touch. 🙂</p><div><hr/></div><p><span>👋 I'd like to thank </span><a href="http://linkedin.com/in/stanislavkozlovski" rel>Stanislav</a><span> for writing this newsletter!</span></p><ul><li><p><span>Also subscribe to his newsletters: </span><strong><a href="https://blog.2minutestreaming.com/" rel>2 Minute Streaming</a></strong><span> and </span><strong><a href="https://bigdata.2minutestreaming.com/" rel>Big Data Stream</a></strong><span>.</span></p></li></ul><p>It’ll help you master Kafka quickly.</p><div><hr/></div><p>Subscribe to get simplified case studies delivered straight to your inbox:</p><div data-component-name="SubscribeWidget" class="subscribe-widget"><div class="pencraft pc-display-flex pc-justifyContent-center pc-reset"><div class="container-IpPqBD"><form action="/api/v1/free?nojs=true" method="post" novalidate class="form form-M5sC90"><input type="hidden" name="first_url" value/><input type="hidden" name="first_referrer" value/><input type="hidden" name="current_url"/><input type="hidden" name="current_referrer"/><input type="hidden" name="first_session_url" value/><input type="hidden" name="first_session_referrer" value/><input type="hidden" name="referral_code"/><input type="hidden" name="source" value="subscribe-widget"/><input type="hidden" name="referring_pub_id"/><input type="hidden" name="additional_referring_pub_ids"/><div class="sideBySideWrap-vGXrwP"><div class="emailInputWrapper-QlA86j"><div class="pencraft pc-display-flex pc-minWidth-0 pc-position-relative pc-reset flex-auto-j3S2WA"><input name="email" placeholder="Type your email..." type="email" class="pencraft emailInput-OkIMeB input-y4v6N4 inputText-pV_yWb"/></div></div><button tabindex="0" type="submit" disabled class="pencraft pc-reset pencraft rightButton primary subscribe-btn button-VFSdkv buttonBase-GK1x3M"><span class="button-text ">Subscribe</span></button></div><div id="error-container"></div></form></div></div></div><div><hr/></div><div class="captioned-image-container"><figure><a target="_blank" href="https://www.linkedin.com/in/nk-systemdesign-one/" data-component-name="Image2ToDOM" rel class="image-link image2"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!bEFk!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 424w, https://substackcdn.com/image/fetch/$s_!bEFk!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 848w, https://substackcdn.com/image/fetch/$s_!bEFk!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 1272w, https://substackcdn.com/image/fetch/$s_!bEFk!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!bEFk!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png" width="152" height="152" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:320,&quot;width&quot;:320,&quot;resizeWidth&quot;:152,&quot;bytes&quot;:74009,&quot;alt&quot;:&quot;Author Neo Kim; System design case studies&quot;,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:&quot;https://www.linkedin.com/in/nk-systemdesign-one/&quot;,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt="Author Neo Kim; System design case studies" title="Author Neo Kim; System design case studies" srcset="https://substackcdn.com/image/fetch/$s_!bEFk!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 424w, https://substackcdn.com/image/fetch/$s_!bEFk!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 848w, https://substackcdn.com/image/fetch/$s_!bEFk!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 1272w, https://substackcdn.com/image/fetch/$s_!bEFk!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div></div></div></a><figcaption class="image-caption"><strong><span>👋 Find me on </span><a href="https://www.linkedin.com/in/nk-systemdesign-one/" rel>LinkedIn</a><span> | </span><a href="https://x.com/intent/follow?screen_name=systemdesignone" rel>Twitter</a><span> | </span><a href="https://www.threads.net/@systemdesignone" rel>Threads</a><span> | </span><a href="https://www.instagram.com/systemdesignone/" rel>Instagram</a></strong></figcaption></figure></div><div><hr/></div><p><strong>Want to advertise in this newsletter? </strong><span>📰</span></p><p><span>If your company wants to reach a 170K+ tech audience, </span><a href="https://newsletter.systemdesign.one/p/sponsorship" rel>advertise with me</a><span>.</span></p><div><hr/></div><p>Thank you for supporting this newsletter.</p><p>You are now 170,001+ readers strong, very close to 171k. Let’s try to get 171k readers by 28 September. Consider sharing this post with your friends and get rewards.</p><p>Y’all are the best.</p><div class="captioned-image-container"><figure><a target="_blank" href="https://substackcdn.com/image/fetch/$s_!6oWl!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png" data-component-name="Image2ToDOM" rel class="image-link image2 is-viewable-img"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!6oWl!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 424w, https://substackcdn.com/image/fetch/$s_!6oWl!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 848w, https://substackcdn.com/image/fetch/$s_!6oWl!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 1272w, https://substackcdn.com/image/fetch/$s_!6oWl!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/$s_!6oWl!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png" width="590" height="368.75" data-attrs="{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/2e739087-a910-4643-be36-997b6dd5b4af_800x500.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:500,&quot;width&quot;:800,&quot;resizeWidth&quot;:590,&quot;bytes&quot;:87878,&quot;alt&quot;:&quot;system design newsletter&quot;,&quot;title&quot;:&quot;system design newsletter&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/163380418?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}" alt="system design newsletter" title="system design newsletter" srcset="https://substackcdn.com/image/fetch/$s_!6oWl!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 424w, https://substackcdn.com/image/fetch/$s_!6oWl!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 848w, https://substackcdn.com/image/fetch/$s_!6oWl!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 1272w, https://substackcdn.com/image/fetch/$s_!6oWl!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 1456w" sizes="100vw" loading="lazy" class="sizing-normal"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3v5h-5"></path><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path><path d="M8 16H3v5"></path></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2 lucide-maximize-2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a></figure></div><p data-attrs="{&quot;url&quot;:&quot;https://newsletter.systemdesign.one/p/how-kafka-works?utm_source=substack&amp;utm_medium=email&amp;utm_content=share&amp;action=share&quot;,&quot;text&quot;:&quot;Share&quot;,&quot;action&quot;:null,&quot;class&quot;:null}" data-component-name="ButtonCreateButton" class="button-wrapper"><a href="https://newsletter.systemdesign.one/p/how-kafka-works?utm_source=substack&amp;utm_medium=email&amp;utm_content=share&amp;action=share" rel class="button primary"><span>Share</span></a></p><div><hr/></div><p>Apache®, Apache Kafka®, Kafka, and the Kafka logo are either registered trademarks or trademarks of the Apache Software Foundation in the United States and/or other countries. No endorsement by The Apache Software Foundation is implied by the use of these marks.</p><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-1-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-1-174189967" contenteditable="false" target="_self" rel class="footnote-number">1</a><div class="footnote-content"><p>This adoption data is an estimation by Confluent, the company founded by the creators of Kafka. I have no good way to confirm it.</p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-2-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-2-174189967" contenteditable="false" target="_self" rel class="footnote-number">2</a><div class="footnote-content"><p>That’s why its official name is “Apache Kafka”, although we still often say Kafka for short.</p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-3-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-3-174189967" contenteditable="false" target="_self" rel class="footnote-number">3</a><div class="footnote-content"><p>A Streaming Platform means a system that allows you to store and process a large volume of streams of data. For example, a company like Uber has millions of drivers constantly streaming their GPS coordinates to Uber’s backend systems. A streaming platform can scale this data and process it in real time as it comes. This helps Uber make use of the data (e.g, recompute the route, figure out where there is traffic, etc).</p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-4-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-4-174189967" contenteditable="false" target="_self" rel class="footnote-number">4</a><div class="footnote-content"><p>A sequential read means reading bytes laid out contiguously on the physical drive. Random reads mean the opposite - you have to jump to different parts of the drive to read the bytes.</p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-5-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-5-174189967" contenteditable="false" target="_self" rel class="footnote-number">5</a><div class="footnote-content"><p>Theoretically, you can do this by using very good high-end hardware with ample networking capacity. An example could be 75 brokers each accepting 512 MiB/s of writes. Modern SSDs can do this without a problem. Practically speaking, it would be very hard to operate and require custom code. Therefore most prefer to split such workloads into many clusters.</p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-6-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-6-174189967" contenteditable="false" target="_self" rel class="footnote-number">6</a><div class="footnote-content"><p><strong>Durability</strong><span> refers to long-term data protection - ensuring that data never gets lost or corrupted.</span></p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-7-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-7-174189967" contenteditable="false" target="_self" rel class="footnote-number">7</a><div class="footnote-content"><p><strong>Centralized coordination</strong><span> in distributed systems means all the nodes rely on a single authority, like a coordinator or a leader. This authority makes decisions, enforces rules, and keeps the state consistent. Alternative interesting models include things like quorums, gossip, and CRDTs.</span></p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-8-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-8-174189967" contenteditable="false" target="_self" rel class="footnote-number">8</a><div class="footnote-content"><p><strong>Stream-table duality</strong><span> is the simple idea that a stream of events and a table are two sides of the same coin. Any mutation to a table (update/delete/insert) is in itself an event. The table simply represents the end state of all events. If you start from scratch and replay all the events, you reach the same table.</span><br/><em><strong>Event-sourcing</strong></em><span>, on the other hand, is the design of a system around this log-based stream of events.</span><br/><span>The ideas have their roots in </span><strong>materialized view theory</strong><span> in databases and in </span><strong>change data capture</strong><span>. (Some sources, if you’re extra curious:</span><a href="https://medium.com/event-driven-utopia/the-duality-of-streams-and-tables-why-it-matters-ed9bb17e7505" rel> stream-table duality</a><span> and </span><a href="https://martinfowler.com/eaaDev/EventSourcing.html" rel>event-sourcing</a><span>)</span></p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-9-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-9-174189967" contenteditable="false" target="_self" rel class="footnote-number">9</a><div class="footnote-content"><p><strong>Liveness</strong><span> is a tricky distributed systems term that basically means that the system will eventually make progress (won’t freeze up). In the context of broker liveness, it means that a dead broker will get fenced, so partitions don’t get stuck on a dead node. This allows the cluster to move forward. Liveliness technically also means that an alive broker will eventually be unfenced.</span></p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-10-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-10-174189967" contenteditable="false" target="_self" rel class="footnote-number">10</a><div class="footnote-content"><p><a href="https://github.com/redpanda-data/redpanda" rel>RedPanda</a><span> is a C++ rewrite of Kafka, purpose-built to offer ultra-low latencies. It is fully compatible with the Kafka protocol &amp; API. However, it takes some different design choices. For example, it uses a Raft quorum for each partition. It features a thread-per-core execution model based on the </span><a href="https://seastar.io/" rel>Seastar</a><span> library (similar to </span><a href="https://www.scylladb.com/" rel>Scylla</a><span>, the C++ </span><a href="https://cassandra.apache.org/_/index.html" rel>Cassandra</a><span> rewrite). It is also simpler because it directly ships with a schema registry and HTTP proxy.</span></p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-11-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-11-174189967" contenteditable="false" target="_self" rel class="footnote-number">11</a><div class="footnote-content"><p>1 GiB/s * 60 (seconds) * 60 (minutes) * 24 (hours) * 7 (days) * 3 (replication) == 1,814,400 GiB == 1,771.875 TiB; Not to mention you want to run your disks with ample free space capacity (e.g., 50%) - you’d need to provision ~3500TB worth of disks!</p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-12-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-12-174189967" contenteditable="false" target="_self" rel class="footnote-number">12</a><div class="footnote-content"><p><strong>Idempotency</strong><span> means not repeating the same action twice. If a “Create User Bob” request is sent twice, an idempotent system would create the user only once. In Kafka, this is achieved by associating a unique monotonically increasing ID with each message. So you could send the message (“Create-User-Bob, 1”) twice, but Kafka will accept it only once because of the unique ID. This is not foolproof, though, because the unique ID comes from the Kafka Producer client. Two producers can therefore create the same message with different IDs.</span></p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-13-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-13-174189967" contenteditable="false" target="_self" rel class="footnote-number">13</a><div class="footnote-content"><p>Most simply said, imagine you have an HTTP service receiving requests. The service processes the request “Create user Bob” and successfully produces the message to Kafka. Before the service responds with an HTTP response to the user, it crashes. The user then retries the same HTTP request, and the new service produces the same “Create user Bob” into Kafka. From Kafka’s PoV, this is fine because it sees both as separate messages. The HTTP service evidently does not support handling idempotent requests and exactly-once processing.</p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-14-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-14-174189967" contenteditable="false" target="_self" rel class="footnote-number">14</a><div class="footnote-content"><p><strong>Stream processing</strong><span> - the easiest way to understand it is through the opposite extreme - </span><strong>batch processing</strong><span>. Imagine you are Tesla and are collecting data from your fleet of cars. At the end of each business day, you run a big report. The report joins data from multiple sources and creates a dashboard that an executive in Tesla sees. They use it to see summaries like the number of kilometers crossed, times they had to charge the Tesla, how often X feature was used. It runs once a day and calculates data after a cut-off date (e.g., end of day). Stream Processing would be the opposite - it would have the cars continuously emit data like their tire pressure (psi). It would then perform windowed aggregations on this data to understand, in real time, what’s happening to the car. If the tire pressure went from 45psi to 41psi over the course of 15 minutes, you’d know </span><strong>the tire is losing pressure</strong><span>. If the tire pressure went from 45psi to 20psi over the course of </span><em><strong>10 seconds</strong></em><span>, you’d know you </span><strong>blew out a tire</strong><span>. Tesla could implement this example by deploying a lot of Kafka Stream jobs in their back-end. (assuming the data exists in Kafka)</span></p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-15-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-15-174189967" contenteditable="false" target="_self" rel class="footnote-number">15</a><div class="footnote-content"><p><span>A </span><em><strong>schema</strong></em><span> basically means the expected structure of your data. A database table has a very strict schema - you know what type each field is and what fields there are (e.g id BIGINT, name VARCHAR, cost DECIMAL, is_premium BOOLEAN). You can’t add fields or types that don’t match, like a string for an ID. A JSON object by itself is schemaless - you can modify it however you want and it’s still a valid JSON object (the only question is whether your server will accept it, and that depends on the modification). In the same way, a blob of bytes doesn’t have a strict structure - you can add any garbage in there. There is a project that adds a strict structure to JSON objects called </span><a href="https://json-schema.github.io/json-schema/example1.html" rel>JSON Schema</a><span>. Similarly, there are projects that add strict structure to blobs of bytes (</span><a href="https://protobuf.dev/" rel>Protobuf</a><span>, </span><a href="https://avro.apache.org/" rel>Avro</a><span>). It’s important to have schemas because they are critical to validating and catching bugs in your data early.</span></p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-16-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-16-174189967" contenteditable="false" target="_self" rel class="footnote-number">16</a><div class="footnote-content"><p><span>I believe this was a</span><a href="https://bigdata.2minutestreaming.com/i/170964904/schemaless-kafka" rel> big mistake</a><span> by the project. Every important use case, like Connect, Streams, and general processing, must understand the data’s structure.</span></p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-17-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-17-174189967" contenteditable="false" target="_self" rel class="footnote-number">17</a><div class="footnote-content"><p><span>A few schema registry implementations are</span><a href="https://github.com/Aiven-Open/karapace" rel> Karaspace</a><span> (Apache-licensed),</span><a href="https://docs.aws.amazon.com/glue/latest/dg/schema-registry-integrations.html" rel> AWS Glue</a><span> (proprietary),</span><a href="https://github.com/Apicurio/apicurio-registry" rel> ApiCurio</a><span> (Apache-licensed),</span><a href="https://buf.build/product/bsr" rel> Buf Schema Registry</a><span> (proprietary),</span><a href="https://github.com/redpanda-data/redpanda" rel> and Redpanda</a><span> (mixed licenses).</span></p></div></div><div data-component-name="FootnoteToDOM" class="footnote"><a id="footnote-18-174189967" href="https://newsletter.systemdesign.one/p/how-kafka-works#footnote-anchor-18-174189967" contenteditable="false" target="_self" rel class="footnote-number">18</a><div class="footnote-content"><p><span>A </span><strong>runtime</strong><span> here means that you deploy the Connect software, and then, via `curl`, schedule extra pre-defined code to run on top of it (plugins). A </span><em><strong>framework</strong></em><span> means that you’re free to write your own plugins that use the API if you’d like.</span></p></div></div></div></div><div class="visibility-check"></div><div class="post-footer"><div class="pencraft pc-display-flex pc-gap-16 pc-paddingTop-16 pc-paddingBottom-16 pc-justifyContent-space-between pc-alignItems-center pc-reset flex-grow-rzmknG border-top-detail-themed-k9TZAY border-bottom-detail-themed-Ua9186 post-ufi"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="like-button-container post-ufi-button style-button"><a role="button" aria-label="Like (356)" aria-pressed="false" class="post-ufi-button style-button has-label with-border"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 24 24" fill="#000000" stroke-width="2" stroke="#000" xmlns="http://www.w3.org/2000/svg" class="icon"><g><title></title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-heart"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"></path></svg></g></svg><div class="label">356</div></a></div><a role="button" href="https://newsletter.systemdesign.one/p/how-kafka-works/comments" aria-label="View comments (6)" class="post-ufi-button style-button post-ufi-comment-button has-label with-border"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 24 24" fill="#000000" stroke-width="2" stroke="#000" xmlns="http://www.w3.org/2000/svg" class="icon"><g><title></title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path></svg></g></svg><div class="label">6</div></a><a role="button" class="post-ufi-button style-button has-label with-border"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="#000" xmlns="http://www.w3.org/2000/svg" class="icon"><g><title></title><path d="M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12" stroke-linecap="round" stroke-linejoin="round"></path></g></svg><div class="label">57</div></a></div><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><a role="button" href="javascript:void(0)" class="post-ufi-button style-button no-icon has-label with-border"><div class="label">Share</div></a></div></div></div><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div class="pencraft pc-display-flex pc-paddingTop-16 pc-paddingBottom-16 pc-justifyContent-space-between pc-reset"><button tabindex="0" type="button" class="pencraft pc-reset pencraft buttonBase-GK1x3M buttonText-X0uSmG buttonStyle-r7yGCK priority_secondary-S63h9o size_md-gCDS3o"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg>Previous</button><button tabindex="0" type="button" class="pencraft pc-reset pencraft buttonBase-GK1x3M buttonText-X0uSmG buttonStyle-r7yGCK priority_secondary-S63h9o size_md-gCDS3o">Next<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-right"><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg></button></div></div><div class="post-contributor-footer"><div class="container-border"></div><div data-user-id="1057029" class="post-contributor-bio"><table cellpadding="0" cellspacing="0" class="post-contributor-bio-table"><tr class="post-contributor-bio-table-row"><td class="post-contributor-bio-userhead-cell post-contributor-bio-userhead-cell-web"><a href="https://substack.com/@stanislavkozlovski" aria-label="View Stanislav Kozlovski's profile" utmSource="byline" class="pencraft pc-display-contents pc-reset"><div style="--scale:52px;" tabindex="0" class="pencraft pc-display-flex pc-width-52 pc-height-52 pc-justifyContent-center pc-alignItems-center pc-position-relative pc-reset bg-secondary-UUD3_J flex-auto-j3S2WA animate-XFJxE4 outline-detail-vcQLyr pc-borderRadius-full overflow-hidden-WdpwT6 sizing-border-box-DggLA4 pressable-sm-YIJFKJ showFocus-sk_vEm container-TAtrWj interactive-UkK0V6"><div style="--scale:52px;" title="Stanislav Kozlovski" class="pencraft pc-display-flex pc-width-52 pc-height-52 pc-justifyContent-center pc-alignItems-center pc-position-relative pc-reset bg-secondary-UUD3_J flex-auto-j3S2WA outline-detail-vcQLyr pc-borderRadius-full overflow-hidden-WdpwT6 sizing-border-box-DggLA4 container-TAtrWj"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!0lM5!,w_52,h_52,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg 52w, https://substackcdn.com/image/fetch/$s_!0lM5!,w_104,h_104,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg 104w, https://substackcdn.com/image/fetch/$s_!0lM5!,w_156,h_156,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg 156w" sizes="52px"/><img src="https://substackcdn.com/image/fetch/$s_!0lM5!,w_52,h_52,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg" sizes="52px" alt="Stanislav Kozlovski's avatar" srcset="https://substackcdn.com/image/fetch/$s_!0lM5!,w_52,h_52,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg 52w, https://substackcdn.com/image/fetch/$s_!0lM5!,w_104,h_104,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg 104w, https://substackcdn.com/image/fetch/$s_!0lM5!,w_156,h_156,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg 156w" width="52" height="52" draggable="false" class="img-OACg1c object-fit-cover-u4ReeV pencraft pc-reset"/></picture></div></div></a></td><td class="post-contributor-bio-body-cell post-contributor-bio-body-cell-web"><div class="post-contributor-bio-body"><div class="post-contributor-bio-preamble">A guest post by</div><table cellpadding="0" cellspacing="0" class="post-contributor-bio-body-table"><tr class="post-contributor-bio-body-table-row"><td class="post-contributor-bio-copy-cell"><div class="pencraft pc-display-flex pc-gap-4 pc-paddingBottom-4 pc-alignItems-center pc-reset"><div class="profile-hover-card-target profileHoverCardTarget-PBxvGm"><a href="https://substack.com/@stanislavkozlovski?utm_campaign=guest_post_bio&amp;utm_medium=web" native class="post-contributor-bio-title no-margin">Stanislav Kozlovski</a></div></div><div class="post-contributor-bio-text">7yr experience with Kafka; committer; writes concisely about kafka and big data engineering</div></td><td class="post-contributor-bio-controls-cell post-contributor-bio-controls-cell-web"><div class="post-contributor-bio-controls"><a href="https://bigdata.2minutestreaming.com/subscribe?" native class="post-contributor-bio-subscribe-button button primary"><span class="post-contributor-bio-subscribe-button-label">Subscribe to Stanislav</span></a></div></td></tr></table></div></td></tr></table></div></div></div></article></div></div></div><div class="pencraft pc-display-contents pc-reset pubTheme-yiXxQA"><div class="visibility-check"></div><div id="discussion" class="pencraft pc-display-flex pc-flexDirection-column pc-gap-16 pc-paddingTop-32 pc-paddingBottom-32 pc-reset"><div class="pencraft pc-display-flex pc-flexDirection-column pc-gap-32 pc-reset container"><h4 class="pencraft pc-reset line-height-24-jnGwiv font-display-nhmvtD size-20-P_cSRT weight-bold-DmI9lw reset-IxiVJZ">Discussion about this post</h4><div class="pencraft pc-alignSelf-flex-start pc-reset"><div class="pencraft pc-display-flex pc-flexDirection-column pc-position-relative pc-minWidth-0 pc-reset bg-primary-zk6FDl pc-borderRadius-sm overflow-hidden-WdpwT6"><button type="button" aria-hidden="true" style="position:fixed;top:1px;left:1px;width:1px;height:0px;padding:0px;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;"></button><div aria-label="Select discussion type" role="tablist" aria-orientation="horizontal" class="pencraft pc-display-flex pc-gap-4 pc-padding-4 pc-position-relative pc-reset cursor-default-flE2S1 outline-detail-vcQLyr pc-borderRadius-sm overflow-auto-7WTsTi scrollBar-hidden-HcAIpI"><button tabindex="0" type="button" id="headlessui-tabs-tab-P0-13" role="tab" aria-selected="true" data-headlessui-state="selected" class="pencraft pc-reset flex-auto-j3S2WA pencraft segment-LBFzmC buttonBase-GK1x3M buttonText-X0uSmG buttonStyle-r7yGCK priority_tertiary-rlke8z size_sm-G3LciD">Comments</button><button tabindex="-1" type="button" id="headlessui-tabs-tab-P0-14" role="tab" aria-selected="false" data-headlessui-state class="pencraft pc-reset flex-auto-j3S2WA pencraft segment-LBFzmC buttonBase-GK1x3M buttonText-X0uSmG buttonStyle-r7yGCK priority_quaternary-kpMibu size_sm-G3LciD">Restacks</button><div class="pencraft pc-position-absolute pc-height-32 pc-reset bg-secondary-UUD3_J pc-borderRadius-xs sizing-border-box-DggLA4 highlight-U002IP"></div></div><div class="pencraft pc-display-flex pc-alignItems-center pc-reset arrowButtonContainer-O4uSiH arrowButtonOverlaidContainer-t10AyH left-Tg8vqp"><div class="overlay-zrMCxn primary-lv_sOW"></div></div><div class="pencraft pc-display-flex pc-alignItems-center pc-reset arrowButtonContainer-O4uSiH arrowButtonOverlaidContainer-t10AyH right-i3oWGi"><div class="overlay-zrMCxn primary-lv_sOW"></div></div></div></div></div><div class="single-post-section comments-section"><div class="container"><div class="visibility-check"></div><div data-test-id="comment-input" class="pencraft pc-display-flex pc-reset flex-grow-rzmknG"><form class="form-CkZ7Kt"><div style="--scale:32px;" class="pencraft pc-display-flex pc-width-32 pc-height-32 pc-justifyContent-center pc-alignItems-center pc-position-relative pc-reset bg-secondary-UUD3_J flex-auto-j3S2WA outline-detail-vcQLyr pc-borderRadius-full overflow-hidden-WdpwT6 sizing-border-box-DggLA4 container-TAtrWj"><div style="--scale:32px;" title="User" class="pencraft pc-display-flex pc-width-32 pc-height-32 pc-justifyContent-center pc-alignItems-center pc-position-relative pc-reset bg-secondary-UUD3_J flex-auto-j3S2WA outline-detail-vcQLyr pc-borderRadius-full overflow-hidden-WdpwT6 sizing-border-box-DggLA4 container-TAtrWj"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!TnFC!,w_32,h_32,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack.com%2Fimg%2Favatars%2Fdefault-light.png 32w, https://substackcdn.com/image/fetch/$s_!TnFC!,w_64,h_64,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack.com%2Fimg%2Favatars%2Fdefault-light.png 64w, https://substackcdn.com/image/fetch/$s_!TnFC!,w_96,h_96,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack.com%2Fimg%2Favatars%2Fdefault-light.png 96w" sizes="32px"/><img src="https://substackcdn.com/image/fetch/$s_!TnFC!,w_32,h_32,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack.com%2Fimg%2Favatars%2Fdefault-light.png" sizes="32px" alt="User's avatar" srcset="https://substackcdn.com/image/fetch/$s_!TnFC!,w_32,h_32,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack.com%2Fimg%2Favatars%2Fdefault-light.png 32w, https://substackcdn.com/image/fetch/$s_!TnFC!,w_64,h_64,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack.com%2Fimg%2Favatars%2Fdefault-light.png 64w, https://substackcdn.com/image/fetch/$s_!TnFC!,w_96,h_96,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack.com%2Fimg%2Favatars%2Fdefault-light.png 96w" width="32" height="32" draggable="false" class="img-OACg1c object-fit-cover-u4ReeV pencraft pc-reset"/></picture></div></div><div class="pencraft pc-display-flex pc-flexDirection-column pc-gap-8 pc-reset flex-grow-rzmknG"><textarea name="body" placeholder="Write a comment..." aria-label="Write a comment..." rows="4" class="pencraft input-qHk4bN autogrowing-_ipn9Y textarea-GbEjRX inputText-pV_yWb"></textarea><div style="height:0px;transition:height 250ms var(--animation-smooth), opacity 250ms var(--animation-smooth);display:block;flex-direction:column;opacity:0;"><div style="padding-top:0.05px;padding-bottom:0.05px;display:block;flex:0 0 auto;flex-direction:column;transition:transform 250ms var(--animation-smooth);"></div></div></div></form></div><div class="comment-list post-page-root-comment-list"><div class="comment-list-items"><div class="comment"><div id="comment-160124876" class="comment-anchor"></div><div id="comment-160124876-reply" class="comment-anchor"></div><div role="article" aria-label="Comment by Favour Lawrence" class="pencraft pc-display-flex pc-gap-12 pc-paddingBottom-12 pc-reset comment-content"><div class="pencraft pc-display-flex pc-flexDirection-column pc-reset"><a href="https://substack.com/profile/99824971-favour-lawrence?utm_source=comment" aria-label="View Favour Lawrence's profile" class="pencraft pc-display-contents pc-reset"><div style="--scale:32px;" tabindex="0" class="pencraft pc-display-flex pc-width-32 pc-height-32 pc-justifyContent-center pc-alignItems-center pc-position-relative pc-reset bg-secondary-UUD3_J flex-auto-j3S2WA animate-XFJxE4 outline-detail-vcQLyr pc-borderRadius-full overflow-hidden-WdpwT6 sizing-border-box-DggLA4 pressable-sm-YIJFKJ showFocus-sk_vEm container-TAtrWj interactive-UkK0V6"><div style="--scale:32px;" title="Favour Lawrence" class="pencraft pc-display-flex pc-width-32 pc-height-32 pc-justifyContent-center pc-alignItems-center pc-position-relative pc-reset bg-secondary-UUD3_J flex-auto-j3S2WA outline-detail-vcQLyr pc-borderRadius-full overflow-hidden-WdpwT6 sizing-border-box-DggLA4 container-TAtrWj"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!Xegk!,w_32,h_32,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffe4e7bbf-970f-43c4-82a5-f09694961251_720x1256.jpeg 32w, https://substackcdn.com/image/fetch/$s_!Xegk!,w_64,h_64,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffe4e7bbf-970f-43c4-82a5-f09694961251_720x1256.jpeg 64w, https://substackcdn.com/image/fetch/$s_!Xegk!,w_96,h_96,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffe4e7bbf-970f-43c4-82a5-f09694961251_720x1256.jpeg 96w" sizes="32px"/><img src="https://substackcdn.com/image/fetch/$s_!Xegk!,w_32,h_32,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffe4e7bbf-970f-43c4-82a5-f09694961251_720x1256.jpeg" sizes="32px" alt="Favour Lawrence's avatar" srcset="https://substackcdn.com/image/fetch/$s_!Xegk!,w_32,h_32,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffe4e7bbf-970f-43c4-82a5-f09694961251_720x1256.jpeg 32w, https://substackcdn.com/image/fetch/$s_!Xegk!,w_64,h_64,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffe4e7bbf-970f-43c4-82a5-f09694961251_720x1256.jpeg 64w, https://substackcdn.com/image/fetch/$s_!Xegk!,w_96,h_96,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ffe4e7bbf-970f-43c4-82a5-f09694961251_720x1256.jpeg 96w" width="32" height="32" draggable="false" class="img-OACg1c object-fit-cover-u4ReeV pencraft pc-reset"/></picture></div></div></a></div><div class="pencraft pc-display-flex pc-flexDirection-column pc-reset flex-grow-rzmknG"><div class="pencraft pc-display-flex pc-reset"><div class="pencraft pc-display-flex pc-flexDirection-column pc-gap-4 pc-reset"><div class="pencraft pc-display-flex pc-minWidth-0 pc-gap-8 pc-alignItems-center pc-height-20 pc-reset line-height-20-t4M0El font-text-qe4AeH size-15-Psle70 weight-regular-mUq6Gb"><div class="pencraft pc-display-flex pc-minWidth-0 pc-gap-8 pc-alignItems-center pc-reset flex-grow-rzmknG"><div class="pencraft pc-display-flex pc-gap-6 pc-reset color-primary-zABazT line-height-20-t4M0El font-text-qe4AeH size-13-hZTUKr weight-regular-mUq6Gb reset-IxiVJZ"><span class="pencraft pc-reset weight-medium-fw81nC reset-IxiVJZ"><div class="profile-hover-card-target profileHoverCardTarget-PBxvGm inline-lJXy8b"><span class="pencraft pc-reset decoration-hover-underline-ClDVRM reset-IxiVJZ"><a href="https://substack.com/profile/99824971-favour-lawrence?utm_source=substack-feed-item" showBack class="link-LIBpto">Favour Lawrence</a></span></div></span></div><div class="publicationHoverCardTarget-sPJ4jb"></div><a href="https://newsletter.systemdesign.one/p/how-kafka-works/comment/160124876" rel="nofollow" native title="Sep 26, 2025, 1:29 PM" class="pencraft pc-reset color-secondary-ls1g8s decoration-hover-underline-ClDVRM reset-IxiVJZ"><span class="pencraft pc-reset color-secondary-ls1g8s line-height-20-t4M0El font-text-qe4AeH size-13-hZTUKr weight-regular-mUq6Gb reset-IxiVJZ">Sep 26</span></a></div></div><div class="pencraft pc-display-flex pc-gap-4 pc-reset"><button tabindex="-1" type="button" class="pencraft pc-display-flex pc-gap-4 pc-height-20 pc-paddingLeft-6 pc-paddingRight-6 pc-paddingTop-2 pc-paddingBottom-2 pc-alignItems-center pc-reset cursor-inherit-LxLBJ6 pc-borderRadius-xs size-11-NuY2Zx weight-medium-fw81nC pencraft tag-XbOVLt theme_accent-Y2sqZY priority_secondary-outline-RpooJS"><div class="pencraft pc-display-flex pc-alignItems-center pc-reset leading-mI5Ihl fillIcon-dQ0mii"><svg role="img" style="height:14px;width:14px;" width="14" height="14" viewBox="0 0 20 20" fill="var(--color-fg-primary)" stroke-width="2.5" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path stroke="none" d="M9.99915 16.7256C9.90515 16.7256 9.79102 16.692 9.65674 16.6249C9.52246 16.5622 9.3949 16.4906 9.27405 16.41C8.02974 15.6044 6.94657 14.7584 6.02454 13.8722C5.10697 12.9815 4.3953 12.0662 3.88953 11.1262C3.38375 10.1818 3.13086 9.23067 3.13086 8.27283C3.13086 7.63725 3.23157 7.05762 3.43298 6.53394C3.63888 6.01025 3.92086 5.55819 4.27893 5.17773C4.64148 4.79728 5.05774 4.50635 5.52771 4.30493C6.00216 4.09904 6.51241 3.99609 7.05847 3.99609C7.73433 3.99609 8.31844 4.16618 8.81079 4.50635C9.30762 4.84652 9.70374 5.28963 9.99915 5.83569C10.299 5.28516 10.6951 4.84204 11.1875 4.50635C11.6843 4.16618 12.2707 3.99609 12.9465 3.99609C13.4836 3.99609 13.9894 4.09904 14.4639 4.30493C14.9428 4.50635 15.3613 4.79728 15.7194 5.17773C16.0774 5.55819 16.3572 6.01025 16.5586 6.53394C16.7645 7.05762 16.8674 7.63725 16.8674 8.27283C16.8674 9.23067 16.6145 10.1818 16.1088 11.1262C15.603 12.0662 14.8891 12.9815 13.967 13.8722C13.0495 14.7584 11.9708 15.6044 10.731 16.41C10.6056 16.4906 10.4758 16.5622 10.3416 16.6249C10.2118 16.692 10.0976 16.7256 9.99915 16.7256Z"></path></g></svg></div>Liked by Stanislav Kozlovski, Neo Kim</button></div></div><div class="pencraft pc-display-flex pc-flexDirection-column pc-reset flex-grow-rzmknG"></div><div class="pencraft pc-display-flex pc-reset triggerContainer-eX588u"><button tabindex="0" type="button" aria-label="Ellipsis" id="headlessui-menu-button-P0-16" aria-haspopup="menu" aria-expanded="false" data-headlessui-state class="pencraft pc-reset pencraft trigger-j08Uop iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_quaternary-kpMibu"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ellipsis"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg></button></div></div><div class="comment-body"><p><span>This article is so comprehensive. One can find their way round kafka with this .</span></p><div role="button" class="show-all-toggle"><div class="show-all-toggle-label">Expand full comment</div></div></div><div class="pencraft pc-display-flex pc-gap-16 pc-paddingTop-8 pc-justifyContent-flex-start pc-alignItems-center pc-reset comment-actions withShareButton-hQzuEn"><span class="pencraft pc-reset decoration-hover-underline-ClDVRM reset-IxiVJZ"><a class="pencraft pc-reset link-_X6et2 link-LIBpto"><div class="pencraft pc-display-flex pc-gap-6 pc-alignItems-center pc-reset"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--color-fg-secondary-themed)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path></svg><div class="pencraft pc-reset color-pub-secondary-text-hGQ02T line-height-20-t4M0El font-meta-MWBumP size-11-NuY2Zx weight-medium-fw81nC transform-uppercase-yKDgcq reset-IxiVJZ meta-EgzBVA">Reply</div></div></a></span><span class="pencraft pc-reset decoration-hover-underline-ClDVRM reset-IxiVJZ"><a class="pencraft pc-reset link-_X6et2 link-LIBpto"><div class="pencraft pc-display-flex pc-gap-6 pc-alignItems-center pc-reset"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--color-fg-secondary-themed)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-share"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" x2="12" y1="2" y2="15"></line></svg><div class="pencraft pc-reset color-pub-secondary-text-hGQ02T line-height-20-t4M0El font-meta-MWBumP size-11-NuY2Zx weight-medium-fw81nC transform-uppercase-yKDgcq reset-IxiVJZ meta-EgzBVA">Share</div></div></a></span></div><div style="height:0px;transition:height 250ms var(--animation-smooth), opacity 250ms var(--animation-smooth);display:block;flex-direction:column;opacity:0;"><div style="padding-top:0.05px;padding-bottom:0.05px;display:block;flex:0 0 auto;flex-direction:column;transition:transform 250ms var(--animation-smooth);"></div></div></div></div></div><div class="comment"><div id="comment-160022994" class="comment-anchor"></div><div id="comment-160022994-reply" class="comment-anchor"></div><div role="article" aria-label="Comment by Dinesh Solanki" class="pencraft pc-display-flex pc-gap-12 pc-paddingBottom-12 pc-reset comment-content"><div class="pencraft pc-display-flex pc-flexDirection-column pc-reset"><a href="https://substack.com/profile/327876431-dinesh-solanki?utm_source=comment" aria-label="View Dinesh Solanki's profile" class="pencraft pc-display-contents pc-reset"><div style="--scale:32px;" tabindex="0" class="pencraft pc-display-flex pc-width-32 pc-height-32 pc-justifyContent-center pc-alignItems-center pc-position-relative pc-reset bg-secondary-UUD3_J flex-auto-j3S2WA animate-XFJxE4 outline-detail-vcQLyr pc-borderRadius-full overflow-hidden-WdpwT6 sizing-border-box-DggLA4 pressable-sm-YIJFKJ showFocus-sk_vEm container-TAtrWj interactive-UkK0V6"><div style="--scale:32px;" title="Dinesh Solanki" class="pencraft pc-display-flex pc-width-32 pc-height-32 pc-justifyContent-center pc-alignItems-center pc-position-relative pc-reset bg-secondary-UUD3_J flex-auto-j3S2WA outline-detail-vcQLyr pc-borderRadius-full overflow-hidden-WdpwT6 sizing-border-box-DggLA4 container-TAtrWj"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/$s_!dSG2!,w_32,h_32,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5a7bfb7-c08f-4f05-bceb-5da669d7e823_96x96.png 32w, https://substackcdn.com/image/fetch/$s_!dSG2!,w_64,h_64,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5a7bfb7-c08f-4f05-bceb-5da669d7e823_96x96.png 64w, https://substackcdn.com/image/fetch/$s_!dSG2!,w_96,h_96,c_fill,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5a7bfb7-c08f-4f05-bceb-5da669d7e823_96x96.png 96w" sizes="32px"/><img src="https://substackcdn.com/image/fetch/$s_!dSG2!,w_32,h_32,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5a7bfb7-c08f-4f05-bceb-5da669d7e823_96x96.png" sizes="32px" alt="Dinesh Solanki's avatar" srcset="https://substackcdn.com/image/fetch/$s_!dSG2!,w_32,h_32,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5a7bfb7-c08f-4f05-bceb-5da669d7e823_96x96.png 32w, https://substackcdn.com/image/fetch/$s_!dSG2!,w_64,h_64,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5a7bfb7-c08f-4f05-bceb-5da669d7e823_96x96.png 64w, https://substackcdn.com/image/fetch/$s_!dSG2!,w_96,h_96,c_fill,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5a7bfb7-c08f-4f05-bceb-5da669d7e823_96x96.png 96w" width="32" height="32" draggable="false" class="img-OACg1c object-fit-cover-u4ReeV pencraft pc-reset"/></picture></div></div></a></div><div class="pencraft pc-display-flex pc-flexDirection-column pc-reset flex-grow-rzmknG"><div class="pencraft pc-display-flex pc-reset"><div class="pencraft pc-display-flex pc-flexDirection-column pc-gap-4 pc-reset"><div class="pencraft pc-display-flex pc-minWidth-0 pc-gap-8 pc-alignItems-center pc-height-20 pc-reset line-height-20-t4M0El font-text-qe4AeH size-15-Psle70 weight-regular-mUq6Gb"><div class="pencraft pc-display-flex pc-minWidth-0 pc-gap-8 pc-alignItems-center pc-reset flex-grow-rzmknG"><div class="pencraft pc-display-flex pc-gap-6 pc-reset color-primary-zABazT line-height-20-t4M0El font-text-qe4AeH size-13-hZTUKr weight-regular-mUq6Gb reset-IxiVJZ"><span class="pencraft pc-reset weight-medium-fw81nC reset-IxiVJZ"><div class="profile-hover-card-target profileHoverCardTarget-PBxvGm inline-lJXy8b"><span class="pencraft pc-reset decoration-hover-underline-ClDVRM reset-IxiVJZ"><a href="https://substack.com/profile/327876431-dinesh-solanki?utm_source=substack-feed-item" showBack class="link-LIBpto">Dinesh Solanki</a></span></div></span></div><a href="https://newsletter.systemdesign.one/p/how-kafka-works/comment/160022994" rel="nofollow" native title="Sep 26, 2025, 3:33 AM" class="pencraft pc-reset color-secondary-ls1g8s decoration-hover-underline-ClDVRM reset-IxiVJZ"><span class="pencraft pc-reset color-secondary-ls1g8s line-height-20-t4M0El font-text-qe4AeH size-13-hZTUKr weight-regular-mUq6Gb reset-IxiVJZ">Sep 26</span></a></div></div><div class="pencraft pc-display-flex pc-gap-4 pc-reset"><button tabindex="-1" type="button" class="pencraft pc-display-flex pc-gap-4 pc-height-20 pc-paddingLeft-6 pc-paddingRight-6 pc-paddingTop-2 pc-paddingBottom-2 pc-alignItems-center pc-reset cursor-inherit-LxLBJ6 pc-borderRadius-xs size-11-NuY2Zx weight-medium-fw81nC pencraft tag-XbOVLt theme_accent-Y2sqZY priority_secondary-outline-RpooJS"><div class="pencraft pc-display-flex pc-alignItems-center pc-reset leading-mI5Ihl fillIcon-dQ0mii"><svg role="img" style="height:14px;width:14px;" width="14" height="14" viewBox="0 0 20 20" fill="var(--color-fg-primary)" stroke-width="2.5" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path stroke="none" d="M9.99915 16.7256C9.90515 16.7256 9.79102 16.692 9.65674 16.6249C9.52246 16.5622 9.3949 16.4906 9.27405 16.41C8.02974 15.6044 6.94657 14.7584 6.02454 13.8722C5.10697 12.9815 4.3953 12.0662 3.88953 11.1262C3.38375 10.1818 3.13086 9.23067 3.13086 8.27283C3.13086 7.63725 3.23157 7.05762 3.43298 6.53394C3.63888 6.01025 3.92086 5.55819 4.27893 5.17773C4.64148 4.79728 5.05774 4.50635 5.52771 4.30493C6.00216 4.09904 6.51241 3.99609 7.05847 3.99609C7.73433 3.99609 8.31844 4.16618 8.81079 4.50635C9.30762 4.84652 9.70374 5.28963 9.99915 5.83569C10.299 5.28516 10.6951 4.84204 11.1875 4.50635C11.6843 4.16618 12.2707 3.99609 12.9465 3.99609C13.4836 3.99609 13.9894 4.09904 14.4639 4.30493C14.9428 4.50635 15.3613 4.79728 15.7194 5.17773C16.0774 5.55819 16.3572 6.01025 16.5586 6.53394C16.7645 7.05762 16.8674 7.63725 16.8674 8.27283C16.8674 9.23067 16.6145 10.1818 16.1088 11.1262C15.603 12.0662 14.8891 12.9815 13.967 13.8722C13.0495 14.7584 11.9708 15.6044 10.731 16.41C10.6056 16.4906 10.4758 16.5622 10.3416 16.6249C10.2118 16.692 10.0976 16.7256 9.99915 16.7256Z"></path></g></svg></div>Liked by Stanislav Kozlovski, Neo Kim</button></div></div><div class="pencraft pc-display-flex pc-flexDirection-column pc-reset flex-grow-rzmknG"></div><div class="pencraft pc-display-flex pc-reset triggerContainer-eX588u"><button tabindex="0" type="button" aria-label="Ellipsis" id="headlessui-menu-button-P0-18" aria-haspopup="menu" aria-expanded="false" data-headlessui-state class="pencraft pc-reset pencraft trigger-j08Uop iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_sm-G3LciD priority_quaternary-kpMibu"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ellipsis"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg></button></div></div><div class="comment-body"><p><span>This article is awesome. Explaining every capabilities of the tool so that we can go deeper as needed. As a beginner in kafka, this is very helpful. Thanks!</span></p><div role="button" class="show-all-toggle"><div class="show-all-toggle-label">Expand full comment</div></div></div><div class="pencraft pc-display-flex pc-gap-16 pc-paddingTop-8 pc-justifyContent-flex-start pc-alignItems-center pc-reset comment-actions withShareButton-hQzuEn"><span class="pencraft pc-reset decoration-hover-underline-ClDVRM reset-IxiVJZ"><a class="pencraft pc-reset link-_X6et2 link-LIBpto"><div class="pencraft pc-display-flex pc-gap-6 pc-alignItems-center pc-reset"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--color-fg-secondary-themed)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-message-circle"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"></path></svg><div class="pencraft pc-reset color-pub-secondary-text-hGQ02T line-height-20-t4M0El font-meta-MWBumP size-11-NuY2Zx weight-medium-fw81nC transform-uppercase-yKDgcq reset-IxiVJZ meta-EgzBVA">Reply</div></div></a></span><span class="pencraft pc-reset decoration-hover-underline-ClDVRM reset-IxiVJZ"><a class="pencraft pc-reset link-_X6et2 link-LIBpto"><div class="pencraft pc-display-flex pc-gap-6 pc-alignItems-center pc-reset"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--color-fg-secondary-themed)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-share"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" x2="12" y1="2" y2="15"></line></svg><div class="pencraft pc-reset color-pub-secondary-text-hGQ02T line-height-20-t4M0El font-meta-MWBumP size-11-NuY2Zx weight-medium-fw81nC transform-uppercase-yKDgcq reset-IxiVJZ meta-EgzBVA">Share</div></div></a></span></div><div style="height:0px;transition:height 250ms var(--animation-smooth), opacity 250ms var(--animation-smooth);display:block;flex-direction:column;opacity:0;"><div style="padding-top:0.05px;padding-bottom:0.05px;display:block;flex:0 0 auto;flex-direction:column;transition:transform 250ms var(--animation-smooth);"></div></div></div></div></div></div></div><a href="https://newsletter.systemdesign.one/p/how-kafka-works/comments" class="more-comments">4 more comments...</a></div></div></div><div class="single-post-section"><div class="container"><div class="visibility-check"></div><div style="margin-left:-8px;margin-right:-8px;" aria-label="Top Posts Footer" role="region" class="pencraft pc-paddingTop-24 pc-paddingBottom-24 pc-reset"><div class="portable-archive empty-list"><div aria-label="Archive sort tabs" role="navigation" class="pencraft pc-display-flex pc-gap-12 pc-paddingLeft-8 pc-paddingRight-8 pc-paddingBottom-16 pc-justifyContent-space-between pc-alignItems-center pc-reset"><div class="pencraft pc-display-flex pc-flexDirection-column pc-position-relative pc-minWidth-0 pc-reset bg-primary-zk6FDl pc-borderRadius-sm overflow-hidden-WdpwT6"><button type="button" aria-hidden="true" style="position:fixed;top:1px;left:1px;width:1px;height:0px;padding:0px;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0;"></button><div aria-label="Tabs" role="tablist" aria-orientation="horizontal" class="pencraft pc-display-flex pc-gap-4 pc-padding-4 pc-position-relative pc-reset cursor-default-flE2S1 outline-detail-vcQLyr pc-borderRadius-sm overflow-auto-7WTsTi scrollBar-hidden-HcAIpI"><button tabindex="0" type="button" id="headlessui-tabs-tab-P0-19" role="tab" aria-selected="true" data-headlessui-state="selected" class="pencraft pc-reset flex-auto-j3S2WA pencraft segment-LBFzmC buttonBase-GK1x3M buttonText-X0uSmG buttonStyle-r7yGCK priority_tertiary-rlke8z size_sm-G3LciD">Top</button><button tabindex="-1" type="button" id="headlessui-tabs-tab-P0-20" role="tab" aria-selected="false" data-headlessui-state class="pencraft pc-reset flex-auto-j3S2WA pencraft segment-LBFzmC buttonBase-GK1x3M buttonText-X0uSmG buttonStyle-r7yGCK priority_quaternary-kpMibu size_sm-G3LciD">Latest</button><button tabindex="-1" type="button" id="headlessui-tabs-tab-P0-21" role="tab" aria-selected="false" data-headlessui-state class="pencraft pc-reset flex-auto-j3S2WA pencraft segment-LBFzmC buttonBase-GK1x3M buttonText-X0uSmG buttonStyle-r7yGCK priority_quaternary-kpMibu size_sm-G3LciD">Discussions</button><div class="pencraft pc-position-absolute pc-height-32 pc-reset bg-secondary-UUD3_J pc-borderRadius-xs sizing-border-box-DggLA4 highlight-U002IP"></div></div><div class="pencraft pc-display-flex pc-alignItems-center pc-reset arrowButtonContainer-O4uSiH arrowButtonOverlaidContainer-t10AyH left-Tg8vqp"><div class="overlay-zrMCxn primary-lv_sOW"></div></div><div class="pencraft pc-display-flex pc-alignItems-center pc-reset arrowButtonContainer-O4uSiH arrowButtonOverlaidContainer-t10AyH right-i3oWGi"><div class="overlay-zrMCxn primary-lv_sOW"></div></div></div><button tabindex="0" type="button" aria-label="Search" class="pencraft pc-reset pencraft iconButton-mq_Et5 iconButtonBase-dJGHgN buttonBase-GK1x3M buttonStyle-r7yGCK size_md-gCDS3o priority_tertiary-rlke8z"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg></button></div><div class="portable-archive-list"><p class="portable-archive-empty">No posts</p></div></div></div></div></div><div class="visibility-check"></div><div class="subscribe-footer"><div class="container"><p>Ready for more?</p><div class="pencraft pc-display-flex pc-justifyContent-center pc-reset"><div><div class="container-IpPqBD"><form action="/api/v1/free?nojs=true" method="post" novalidate class="form form-M5sC90"><input type="hidden" name="first_url" value/><input type="hidden" name="first_referrer" value/><input type="hidden" name="current_url"/><input type="hidden" name="current_referrer"/><input type="hidden" name="first_session_url" value/><input type="hidden" name="first_session_referrer" value/><input type="hidden" name="referral_code"/><input type="hidden" name="source" value="subscribe_footer"/><input type="hidden" name="referring_pub_id"/><input type="hidden" name="additional_referring_pub_ids"/><div class="sideBySideWrap-vGXrwP"><div class="emailInputWrapper-QlA86j"><div class="pencraft pc-display-flex pc-minWidth-0 pc-position-relative pc-reset flex-auto-j3S2WA"><input name="email" placeholder="Type your email..." type="email" class="pencraft emailInput-OkIMeB emailInputOnAccentBackground-TfaCGr input-y4v6N4 inputText-pV_yWb"/></div></div><button tabindex="0" type="submit" disabled class="pencraft pc-reset pencraft rightButton primary subscribe-btn button-VFSdkv buttonOnAccentBackground-vmEt94 buttonBase-GK1x3M"><span class="button-text ">Subscribe</span></button></div><div id="error-container"></div></form></div></div></div></div></div></div></div></div><div class="footer-wrap publication-footer"><div class="visibility-check"></div><div class="footer themed-background"><div class="container"><div class="footer-blurbs"><div class="footer-copyright-blurb">© 2025 Neo Kim</div><div class="footer-terms-blurb"><div><div class="pencraft pc-reset color-tertiary-ePI2vV line-height-20-t4M0El font-text-qe4AeH size-14-MLPa7j weight-regular-mUq6Gb reset-IxiVJZ"><a href="https://newsletter.systemdesign.one/privacy" target="_blank" rel="noopener" class="pencraft pc-reset decoration-underline-ClTkYc">Publisher Privacy</a></div></div></div></div><div class="footer-blurbs"><div class="footer-copyright-blurb">Substack</div><div class="footer-terms-blurb"><a href="https://substack.com/privacy" target="_blank" rel="noopener" class="pencraft pc-reset decoration-underline-ClTkYc">Privacy</a><span> ∙ </span><a href="https://substack.com/tos" target="_blank" rel="noopener" class="pencraft pc-reset decoration-underline-ClTkYc">Terms</a><span> ∙ </span><a href="https://substack.com/ccpa#personal-data-collected" target="_blank" rel="noopener" class="pencraft pc-reset decoration-underline-ClTkYc">Collection notice</a></div></div><div class="footer-buttons"><a native href="https://substack.com/signup?utm_source=substack&amp;utm_medium=web&amp;utm_content=footer" class="footer-substack-cta start-publishing"><svg role="img" width="1000" height="1000" viewBox="0 0 1000 1000" fill="#ff6719" stroke-width="1.8" stroke="none" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M764.166 348.371H236.319V419.402H764.166V348.371Z"></path><path d="M236.319 483.752V813.999L500.231 666.512L764.19 813.999V483.752H236.319Z"></path><path d="M764.166 213H236.319V284.019H764.166V213Z"></path></g></svg> Start your Substack</a><a native href="https://substack.com/app/app-store-redirect?utm_campaign=app-marketing&amp;utm_content=web-footer-button" class="footer-substack-cta get-the-app no-icon">Get the app</a></div><div translated class="pencraft pc-reset reset-IxiVJZ footer-slogan-blurb"><a href="https://substack.com" native>Substack</a> is the home for great culture</div></div></div></div></div><div style="left:auto;right:16px;bottom:16px;z-index:1001;transform:translateY(0px);" role="region" aria-label="Notification" class="pencraft pc-position-fixed pc-reset sizing-border-box-DggLA4"></div><div></div>
        </div>

        
            <script src="https://js.sentry-cdn.com/6c2ff3e3828e4017b7faf7b63e24cdf8.min.js" crossorigin="anonymous"></script>
            <script>
                window.Sentry && window.Sentry.onLoad(function() {
                    window.Sentry.init({
                        environment: window._preloads.sentry_environment,
                        dsn: window._preloads.sentry_dsn,
                    })
                })
            </script>
        


        
        
        
        <script>window._preloads        = JSON.parse("{\"isEU\":false,\"language\":\"en\",\"country\":\"US\",\"userLocale\":{\"language\":\"en\",\"region\":\"US\",\"source\":\"default\"},\"base_url\":\"https://newsletter.systemdesign.one\",\"stripe_publishable_key\":\"pk_live_51QfnARLDSWi1i85FBpvw6YxfQHljOpWXw8IKi5qFWEzvW8HvoD8cqTulR9UWguYbYweLvA16P7LN6WZsGdZKrNkE00uGbFaOE3\",\"captcha_site_key\":\"6LdYbsYZAAAAAIFIRh8X_16GoFRLIReh-e-q6qSa\",\"pub\":{\"apple_pay_disabled\":false,\"apex_domain\":null,\"author_id\":135589200,\"byline_images_enabled\":true,\"bylines_enabled\":true,\"chartable_token\":null,\"community_enabled\":true,\"copyright\":\"Neo Kim\",\"cover_photo_url\":null,\"created_at\":\"2023-03-21T17:36:42.769Z\",\"custom_domain_optional\":false,\"custom_domain\":\"newsletter.systemdesign.one\",\"default_comment_sort\":\"best_first\",\"default_coupon\":null,\"default_group_coupon\":\"d6837d0d\",\"default_show_guest_bios\":true,\"email_banner_url\":null,\"email_from_name\":\"Neo Kim\",\"email_from\":null,\"embed_tracking_disabled\":false,\"explicit\":false,\"expose_paywall_content_to_search_engines\":true,\"fb_pixel_id\":null,\"fb_site_verification_token\":null,\"flagged_as_spam\":false,\"founding_subscription_benefits\":[],\"free_subscription_benefits\":[\"Weekly quick essays\"],\"ga_pixel_id\":\"\",\"google_site_verification_token\":null,\"google_tag_manager_token\":\"GTM-TR7MRKF\",\"hero_image\":null,\"hero_text\":\"Download my system design playbook on newsletter signup for FREE\",\"hide_intro_subtitle\":false,\"hide_intro_title\":false,\"hide_podcast_feed_link\":false,\"homepage_type\":\"newspaper\",\"id\":1511845,\"image_thumbnails_always_enabled\":false,\"invite_only\":false,\"language\":\"en\",\"logo_url_wide\":null,\"logo_url\":\"https://substackcdn.com/image/fetch/$s_!1Tqi!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc307af20-7930-4c70-9a4b-1e800617ef9e_256x256.png\",\"minimum_group_size\":2,\"moderation_enabled\":true,\"name\":\"The System Design Newsletter\",\"paid_subscription_benefits\":[\"Subscriber-only essays\",\"Occasional deep dives\"],\"parsely_pixel_id\":null,\"payments_state\":\"enabled\",\"paywall_free_trial_enabled\":false,\"podcast_art_url\":null,\"paid_podcast_episode_art_url\":null,\"podcast_byline\":null,\"podcast_description\":null,\"podcast_enabled\":false,\"podcast_feed_url\":null,\"podcast_title\":null,\"post_preview_limit\":null,\"primary_user_id\":135589200,\"require_clickthrough\":false,\"show_pub_podcast_tab\":false,\"show_recs_on_homepage\":true,\"subdomain\":\"systemdesignone\",\"subscriber_invites\":0,\"support_email\":null,\"theme_var_background_pop\":\"#FF0000\",\"theme_var_color_links\":false,\"theme_var_cover_bg_color\":null,\"trial_end_override\":null,\"twitter_pixel_id\":null,\"type\":\"newsletter\",\"post_reaction_faces_enabled\":true,\"is_personal_mode\":false,\"plans\":[{\"id\":\"yearly150usd\",\"object\":\"plan\",\"active\":true,\"aggregate_usage\":null,\"amount\":15000,\"amount_decimal\":\"15000\",\"billing_scheme\":\"per_unit\",\"created\":1740157269,\"currency\":\"usd\",\"interval\":\"year\",\"interval_count\":1,\"livemode\":true,\"metadata\":{\"substack\":\"yes\"},\"meter\":null,\"nickname\":\"$150 a year\",\"product\":\"prod_RocqCGIVz6JJn4\",\"tiers\":null,\"tiers_mode\":null,\"transform_usage\":null,\"trial_period_days\":null,\"usage_type\":\"licensed\",\"currency_options\":{\"aud\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":23000,\"unit_amount_decimal\":\"23000\"},\"brl\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":80000,\"unit_amount_decimal\":\"80000\"},\"cad\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":21000,\"unit_amount_decimal\":\"21000\"},\"chf\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":12000,\"unit_amount_decimal\":\"12000\"},\"dkk\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":95500,\"unit_amount_decimal\":\"95500\"},\"eur\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":13000,\"unit_amount_decimal\":\"13000\"},\"gbp\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":11500,\"unit_amount_decimal\":\"11500\"},\"mxn\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":275000,\"unit_amount_decimal\":\"275000\"},\"nok\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":150000,\"unit_amount_decimal\":\"150000\"},\"nzd\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":26000,\"unit_amount_decimal\":\"26000\"},\"pln\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":55000,\"unit_amount_decimal\":\"55000\"},\"sek\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":141500,\"unit_amount_decimal\":\"141500\"},\"usd\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":15000,\"unit_amount_decimal\":\"15000\"}}},{\"id\":\"monthly15usd\",\"object\":\"plan\",\"active\":true,\"aggregate_usage\":null,\"amount\":1500,\"amount_decimal\":\"1500\",\"billing_scheme\":\"per_unit\",\"created\":1740157269,\"currency\":\"usd\",\"interval\":\"month\",\"interval_count\":1,\"livemode\":true,\"metadata\":{\"substack\":\"yes\"},\"meter\":null,\"nickname\":\"$15 a month\",\"product\":\"prod_Rocqe7CXR42ZiB\",\"tiers\":null,\"tiers_mode\":null,\"transform_usage\":null,\"trial_period_days\":null,\"usage_type\":\"licensed\",\"currency_options\":{\"aud\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":2300,\"unit_amount_decimal\":\"2300\"},\"brl\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":8000,\"unit_amount_decimal\":\"8000\"},\"cad\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":2100,\"unit_amount_decimal\":\"2100\"},\"chf\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":1200,\"unit_amount_decimal\":\"1200\"},\"dkk\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":10000,\"unit_amount_decimal\":\"10000\"},\"eur\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":1300,\"unit_amount_decimal\":\"1300\"},\"gbp\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":1200,\"unit_amount_decimal\":\"1200\"},\"mxn\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":27500,\"unit_amount_decimal\":\"27500\"},\"nok\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":15000,\"unit_amount_decimal\":\"15000\"},\"nzd\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":2600,\"unit_amount_decimal\":\"2600\"},\"pln\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":5500,\"unit_amount_decimal\":\"5500\"},\"sek\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":14500,\"unit_amount_decimal\":\"14500\"},\"usd\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":1500,\"unit_amount_decimal\":\"1500\"}}},{\"id\":\"founding30000usd\",\"name\":\"founding30000usd\",\"nickname\":\"founding30000usd\",\"active\":true,\"amount\":30000,\"currency\":\"usd\",\"interval\":\"year\",\"interval_count\":1,\"metadata\":{\"substack\":\"yes\",\"founding\":\"yes\",\"no_coupons\":\"yes\",\"short_description\":\"Founding Member\",\"short_description_english\":\"Founding Member\",\"minimum\":\"15000\",\"minimum_local\":{\"aud\":23500,\"brl\":82500,\"cad\":21500,\"chf\":12500,\"dkk\":97000,\"eur\":13000,\"gbp\":11500,\"mxn\":278000,\"nok\":152500,\"nzd\":26500,\"pln\":55500,\"sek\":143000,\"usd\":15000}},\"currency_options\":{\"aud\":{\"unit_amount\":46500,\"tax_behavior\":\"unspecified\"},\"brl\":{\"unit_amount\":165000,\"tax_behavior\":\"unspecified\"},\"cad\":{\"unit_amount\":42500,\"tax_behavior\":\"unspecified\"},\"chf\":{\"unit_amount\":24500,\"tax_behavior\":\"unspecified\"},\"dkk\":{\"unit_amount\":193500,\"tax_behavior\":\"unspecified\"},\"eur\":{\"unit_amount\":26000,\"tax_behavior\":\"unspecified\"},\"gbp\":{\"unit_amount\":23000,\"tax_behavior\":\"unspecified\"},\"mxn\":{\"unit_amount\":555500,\"tax_behavior\":\"unspecified\"},\"nok\":{\"unit_amount\":305000,\"tax_behavior\":\"unspecified\"},\"nzd\":{\"unit_amount\":52500,\"tax_behavior\":\"unspecified\"},\"pln\":{\"unit_amount\":110500,\"tax_behavior\":\"unspecified\"},\"sek\":{\"unit_amount\":286000,\"tax_behavior\":\"unspecified\"},\"usd\":{\"unit_amount\":30000,\"tax_behavior\":\"unspecified\"}}}],\"stripe_user_id\":\"acct_1QuzWnBCroqLyD5S\",\"stripe_country\":\"DE\",\"stripe_publishable_key\":\"pk_live_51QuzWnBCroqLyD5SliZtw8MVh7kd96dxMUXWmCl8BZQLaeFglv09jB4F88jg0TGPobk4TRpVNUQa7rzlAPhGntfy00pE0nx4F2\",\"stripe_platform_account\":\"US\",\"automatic_tax_enabled\":false,\"author_name\":\"Neo Kim\",\"author_handle\":\"systemdesignone\",\"author_photo_url\":\"https://substackcdn.com/image/fetch/$s_!OHOm!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc103940f-0d8b-47e7-9a33-013202e17bb8_389x389.jpeg\",\"author_bio\":\"I Teach You System Design \u2022 400K+ Audience\",\"has_custom_tos\":false,\"has_custom_privacy\":true,\"theme\":{\"background_pop_color\":\"#538cfa\",\"web_bg_color\":\"#ffffff\",\"cover_bg_color\":\"#ffffff\",\"publication_id\":1511845,\"color_links\":null,\"font_preset_heading\":\"slab\",\"font_preset_body\":\"sans\",\"font_family_headings\":null,\"font_family_body\":null,\"font_family_ui\":null,\"font_size_body_desktop\":null,\"print_secondary\":null,\"custom_css_web\":null,\"custom_css_email\":null,\"home_hero\":\"newspaper\",\"home_posts\":\"custom\",\"home_show_top_posts\":true,\"hide_images_from_list\":false,\"home_hero_alignment\":\"left\",\"home_hero_show_podcast_links\":true,\"default_post_header_variant\":null},\"threads_v2_settings\":null,\"default_group_coupon_percent_off\":\"20.00\",\"pause_return_date\":null,\"has_posts\":true,\"has_recommendations\":true,\"first_post_date\":\"2023-05-01T09:08:54.017Z\",\"has_podcast\":false,\"has_free_podcast\":false,\"has_subscriber_only_podcast\":false,\"has_community_content\":true,\"rankingDetail\":\"Hundreds of paid subscribers\",\"rankingDetailFreeIncluded\":\"Hundreds of thousands of subscribers\",\"rankingDetailOrderOfMagnitude\":100,\"rankingDetailFreeIncludedOrderOfMagnitude\":100000,\"rankingDetailFreeSubscriberCount\":\"Over 186,000 subscribers\",\"rankingDetailByLanguage\":{\"de\":{\"rankingDetail\":\"Hunderte von Paid-Abonnenten\",\"rankingDetailFreeIncluded\":\"Hunderttausende von Abonnenten\",\"rankingDetailOrderOfMagnitude\":100,\"rankingDetailFreeIncludedOrderOfMagnitude\":100000,\"rankingDetailFreeSubscriberCount\":\"\u00DCber 186,000 Abonnenten\",\"freeSubscriberCount\":\"186,000\",\"freeSubscriberCountOrderOfMagnitude\":\"186K+\"},\"es\":{\"rankingDetail\":\"Cientos de suscriptores de pago\",\"rankingDetailFreeIncluded\":\"Cientos de miles de suscriptores\",\"rankingDetailOrderOfMagnitude\":100,\"rankingDetailFreeIncludedOrderOfMagnitude\":100000,\"rankingDetailFreeSubscriberCount\":\"M\u00E1s de 186,000 suscriptores\",\"freeSubscriberCount\":\"186,000\",\"freeSubscriberCountOrderOfMagnitude\":\"186K+\"},\"fr\":{\"rankingDetail\":\"Des centaines d'abonn\u00E9s payants\",\"rankingDetailFreeIncluded\":\"Des centaines de milliers d'abonn\u00E9s\",\"rankingDetailOrderOfMagnitude\":100,\"rankingDetailFreeIncludedOrderOfMagnitude\":100000,\"rankingDetailFreeSubscriberCount\":\"Plus de 186,000 abonn\u00E9s\",\"freeSubscriberCount\":\"186,000\",\"freeSubscriberCountOrderOfMagnitude\":\"186K+\"},\"pt\":{\"rankingDetail\":\"Centenas de subscritores pagos\",\"rankingDetailFreeIncluded\":\"Centenas de milhares de subscritores\",\"rankingDetailOrderOfMagnitude\":100,\"rankingDetailFreeIncludedOrderOfMagnitude\":100000,\"rankingDetailFreeSubscriberCount\":\"Mais de 186,000 subscritores\",\"freeSubscriberCount\":\"186,000\",\"freeSubscriberCountOrderOfMagnitude\":\"186K+\"},\"pt-br\":{\"rankingDetail\":\"Centenas de assinantes pagantes\",\"rankingDetailFreeIncluded\":\"Centenas de milhares de assinantes\",\"rankingDetailOrderOfMagnitude\":100,\"rankingDetailFreeIncludedOrderOfMagnitude\":100000,\"rankingDetailFreeSubscriberCount\":\"Mais de 186,000 assinantes\",\"freeSubscriberCount\":\"186,000\",\"freeSubscriberCountOrderOfMagnitude\":\"186K+\"},\"it\":{\"rankingDetail\":\"Centinaia di abbonati a pagamento\",\"rankingDetailFreeIncluded\":\"Centinaia di migliaia di abbonati\",\"rankingDetailOrderOfMagnitude\":100,\"rankingDetailFreeIncludedOrderOfMagnitude\":100000,\"rankingDetailFreeSubscriberCount\":\"Oltre 186,000 abbonati\",\"freeSubscriberCount\":\"186,000\",\"freeSubscriberCountOrderOfMagnitude\":\"186K+\"},\"en\":{\"rankingDetail\":\"Hundreds of paid subscribers\",\"rankingDetailFreeIncluded\":\"Hundreds of thousands of subscribers\",\"rankingDetailOrderOfMagnitude\":100,\"rankingDetailFreeIncludedOrderOfMagnitude\":100000,\"rankingDetailFreeSubscriberCount\":\"Over 186,000 subscribers\",\"freeSubscriberCount\":\"186,000\",\"freeSubscriberCountOrderOfMagnitude\":\"186K+\"}},\"freeSubscriberCount\":\"186,000\",\"freeSubscriberCountOrderOfMagnitude\":\"186K+\",\"author_bestseller_tier\":100,\"disable_monthly_subscriptions\":false,\"disable_annual_subscriptions\":false,\"hide_post_restacks\":false,\"notes_feed_enabled\":false,\"showIntroModule\":false,\"last_chat_post_at\":null,\"primary_profile_name\":\"Neo Kim\",\"primary_profile_photo_url\":\"https://substackcdn.com/image/fetch/$s_!OHOm!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc103940f-0d8b-47e7-9a33-013202e17bb8_389x389.jpeg\",\"no_follow\":false,\"paywall_chat\":\"free\",\"sections\":[],\"multipub_migration\":null,\"navigationBarItems\":[{\"id\":\"0c9f8d1d-5c6b-48e5-b500-69f2eee738d1\",\"publication_id\":1511845,\"sibling_rank\":0,\"link_title\":null,\"link_url\":null,\"section_id\":null,\"post_id\":null,\"is_hidden\":true,\"standard_key\":\"notes\",\"post_tag_id\":null,\"section\":null,\"postTag\":null,\"post\":null},{\"id\":\"7f3a36b0-ceed-4b6a-907e-4cfda6733070\",\"publication_id\":1511845,\"sibling_rank\":1,\"link_title\":null,\"link_url\":null,\"section_id\":null,\"post_id\":null,\"is_hidden\":true,\"standard_key\":\"archive\",\"post_tag_id\":null,\"section\":null,\"postTag\":null,\"post\":null},{\"id\":\"4c5a3ce8-7bdf-43eb-9f7a-1e0509867ea0\",\"publication_id\":1511845,\"sibling_rank\":2,\"link_title\":null,\"link_url\":null,\"section_id\":null,\"post_id\":null,\"is_hidden\":true,\"standard_key\":\"leaderboard\",\"post_tag_id\":null,\"section\":null,\"postTag\":null,\"post\":null},{\"id\":\"fcde32f0-ca86-4804-ade1-54670ba8bbdf\",\"publication_id\":1511845,\"sibling_rank\":3,\"link_title\":\"Videos\",\"link_url\":\"https://www.youtube.com/@systemdesignone?sub_confirmation=1\",\"section_id\":null,\"post_id\":null,\"is_hidden\":null,\"standard_key\":null,\"post_tag_id\":null,\"section\":null,\"postTag\":null,\"post\":null},{\"id\":\"0bf34205-25f1-492d-b805-d0334dfceeae\",\"publication_id\":1511845,\"sibling_rank\":4,\"link_title\":\"Sponsorship\",\"link_url\":\"\",\"section_id\":null,\"post_id\":151041158,\"is_hidden\":null,\"standard_key\":null,\"post_tag_id\":null,\"section\":null,\"postTag\":null,\"post\":{\"id\":151041158,\"publication_id\":1511845,\"is_published\":true,\"title\":\"Sponsorship\",\"body\":\"s3://substack-content/post/151041158/2025-10-06T06-11-28-322Z/135589200/2d31b82ed6ed64fe9ae73014e2ceb483f94c8a2f\",\"slug\":\"sponsorship\",\"post_date\":\"2024-11-01T18:52:14.362Z\",\"draft_title\":\"Sponsorship\",\"draft_body\":\"s3://substack-content/post/151041158/2025-10-06T06-11-28-322Z/135589200/2d31b82ed6ed64fe9ae73014e2ceb483f94c8a2f\",\"draft_updated_at\":\"2025-10-06T06:11:28.395Z\",\"subtitle\":\"\",\"draft_subtitle\":\"\",\"email_sent_at\":null,\"audience\":\"everyone\",\"type\":\"page\",\"podcast_url\":\"\",\"draft_podcast_url\":\"\",\"podcast_duration\":null,\"draft_podcast_duration\":null,\"podcast_art_url\":null,\"podcast_description\":null,\"podcast_subtitle\":null,\"explicit\":null,\"podcast_content\":null,\"podcast_guid\":null,\"social_title\":null,\"description\":null,\"cover_image\":null,\"imported_podcast_url\":null,\"imported_podcast_art_url\":null,\"uuid\":\"695b30ce-056d-4cab-8ec9-c18ef5088b85\",\"write_comment_permissions\":\"everyone\",\"should_send_email\":false,\"default_comment_sort\":null,\"search_engine_title\":null,\"search_engine_description\":null,\"updated_at\":\"2025-10-06T06:11:42.586Z\",\"canonical_url\":null,\"subscriber_set_id\":null,\"section_id\":null,\"section_chosen\":false,\"draft_section_id\":null,\"show_guest_bios\":true,\"reply_to_post_id\":null,\"should_send_free_preview\":false,\"word_count\":69,\"video_upload_id\":null,\"draft_video_upload_id\":null,\"draft_created_at\":\"2024-11-01T18:43:05.445Z\",\"podcast_upload_id\":null,\"draft_podcast_upload_id\":null,\"voiceover_upload_id\":null,\"draft_voiceover_upload_id\":null,\"free_unlock_required\":false,\"podcast_preview_upload_id\":null,\"draft_podcast_preview_upload_id\":null,\"legacy_podcast_file_size\":null,\"syndicate_voiceover_to_rss\":false,\"audience_before_archived\":null,\"should_send_stats_email\":true,\"exempt_from_archive_paywall\":false,\"has_explicit_paywall\":false,\"inbox_sent_at\":null,\"editor_v2\":false,\"teaser_post_eligible\":true,\"has_dismissed_tk_warning\":false,\"live_stream_id\":null,\"is_draft_hidden\":false,\"meter_type\":\"none\"}}],\"contributors\":[{\"name\":\"Neo Kim\",\"handle\":\"systemdesignone\",\"role\":\"admin\",\"owner\":true,\"user_id\":135589200,\"photo_url\":\"https://substack-post-media.s3.amazonaws.com/public/images/c103940f-0d8b-47e7-9a33-013202e17bb8_389x389.jpeg\",\"bio\":\"I Teach You System Design \u2022 400K+ Audience\"}],\"threads_v2_enabled\":false,\"viralGiftsConfig\":{\"id\":\"99492004-2084-48c8-a7eb-92a449d46f9f\",\"publication_id\":1511845,\"enabled\":true,\"gifts_per_user\":5,\"gift_length_months\":1,\"send_extra_gifts\":true,\"message\":\"https://systemdesign.one/ substack\",\"created_at\":\"2023-04-22T17:54:44.697914+00:00\",\"updated_at\":\"2023-04-22T17:54:44.697914+00:00\",\"days_til_invite\":14,\"send_emails\":true,\"show_link\":null,\"grant_email_body\":\"{\\\"type\\\":\\\"doc\\\",\\\"content\\\":[{\\\"type\\\":\\\"paragraph\\\",\\\"content\\\":[{\\\"type\\\":\\\"text\\\",\\\"text\\\":\\\"Dear reader,\\\"}]},{\\\"type\\\":\\\"paragraph\\\",\\\"content\\\":[{\\\"type\\\":\\\"text\\\",\\\"text\\\":\\\"Thank you for being a part of the system design newsletter. As a paying subscriber, you\u2019ve helped make the system design newsletter what it is today.\\\"}]},{\\\"type\\\":\\\"paragraph\\\",\\\"content\\\":[{\\\"type\\\":\\\"text\\\",\\\"text\\\":\\\"As a thank you, you now have three FREE 1-month gift subscriptions to give to family and friends. Know someone who might love the system design newsletter? Click on the link below to share one of your gift subscriptions with them:\\\"}]},{\\\"type\\\":\\\"button\\\",\\\"attrs\\\":{\\\"url\\\":\\\"%%grant_gift_url%%\\\",\\\"text\\\":\\\"Give a subscription\\\",\\\"action\\\":null,\\\"class\\\":\\\"left\\\"}},{\\\"type\\\":\\\"paragraph\\\",\\\"content\\\":[{\\\"type\\\":\\\"text\\\",\\\"text\\\":\\\"Thanks again for reading and sharing the system design newsletter!\\\"}]}]}\",\"grant_email_subject\":\"System design newsletter subscriptions for you to give away\"},\"tier\":2,\"no_index\":false,\"can_set_google_site_verification\":true,\"can_have_sitemap\":true,\"draft_iap_advanced_plans\":[{\"sku\":\"bAGiKVpG3T0tz8i8Gt\",\"publication_id\":\"1511845\",\"is_active\":true,\"price_base_units\":2100,\"currency_alpha3\":\"usd\",\"period\":\"month\",\"created_at\":\"2025-08-18T15:14:31.772Z\",\"updated_at\":\"2025-08-18T15:14:31.772Z\",\"id\":\"242362\",\"payout_amount_base_units\":150,\"alternate_currencies\":{\"aud\":3300,\"brl\":11500,\"cad\":3000,\"chf\":1700,\"dkk\":13500,\"eur\":1800,\"gbp\":1600,\"mxn\":39500,\"nok\":21500,\"nzd\":3600,\"pln\":8000,\"sek\":20500},\"display_name\":\"The System Design Newsletter (Monthly)\",\"display_price\":\"$21\"},{\"sku\":\"KyRr3mPBseaPpfwQUT\",\"publication_id\":\"1511845\",\"is_active\":true,\"price_base_units\":20500,\"currency_alpha3\":\"usd\",\"period\":\"year\",\"created_at\":\"2025-08-18T15:14:31.782Z\",\"updated_at\":\"2025-08-18T15:14:31.782Z\",\"id\":\"242363\",\"payout_amount_base_units\":1500,\"alternate_currencies\":{\"aud\":31500,\"brl\":111000,\"cad\":28500,\"chf\":17000,\"dkk\":131000,\"eur\":17500,\"gbp\":15500,\"mxn\":384000,\"nok\":208500,\"nzd\":35000,\"pln\":75000,\"sek\":196000},\"display_name\":\"The System Design Newsletter (Yearly)\",\"display_price\":\"$205\"}],\"iap_advanced_plans\":[{\"sku\":\"bAGiKVpG3T0tz8i8Gt\",\"publication_id\":\"1511845\",\"is_active\":true,\"price_base_units\":2100,\"currency_alpha3\":\"usd\",\"period\":\"month\",\"created_at\":\"2025-08-18T15:14:31.772Z\",\"updated_at\":\"2025-08-18T15:14:31.772Z\",\"id\":\"242362\",\"payout_amount_base_units\":150,\"alternate_currencies\":{\"aud\":3300,\"brl\":11500,\"cad\":3000,\"chf\":1700,\"dkk\":13500,\"eur\":1800,\"gbp\":1600,\"mxn\":39500,\"nok\":21500,\"nzd\":3600,\"pln\":8000,\"sek\":20500},\"display_name\":\"The System Design Newsletter (Monthly)\",\"display_price\":\"$21\"},{\"sku\":\"KyRr3mPBseaPpfwQUT\",\"publication_id\":\"1511845\",\"is_active\":true,\"price_base_units\":20500,\"currency_alpha3\":\"usd\",\"period\":\"year\",\"created_at\":\"2025-08-18T15:14:31.782Z\",\"updated_at\":\"2025-08-18T15:14:31.782Z\",\"id\":\"242363\",\"payout_amount_base_units\":1500,\"alternate_currencies\":{\"aud\":31500,\"brl\":111000,\"cad\":28500,\"chf\":17000,\"dkk\":131000,\"eur\":17500,\"gbp\":15500,\"mxn\":384000,\"nok\":208500,\"nzd\":35000,\"pln\":75000,\"sek\":196000},\"display_name\":\"The System Design Newsletter (Yearly)\",\"display_price\":\"$205\"}],\"founding_plan_name_english\":\"Founding Member\",\"draft_plans\":[{\"id\":\"yearly150usd\",\"object\":\"plan\",\"active\":true,\"aggregate_usage\":null,\"amount\":15000,\"amount_decimal\":\"15000\",\"billing_scheme\":\"per_unit\",\"created\":1740157269,\"currency\":\"usd\",\"interval\":\"year\",\"interval_count\":1,\"livemode\":true,\"metadata\":{\"substack\":\"yes\"},\"meter\":null,\"nickname\":\"$150 a year\",\"product\":\"prod_RocqCGIVz6JJn4\",\"tiers\":null,\"tiers_mode\":null,\"transform_usage\":null,\"trial_period_days\":null,\"usage_type\":\"licensed\",\"currency_options\":{\"aud\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":23000,\"unit_amount_decimal\":\"23000\"},\"brl\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":80000,\"unit_amount_decimal\":\"80000\"},\"cad\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":21000,\"unit_amount_decimal\":\"21000\"},\"chf\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":12000,\"unit_amount_decimal\":\"12000\"},\"dkk\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":95500,\"unit_amount_decimal\":\"95500\"},\"eur\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":13000,\"unit_amount_decimal\":\"13000\"},\"gbp\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":11500,\"unit_amount_decimal\":\"11500\"},\"mxn\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":275000,\"unit_amount_decimal\":\"275000\"},\"nok\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":150000,\"unit_amount_decimal\":\"150000\"},\"nzd\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":26000,\"unit_amount_decimal\":\"26000\"},\"pln\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":55000,\"unit_amount_decimal\":\"55000\"},\"sek\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":141500,\"unit_amount_decimal\":\"141500\"},\"usd\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":15000,\"unit_amount_decimal\":\"15000\"}}},{\"id\":\"monthly15usd\",\"object\":\"plan\",\"active\":true,\"aggregate_usage\":null,\"amount\":1500,\"amount_decimal\":\"1500\",\"billing_scheme\":\"per_unit\",\"created\":1740157269,\"currency\":\"usd\",\"interval\":\"month\",\"interval_count\":1,\"livemode\":true,\"metadata\":{\"substack\":\"yes\"},\"meter\":null,\"nickname\":\"$15 a month\",\"product\":\"prod_Rocqe7CXR42ZiB\",\"tiers\":null,\"tiers_mode\":null,\"transform_usage\":null,\"trial_period_days\":null,\"usage_type\":\"licensed\",\"currency_options\":{\"aud\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":2300,\"unit_amount_decimal\":\"2300\"},\"brl\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":8000,\"unit_amount_decimal\":\"8000\"},\"cad\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":2100,\"unit_amount_decimal\":\"2100\"},\"chf\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":1200,\"unit_amount_decimal\":\"1200\"},\"dkk\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":10000,\"unit_amount_decimal\":\"10000\"},\"eur\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":1300,\"unit_amount_decimal\":\"1300\"},\"gbp\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":1200,\"unit_amount_decimal\":\"1200\"},\"mxn\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":27500,\"unit_amount_decimal\":\"27500\"},\"nok\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":15000,\"unit_amount_decimal\":\"15000\"},\"nzd\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":2600,\"unit_amount_decimal\":\"2600\"},\"pln\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":5500,\"unit_amount_decimal\":\"5500\"},\"sek\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":14500,\"unit_amount_decimal\":\"14500\"},\"usd\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":1500,\"unit_amount_decimal\":\"1500\"}}},{\"id\":\"founding30000usd\",\"name\":\"founding30000usd\",\"nickname\":\"founding30000usd\",\"active\":true,\"amount\":30000,\"currency\":\"usd\",\"interval\":\"year\",\"interval_count\":1,\"metadata\":{\"substack\":\"yes\",\"founding\":\"yes\",\"no_coupons\":\"yes\",\"short_description\":\"Founding Member\",\"short_description_english\":\"Founding Member\",\"minimum\":\"15000\",\"minimum_local\":{\"aud\":23500,\"brl\":82500,\"cad\":21500,\"chf\":12500,\"dkk\":97000,\"eur\":13000,\"gbp\":11500,\"mxn\":278000,\"nok\":152500,\"nzd\":26500,\"pln\":55500,\"sek\":143000,\"usd\":15000}},\"currency_options\":{\"aud\":{\"unit_amount\":46500,\"tax_behavior\":\"unspecified\"},\"brl\":{\"unit_amount\":165000,\"tax_behavior\":\"unspecified\"},\"cad\":{\"unit_amount\":42500,\"tax_behavior\":\"unspecified\"},\"chf\":{\"unit_amount\":24500,\"tax_behavior\":\"unspecified\"},\"dkk\":{\"unit_amount\":193500,\"tax_behavior\":\"unspecified\"},\"eur\":{\"unit_amount\":26000,\"tax_behavior\":\"unspecified\"},\"gbp\":{\"unit_amount\":23000,\"tax_behavior\":\"unspecified\"},\"mxn\":{\"unit_amount\":555500,\"tax_behavior\":\"unspecified\"},\"nok\":{\"unit_amount\":305000,\"tax_behavior\":\"unspecified\"},\"nzd\":{\"unit_amount\":52500,\"tax_behavior\":\"unspecified\"},\"pln\":{\"unit_amount\":110500,\"tax_behavior\":\"unspecified\"},\"sek\":{\"unit_amount\":286000,\"tax_behavior\":\"unspecified\"},\"usd\":{\"unit_amount\":30000,\"tax_behavior\":\"unspecified\"}}}],\"base_url\":\"https://newsletter.systemdesign.one\",\"hostname\":\"newsletter.systemdesign.one\",\"is_on_substack\":false,\"spotify_podcast_settings\":null,\"podcastPalette\":{\"DarkMuted\":{\"population\":72,\"rgb\":[73,153,137]},\"DarkVibrant\":{\"population\":6013,\"rgb\":[4,100,84]},\"LightMuted\":{\"population\":7,\"rgb\":[142,198,186]},\"LightVibrant\":{\"population\":3,\"rgb\":[166,214,206]},\"Muted\":{\"population\":6,\"rgb\":[92,164,156]},\"Vibrant\":{\"population\":5,\"rgb\":[76,164,146]}},\"pageThemes\":{\"podcast\":null},\"appTheme\":{\"colors\":{\"accent\":{\"name\":\"#538cfa\",\"primary\":{\"r\":83,\"g\":140,\"b\":250,\"a\":1},\"primary_hover\":{\"r\":58,\"g\":122,\"b\":230,\"a\":1},\"primary_elevated\":{\"r\":58,\"g\":122,\"b\":230,\"a\":1},\"secondary\":{\"r\":83,\"g\":140,\"b\":250,\"a\":0.2},\"contrast\":{\"r\":255,\"g\":255,\"b\":255,\"a\":1},\"bg\":{\"r\":83,\"g\":140,\"b\":250,\"a\":0.2},\"bg_hover\":{\"r\":83,\"g\":140,\"b\":250,\"a\":0.3},\"dark\":{\"primary\":{\"r\":83,\"g\":140,\"b\":250,\"a\":1},\"primary_hover\":{\"r\":107,\"g\":159,\"b\":255,\"a\":1},\"primary_elevated\":{\"r\":107,\"g\":159,\"b\":255,\"a\":1},\"secondary\":{\"r\":83,\"g\":140,\"b\":250,\"a\":0.2},\"contrast\":{\"r\":255,\"g\":255,\"b\":255,\"a\":1},\"bg\":{\"r\":83,\"g\":140,\"b\":250,\"a\":0.2},\"bg_hover\":{\"r\":83,\"g\":140,\"b\":250,\"a\":0.3}}},\"fg\":{\"primary\":{\"r\":0,\"g\":0,\"b\":0,\"a\":0.8},\"secondary\":{\"r\":0,\"g\":0,\"b\":0,\"a\":0.6},\"tertiary\":{\"r\":0,\"g\":0,\"b\":0,\"a\":0.4},\"accent\":{\"r\":45,\"g\":115,\"b\":221,\"a\":1},\"dark\":{\"primary\":{\"r\":255,\"g\":255,\"b\":255,\"a\":0.9},\"secondary\":{\"r\":255,\"g\":255,\"b\":255,\"a\":0.6},\"tertiary\":{\"r\":255,\"g\":255,\"b\":255,\"a\":0.4},\"accent\":{\"r\":83,\"g\":140,\"b\":250,\"a\":1}}},\"bg\":{\"name\":\"#ffffff\",\"hue\":{\"r\":255,\"g\":255,\"b\":255,\"a\":0},\"tint\":{\"r\":255,\"g\":255,\"b\":255,\"a\":0},\"primary\":{\"r\":255,\"g\":255,\"b\":255,\"a\":1},\"primary_hover\":{\"r\":250,\"g\":250,\"b\":250,\"a\":1},\"primary_elevated\":{\"r\":250,\"g\":250,\"b\":250,\"a\":1},\"secondary\":{\"r\":238,\"g\":238,\"b\":238,\"a\":1},\"secondary_elevated\":{\"r\":206.90096477355226,\"g\":206.90096477355175,\"b\":206.9009647735519,\"a\":1},\"tertiary\":{\"r\":219,\"g\":219,\"b\":219,\"a\":1},\"quaternary\":{\"r\":182,\"g\":182,\"b\":182,\"a\":1},\"dark\":{\"primary\":{\"r\":22,\"g\":23,\"b\":24,\"a\":1},\"primary_hover\":{\"r\":27,\"g\":28,\"b\":29,\"a\":1},\"primary_elevated\":{\"r\":27,\"g\":28,\"b\":29,\"a\":1},\"secondary\":{\"r\":35,\"g\":37,\"b\":37,\"a\":1},\"secondary_elevated\":{\"r\":41.35899397549579,\"g\":43.405356429195315,\"b\":43.40489285041963,\"a\":1},\"tertiary\":{\"r\":54,\"g\":55,\"b\":55,\"a\":1},\"quaternary\":{\"r\":90,\"g\":91,\"b\":91,\"a\":1}}}},\"cover_image\":{\"url\":\"https://substackcdn.com/image/fetch/$s_!1Tqi!,w_1200,h_400,c_pad,f_auto,q_auto:best,fl_progressive:steep,b_auto:border,b_rgb:ffffff/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fc307af20-7930-4c70-9a4b-1e800617ef9e_256x256.png\",\"height\":256,\"width\":768}},\"live_subscriber_counts\":false,\"supports_ip_content_unlock\":false,\"logoPalette\":{\"Vibrant\":{\"rgb\":[127.5,127.5,127.5],\"population\":0},\"DarkVibrant\":{\"rgb\":[66.3,66.3,66.3],\"population\":0},\"LightVibrant\":{\"rgb\":[188.7,188.7,188.7],\"population\":0},\"Muted\":{\"rgb\":[127,127,127],\"population\":148},\"DarkMuted\":{\"rgb\":[67,67,67],\"population\":134},\"LightMuted\":{\"rgb\":[188,188,188],\"population\":52}}},\"confirmedLogin\":false,\"hide_intro_popup\":false,\"block_auto_login\":false,\"domainInfo\":{\"isSubstack\":false,\"customDomain\":\"newsletter.systemdesign.one\"},\"experimentFeatures\":{},\"experimentExposures\":{},\"siteConfigs\":{\"score_upsell_email\":\"control\",\"first_chat_email_enabled\":true,\"notes_video_max_duration_minutes\":5,\"reader-onboarding-promoted-pub\":737237,\"new_commenter_approval\":false,\"pub_update_opennode_api_key\":false,\"enable_user_report_review\":true,\"zendesk_automation_cancellations\":false,\"hide_book_a_meeting_button\":false,\"mfa_action_box_enabled\":false,\"publication_max_bylines\":35,\"no_contest_charge_disputes\":false,\"feed_posts_previously_seen_weight\":0.1,\"publication_tabs_reorder\":false,\"comp_expiry_email_new_copy\":\"NONE\",\"free_unlock_required\":false,\"traffic_rule_check_enabled\":false,\"amp_emails_enabled\":false,\"enable_post_summarization\":false,\"live_stream_host_warning_message\":\"\",\"bitcoin_enabled\":false,\"minimum_ios_os_version\":\"17.0.0\",\"show_entire_square_image\":false,\"hide_subscriber_count\":false,\"publication_author_display_override\":\"\",\"ios_webview_payments_enabled\":\"control\",\"generate_pdf_tax_report\":false,\"dpn_weight_disable\":5,\"show_generic_post_importer\":false,\"enable_pledges_modal\":true,\"include_pdf_invoice\":false,\"app_upsell_after_posting_notes\":\"experiment\",\"notes_weight_watch_video\":5,\"use_post_podcast_import_batching\":true,\"enable_react_dashboard\":false,\"meetings_v1\":false,\"enable_videos_page\":false,\"exempt_from_gtm_filter\":false,\"group_sections_and_podcasts_in_menu\":false,\"boost_optin_modal_enabled\":true,\"standards_and_enforcement_features_enabled\":false,\"pub_creation_captcha_behavior\":\"risky_pubs_or_rate_limit\",\"post_blogspot_importer\":false,\"suggested_search_metadata_web_ui\":false,\"notes_weight_short_item_boost\":0.15,\"pub_tts_override\":\"default\",\"disable_monthly_subscriptions\":false,\"skip_welcome_email\":false,\"chat_reader_thread_notification_default\":false,\"scheduled_pinned_posts\":false,\"disable_redirect_outbound_utm_params\":false,\"reader_gift_referrals_enabled\":true,\"dont_show_guest_byline\":false,\"like_comments_enabled\":true,\"subscription_bar_all_debug_enabled\":false,\"temporal_livestream_ended_draft\":true,\"enable_author_note_email_toggle\":false,\"meetings_embed_publication_name\":false,\"fallback_to_archive_search_on_section_pages\":false,\"livekit_track_egress_custom_base_url\":\"http://livekit-egress-custom-recorder-participant-test.s3-website-us-east-1.amazonaws.com\",\"people_you_may_know_algorithm\":\"experiment\",\"welcome_screen_blurb_override\":\"\",\"live_stream_guest_overlay\":\"control\",\"like_posts_enabled\":true,\"twitter_player_card_enabled\":true,\"feed_promoted_user\":false,\"writer_beta_android_enable_post_editor_v2\":false,\"show_note_stats_for_all_notes\":false,\"section_specific_csv_imports_enabled\":false,\"disable_podcast_feed_description_cta\":false,\"bypass_profile_substack_logo_detection\":false,\"use_preloaded_player_sources\":false,\"enable_tiktok_oauth\":false,\"list_pruning_enabled\":false,\"facebook_connect\":false,\"opt_in_to_sections_during_subscribe\":false,\"dpn_weight_share\":2,\"underlined_colored_links\":false,\"unified_presskit_enabled\":false,\"extract_stripe_receipt_url\":false,\"enable_aligned_images\":false,\"max_image_upload_mb\":64,\"enable_android_dms_writer_beta\":false,\"threads_suggested_ios_version\":null,\"pledges_disabled\":false,\"threads_minimum_ios_version\":812,\"hide_podcast_email_setup_link\":false,\"subscribe_captcha_behavior\":\"default\",\"publication_ban_sample_rate\":0,\"grant_viral_gifts_to_gift_recipients\":\"experiment\",\"ios_enable_publication_activity_tab\":false,\"custom_themes_substack_subscribe_modal\":false,\"share_viral_gift_as_link\":\"experiment\",\"opt_in_to_sections_during_subscribe_include_main_pub_newsletter\":false,\"continue_support_cta_in_newsletter_emails\":false,\"bloomberg_syndication_enabled\":false,\"lists_enabled\":false,\"ios_feed_media_content_mode\":\"fit\",\"generated_database_maintenance_mode\":false,\"allow_document_freeze\":false,\"subscription_bar_all_debug_subdomains\":null,\"podcast_main_feed_is_firehose\":false,\"pub_app_incentive_gift\":\"\",\"no_embed_redirect\":false,\"translate_mobile_app\":false,\"customized_email_from_name_for_new_follow_emails\":\"treatment\",\"spotify_open_access_sandbox_mode\":false,\"partner_data_api_enabled\":true,\"fullstory_enabled\":false,\"chat_reply_poll_interval\":3,\"dpn_weight_follow_or_subscribe\":3,\"speaker_focus_group_shot\":\"experiment\",\"enable_reader_marketing_page\":false,\"force_pub_links_to_use_subdomain\":false,\"always_show_cookie_banner\":false,\"hide_media_download_option\":false,\"hide_post_restacks\":false,\"feed_item_source_debug_mode\":false,\"writer_beta_android_enable_post_editor\":false,\"thefp_enable_account_menu\":false,\"enable_user_status_ui\":false,\"publication_homepage_title_display_override\":\"\",\"pub_banned_word_list\":\"\",\"post_preview_highlight_byline\":false,\"4k_video\":false,\"enable_islands_section_intent_screen\":false,\"tfp_free_week_reg_wall\":false,\"post_metering_enabled\":false,\"notifications_disabled\":\"\",\"cross_post_notification_threshold\":1000,\"facebook_connect_prod_app\":true,\"feed_enable_live_streams\":false,\"force_into_pymk_ranking\":false,\"minimum_android_version\":756,\"live_stream_krisp_noise_suppression_enabled\":false,\"enable_transcription_translations\":false,\"ios_post_video_pager_alpha_enabled\":false,\"use_og_image_as_twitter_image_for_post_previews\":false,\"always_use_podcast_channel_art_as_episode_art_in_rss\":false,\"cookie_preference_middleware_enabled\":false,\"seo_tier_override\":\"NONE\",\"no_follow_links\":false,\"publisher_api_enabled\":false,\"zendesk_support_priority\":\"default\",\"enable_post_clips_stats\":false,\"enable_subscriber_referrals_awards\":true,\"ios_profile_themes_feed_permalink_enabled\":false,\"use_publication_language_for_transcription\":false,\"show_substack_funded_gifts_tooltip\":true,\"disable_ai_transcription\":false,\"thread_permalink_preview_min_ios_version\":4192,\"android_toggle_on_website_enabled\":false,\"internal_android_enable_post_editor\":false,\"edit_profile_feed_item\":false,\"updated_inbox_ui\":false,\"web_reader_podcasts_tab\":false,\"use_temporal_thumbnail_selection_workflow\":false,\"live_stream_creation_enabled\":false,\"disable_card_element_in_europe\":false,\"web_growth_item_promotion_threshold\":0,\"enable_web_typing_indicators\":false,\"web_vitals_sample_rate\":0,\"allow_live_stream_auto_takedown\":\"true\",\"search_ranker_variant\":\"control\",\"web_notes_trending_topics_enabled\":\"experiment\",\"post_advanced_search\":\"control\",\"ai_image_generation_enabled\":true,\"disable_personal_substack_initialization\":false,\"section_specific_welcome_pages\":false,\"local_payment_methods\":\"control\",\"enable_linkedin_oauth\":true,\"posts_in_rss_feed\":20,\"post_rec_endpoint\":\"\",\"publisher_dashboard_section_selector\":false,\"reader_surveys_platform_question_order\":\"36,1,4,2,3,5,6,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35\",\"ios_toggle_on_website_enabled\":false,\"login_guard_app_link_in_email\":true,\"community_moderators_enabled\":false,\"monthly_sub_is_one_off\":false,\"unread_notes_activity_digest\":\"control\",\"display_cookie_settings\":false,\"welcome_page_query_params\":false,\"enable_free_podcast_urls\":false,\"comp_expiry_emails_disabled\":false,\"enable_description_on_polls\":false,\"use_microlink_for_instagram_embeds\":false,\"post_notification_batch_delay_ms\":30000,\"free_signup_confirmation_behavior\":\"with_email_validation\",\"ios_post_stats_for_admins\":false,\"live_stream_concurrent_viewer_count_drawer\":false,\"use_livestream_post_media_composition\":true,\"section_specific_preambles\":false,\"android_live_stream_multihost_enabled\":false,\"show_menu_on_posts\":false,\"app_upsell_follow_prompt\":\"control\",\"ios_post_subscribe_web_routing\":true,\"opt_into_all_trending_topics\":false,\"ios_writer_stats_public_launch_v2\":false,\"min_size_for_phishing_check\":1,\"enable_android_post_stats\":false,\"ios_chat_revamp_enabled\":false,\"app_onboarding_survey_email\":false,\"post_notification_batch_chunk_size\":100,\"thefp_enable_pullquote_alignment\":false,\"thefp_enable_pullquote_color\":false,\"republishing_enabled\":false,\"app_mode\":false,\"show_phone_banner\":false,\"live_stream_video_enhancer\":\"internal\",\"minimum_ios_version\":2200,\"enable_author_pages\":false,\"enable_decagon_chat\":true,\"first_month_upsell\":\"control\",\"enable_fedcm\":false,\"new_user_checklist_enabled\":\"use_follower_count\",\"ios_trending_topic_note_badge\":\"experiment\",\"enable_updated_webview_checkout\":false,\"show_attached_profile_for_pub_setting\":false,\"welcome_page_update_desktop_visuals_limited\":\"experiment\",\"rss_verification_code\":\"\",\"notification_post_emails\":\"experiment\",\"ios_profile_subdomain_chips\":true,\"chat_suppress_contributor_push_option_enabled\":false,\"live_stream_invite_ttl_seconds\":600,\"feed_ranking_per_post_clip_cap\":2,\"export_hooks_enabled\":false,\"audio_encoding_bitrate\":null,\"bestseller_pub_override\":false,\"extra_seats_coupon_type\":false,\"post_subdomain_universal_links\":false,\"post_import_max_file_size\":26214400,\"notes_weight_follow\":4,\"livekit_reconnect_slate_url\":\"https://mux-livestream-assets.s3.us-east-1.amazonaws.com/custom-disconnect-slate-tall.png\",\"exclude_from_pymk_suggestions\":false,\"disable_annual_subscriptions\":false,\"enable_android_dms\":false,\"feed_ranker_use_user_comment_reaction_cache\":true,\"pub_auto_moderation_enabled\":false,\"disable_live_stream_ai_trimming_by_default\":false,\"recipes_enabled\":false,\"disable_deletion\":false,\"ios_default_coupon_enabled\":false,\"notes_weight_read_post\":5,\"notes_weight_reply\":3,\"livekit_egress_custom_base_url\":\"http://livekit-egress-custom-recorder.s3-website-us-east-1.amazonaws.com\",\"clip_focused_video_upload_flow\":false,\"live_stream_max_guest_users\":2,\"enable_video_seo_data\":false,\"can_reimport_unsubscribed_users_with_2x_optin\":false,\"feed_posts_weight_subscribed\":0,\"included_in_demo_feed\":false,\"live_event_mixin\":\"\",\"review_incoming_email\":\"default\",\"app_install_prompts\":\"native_banner_if_supported\",\"enable_founding_gifts\":false,\"ios_chat_uikit\":false,\"enable_sponsorship_campaigns\":false,\"thread_permalink_preview_min_android_version\":2037,\"enable_post_to_post_link_data_event\":false,\"direct_to_app_sources_enabled\":false,\"enable_fp_new_events_page\":false,\"default_thumbnail_time\":10,\"pub_ranking_weight_immediate_engagement\":1,\"pub_ranking_weight_retained_engagement\":1,\"load_test_unichat\":false,\"notes_read_post_baseline\":0,\"live_stream_head_alignment_guide\":false,\"show_open_post_as_pdf_button\":false,\"free_press_combo_subscribe_flow_enabled\":false,\"restack_with_image\":false,\"free_press_tabbed_subscribe_flow\":\"control\",\"gift_from_substack_modal\":\"experiment\",\"ios_trending_topics_feed_item_v2\":\"control\",\"gifts_from_substack_feature_available\":true,\"disable_ai_clips\":false,\"thefp_enable_web_livestream_kicking\":false,\"enable_elevenlabs_voiceovers\":false,\"growth_sources_all_time\":false,\"android_upgrade_alert_dialog\":true,\"headline_testing_enabled\":true,\"translated_notifications_enabled\":false,\"show_simple_post_editor\":false,\"enable_live_stream_auto_publish_flow\":true,\"search_ranker_query_augmentation\":\"enabled\",\"enable_publication_podcasts_page\":false,\"ios_payment_connection_enabled\":true,\"app_install_reminder_email\":\"experiment\",\"thefp_enable_dynamic_toaster\":false,\"thefp_enable_america_250\":true,\"ios_note_composer_settings_enabled\":false,\"android_v2_post_video_player_enabled\":false,\"enable_direct_message_request_bypass\":false,\"enable_apple_news_sync\":false,\"postsById_batch_size\":20,\"free_press_newsletter_promo_enabled\":false,\"enable_ios_livestream_stats\":false,\"disable_live_stream_reactions\":false,\"enable_high_follower_dm\":true,\"ios_welcome_video_profile_prompt\":false,\"clip_generation_3rd_party_vendor\":\"internal\",\"ios_notification_settings_enabled\":false,\"tone_down_sidebar_livestreams\":false,\"notes_weight_negative\":1,\"ios_discover_tab_min_installed_date\":\"2025-06-09T16:56:58+0000\",\"notes_weight_click_see_more\":2,\"enable_publish_youtube_connect_repeat_upsell\":false,\"edit_profile_theme_colors\":false,\"backend_enable_subscription_bar\":true,\"disable_clipping_for_readers\":false,\"android_enable_subscription_bar\":false,\"apple_fee_percent\":15,\"allow_anonymous_personal_pub_creation\":false,\"feed_posts_weight_reply\":3,\"feed_posts_weight_negative\":5,\"feed_posts_weight_like\":1.5,\"feed_posts_weight_share\":3,\"feed_posts_weight_save\":3,\"enable_press_kit_preview_modal\":false,\"dpn_weight_tap_clickbait_penalty\":0.5,\"feed_posts_weight_sign_up\":4,\"live_stream_video_degradation_preference\":\"maintainFramerate\",\"pause_app_badges\":false,\"android_enable_publication_activity_tab\":false,\"thefp_paywall_with_plans\":\"experiment\",\"notes_weight_like\":2,\"profile_feed_expanded_inventory\":false,\"phone_verification_fallback_to_twilio\":false,\"livekit_mux_latency_mode\":\"low\",\"feed_posts_weight_long_click\":1,\"feed_juiced_user\":0,\"vertical_video_player_in_feed_1\":\"experiment\",\"show_branded_intro_setting\":true,\"free_press_single_screen_subscribe_flow_enabled\":false,\"notes_click_see_more_baseline\":0.35,\"android_edit_user_links\":true,\"android_move_feed_tabs\":false,\"android_enable_user_status_ui\":false,\"use_advanced_commerce_api_for_iap\":false,\"skip_free_preview_language_in_podcast_notes\":false,\"larger_wordmark_on_publication_homepage\":false,\"video_editor_full_screen\":false,\"enable_mobile_stats_for_admins\":false,\"ios_profile_themes_note_composer_enabled\":false,\"reduce_post_search_fuzziness\":\"treatment\",\"related_posts_web\":\"experiment\",\"notes_weight_click_item\":3,\"notes_weight_long_visit\":1,\"bypass_single_unlock_token_limit\":false,\"notes_watch_video_baseline\":0.08,\"add_section_and_tag_metadata\":false,\"daily_promoted_notes_enabled\":true,\"feed_ranker_use_user_feed_restack_comment_cache\":true,\"enable_islands_cms\":false,\"enable_livestream_combined_stats\":false,\"ios_social_subgroups_enabled\":false,\"enable_drip_campaigns\":false,\"ios_offline_mode_enabled\":false,\"post_management_search_engine\":\"elasticsearch\",\"new_bestseller_leaderboard_feed_item_enabled\":false,\"feed_main_disabled\":false,\"enable_account_settings_revamp\":false,\"allowed_email_domains\":\"one\",\"thefp_enable_fp_recirc_block\":false,\"ios_web_subscription_payments\":\"experiment\",\"ios_full_search_results\":\"control\",\"enable_debug_logs_ios\":false,\"show_pub_content_on_profile_for_pub_id\":0,\"web_badge_popover_treatment\":\"lottie\",\"show_pub_content_on_profile\":false,\"livekit_track_egress\":true,\"video_tab_mixture_pattern\":\"npnnnn\",\"enable_theme_contexts\":false,\"onboarding_suggestions_search\":\"experiment\",\"feed_tuner_enabled\":false,\"livekit_mux_latency_mode_rtmp\":\"low\",\"notes_weight_follow_boost\":3,\"fcm_high_priority\":false,\"subscription_bar_top_selection_strategy_v2\":\"destination_wau_pub_score\",\"search_ranker_load_test_pct\":0,\"iap_announcement_blog_url\":\"\",\"android_onboarding_progress_persistence\":\"control\",\"dpn_weight_tap_bonus_subscribed\":3,\"ios_custom_buttons_enabled\":true,\"ios_livestream_feedback\":false,\"founding_plan_upgrade_warning\":false,\"suggested_search_ranking_v1\":\"control\",\"ios_iap_opt_out_enabled\":false,\"skip_kafka_retry_messages\":false,\"related_notes_variations\":\"control\",\"android_view_post_share_assets_employees_only\":false,\"thefp_show_fixed_footer_paywall\":false,\"android_subscription_queue_experiment\":\"experiment\",\"ios_viral_gift_entry_points\":\"treatment\",\"ios_post_video_pager_enabled_v2\":\"experiment\",\"render_high_quality_clips\":true,\"ios_subscription_pogs\":\"experiment\",\"dpn_weight_like\":3,\"direct_device_push_notifications_ios\":\"experiment\",\"use_elasticsearch_for_category_tabs\":\"control\",\"android_enable_edit_profile_theme\":false,\"android_enable_view_profile_theme\":false,\"enable_refresh_token_deduplication\":true,\"dpn_weight_follow\":3,\"live_stream_audio_enhancer_v2\":\"auphonic\",\"dpn_weight_reply\":2.5,\"get_app_pill_welcome_page\":\"experiment\",\"enable_speaker_focus_clips\":true,\"dpn_subscribed_following_title\":\"experiment\",\"search_ranker_load_test_ranking_window\":2000,\"ios_new_post_sharing_flow_enabled\":false,\"profile_feed_expanded_inventory_experiment_driven\":\"control\",\"ignore_video_in_notes_length_limit\":false,\"web_show_scores_on_sports_tab\":false,\"notes_weight_click_share\":3,\"direct_device_push_notifications\":false,\"allow_long_videos\":true,\"enable_livestream_rtmp_invites\":true,\"dpn_score_threshold\":0,\"thefp_enable_follow_module\":false,\"publication_user_invite_tier_2_only\":false,\"dpn_weight_follow_bonus\":0.5,\"ios_post_subscribe_follow_related\":\"control\",\"use_intro_clip_and_branded_intro_by_default\":false,\"publisher_banner\":\"\",\"new_user_subscribe_follow_prompt_override\":\"none\",\"dpn_weight_open\":2.5,\"ios_subscription_pogs_new_users\":\"experiment\",\"ios_subscription_pogs_old_users\":\"experiment\",\"android_subscription_queue_experiment_2\":\"experiment\",\"enable_viewing_all_livestream_viewers\":false,\"tabbed_notes_search\":\"control\",\"enable_clip_prompt_variant_filtering\":true,\"dpn_ranking_enabled\":true,\"sequential_retrieval_model_pct\":100,\"dpn_model_variant\":\"experiment\",\"add_byline_by_user_id_tier_2_only\":false,\"enable_outlier_subscriber_activity_item\":true,\"dpn_weight_long_session\":2.5,\"dpn_suggested_content_title\":\"control\",\"enable_dashboard_data_callout\":true,\"speaker_focus_hls_usage_enabled\":true,\"ios_reader_post_sharing_flow\":\"control\",\"dpn_weight_tap\":3,\"live_stream_in_trending_topic_overrides\":\"\",\"android_vertical_post_player\":\"control\",\"enable_notes_admins\":false,\"ios_post_embed_card_enabled\":true,\"enable_suggested_searches\":true,\"search_retrieval_variant\":\"control\",\"android_synchronous_push_notif_handling\":\"control\",\"a24_redemption_link\":\"\",\"android_vertical_post_player_2\":\"experiment\",\"suggested_search_metadata_web_market_ui\":false,\"dpn_weight_restack\":2,\"session_version_invalidation_enabled\":false,\"dpn_weight_negative\":1,\"forced_featured_topic_id\":\"\"},\"publicationSettings\":{\"block_ai_crawlers\":false,\"credit_token_enabled\":false,\"custom_tos_and_privacy\":false,\"did_identity\":null,\"disable_optimistic_bank_payments\":false,\"display_welcome_page_details\":true,\"enable_meetings\":false,\"payment_pledges_enabled\":true,\"enable_post_page_conversion\":true,\"enable_prev_next_nav\":true,\"enable_restacking\":false,\"gifts_from_substack_disabled\":false,\"google_analytics_4_token\":\"G-99PY3XXQY0\",\"group_sections_and_podcasts_in_menu_enabled\":false,\"live_stream_homepage_visibility\":\"contributorsAndAdmins\",\"live_stream_homepage_style\":\"autoPlay\",\"medium_length_description\":\"Weekly newsletter to help busy engineers become good at system design\",\"notes_feed_enabled\":false,\"paywall_unlock_tokens\":false,\"post_preview_crop_gravity\":\"center\",\"reader_referrals_enabled\":true,\"reader_referrals_leaderboard_enabled\":true,\"seen_coming_soon_explainer\":false,\"seen_google_analytics_migration_modal\":false,\"local_currency_modal_seen\":false,\"local_payment_methods_modal_seen\":false,\"twitter_pixel_signup_event_id\":null,\"twitter_pixel_subscribe_event_id\":null,\"use_local_currency\":true,\"welcome_page_opt_out_text\":\"Not right now\",\"cookie_settings\":\"\",\"show_restacks_below_posts\":true,\"holiday_gifting_post_header\":false,\"homepage_message_text\":\"\",\"homepage_message_link\":\"\",\"about_us_author_ids\":\"\",\"archived_section_ids\":\"\",\"column_section_ids\":\"\",\"fp_primary_column_section_ids\":\"\",\"event_section_ids\":\"\",\"podcasts_metadata\":\"\",\"video_section_ids\":\"\",\"post_metering_enabled\":false},\"publicationUserSettings\":null,\"userSettings\":{\"user_id\":null,\"activity_likes_enabled\":true,\"artist_mode_enabled\":false,\"dashboard_nav_refresh_enabled\":false,\"hasDismissedSectionToNewsletterRename\":false,\"is_guest_post_enabled\":true,\"feed_web_nux_seen_at\":null,\"has_seen_select_to_restack_tooltip_nux\":false,\"invite_friends_nux_dismissed_at\":null,\"suggestions_feed_item_last_shown_at\":null,\"has_seen_select_to_restack_modal\":false,\"last_home_tab\":null,\"last_notification_alert_shown_at\":null,\"disable_reply_hiding\":false,\"newest_seen_chat_item_published_at\":null,\"explicitContentEnabled\":false,\"contactMatchingEnabled\":false,\"messageRequestLevel\":\"everyone\",\"liveStreamAcceptableInviteLevel\":\"everyone\",\"liveStreamAcceptableChatLevel\":\"everyone\",\"creditTokensTreatmentExposed\":false,\"appBadgeIncludesChat\":false,\"autoPlayVideo\":true,\"smart_delivery_enabled\":false,\"chatbotTermsLastAcceptedAt\":null,\"has_seen_notes_post_app_upsell\":false,\"substack_summer_nux_dismissed_at\":null,\"first_note_id\":null,\"show_concurrent_live_stream_viewers\":false,\"has_dismissed_fp_download_pdf_nux\":false,\"edit_profile_feed_item_dismissed_at\":null,\"mobile_permalink_app_upsell_seen_at\":null,\"new_user_checklist_enabled\":false,\"new_user_follow_subscribe_prompt_dismissed_at\":null,\"has_seen_youtube_shorts_auto_publish_announcement\":false,\"has_seen_publish_youtube_connect_upsell\":false,\"notificationQualityFilterEnabled\":true,\"hasSeenOnboardingNewslettersScreen\":false},\"subscriberCountDetails\":\"hundreds of thousands of subscribers\",\"mux_env_key\":\"u42pci814i6011qg3segrcpp9\",\"sentry_environment\":\"production\",\"launchWelcomePage\":false,\"pendingInviteForActiveLiveStream\":null,\"noIndex\":false,\"post\":{\"audience\":\"everyone\",\"audience_before_archived\":null,\"canonical_url\":\"https://newsletter.systemdesign.one/p/how-kafka-works\",\"default_comment_sort\":null,\"editor_v2\":false,\"exempt_from_archive_paywall\":false,\"free_unlock_required\":false,\"id\":174189967,\"podcast_art_url\":null,\"podcast_duration\":null,\"podcast_preview_upload_id\":null,\"podcast_upload_id\":null,\"podcast_url\":\"\",\"post_date\":\"2025-09-25T11:03:00.461Z\",\"updated_at\":\"2025-09-25T11:09:13.196Z\",\"publication_id\":1511845,\"search_engine_description\":\"Learn Everything About Apache Kafka\u2019s Architecture, Including Brokers, Kraft, Topic Partitions, Tiered Storage, Exactly Once, Kafka Connect, Kafka Schema Registry and Kafka Streams\",\"search_engine_title\":null,\"section_id\":null,\"should_send_free_preview\":false,\"show_guest_bios\":true,\"slug\":\"how-kafka-works\",\"social_title\":\"How Kafka Works\",\"subtitle\":\"#91: Learn Everything About Apache Kafka\u2019s Architecture, Including Brokers, KRaft, Topic Partitions, Tiered Storage, Exactly Once, Kafka Connect, Kafka Schema Registry and Kafka Streams\",\"teaser_post_eligible\":true,\"title\":\"How Kafka Works\",\"type\":\"newsletter\",\"video_upload_id\":null,\"write_comment_permissions\":\"everyone\",\"meter_type\":\"none\",\"live_stream_id\":null,\"is_published\":true,\"restacks\":57,\"reactions\":{\"\u2764\":356},\"top_exclusions\":[],\"pins\":[],\"section_pins\":[],\"has_shareable_clips\":false,\"previous_post_slug\":\"rate-limiting\",\"next_post_slug\":\"api-versioning\",\"cover_image\":\"https://substack-post-media.s3.amazonaws.com/public/images/f3135c16-7ad0-4de4-a4d7-483c91e84c36_1280x720.png\",\"cover_image_is_square\":false,\"cover_image_is_explicit\":false,\"videoUpload\":null,\"podcastFields\":{\"post_id\":174189967,\"podcast_episode_number\":null,\"podcast_season_number\":null,\"podcast_episode_type\":null,\"should_syndicate_to_other_feed\":null,\"syndicate_to_section_id\":null,\"hide_from_feed\":false,\"free_podcast_url\":null,\"free_podcast_duration\":null},\"podcastUpload\":null,\"podcastPreviewUpload\":null,\"voiceover_upload_id\":null,\"voiceoverUpload\":null,\"has_voiceover\":false,\"description\":\"#91: Learn Everything About Apache Kafka\u2019s Architecture, Including Brokers, KRaft, Topic Partitions, Tiered Storage, Exactly Once, Kafka Connect, Kafka Schema Registry and Kafka Streams\",\"body_html\":\"<p>Get my system design playbook for FREE on newsletter signup:</p><p class=\\\"button-wrapper\\\" data-attrs=\\\"{&quot;url&quot;:&quot;https://newsletter.systemdesign.one/subscribe?&quot;,&quot;text&quot;:&quot;Subscribe now&quot;,&quot;action&quot;:null,&quot;class&quot;:null}\\\" data-component-name=\\\"ButtonCreateButton\\\"><a class=\\\"button primary\\\" href=\\\"https://newsletter.systemdesign.one/subscribe?\\\"><span>Subscribe now</span></a></p><div><hr></div><p><em>This post outlines the Kafka architecture.</em></p><ul><li><p><em><a href=\\\"https://newsletter.systemdesign.one/p/how-kafka-works/?action=share\\\">Share this post</a> &amp; I'll send you some rewards for the referrals.</em></p></li></ul><p>Open any article about Kafka today, and you will see the same words being used to describe it:</p><blockquote><p><em>\u201CIt\u2019s an open-source, distributed, durable, very scalable, fault-tolerant pub/sub message system with rich integration and stream processing capabilities.\u201D</em></p></blockquote><p>While it\u2019s true, it isn\u2019t helpful for a novice reader being introduced to Kafka for the first time. Today, we will explain Kafka by <strong>precisely breaking down</strong> what every word in that definition means. Every definition will start with the \uD83D\uDCA1 symbol. At the end, you will have a complete high-level understanding of Apache Kafka.</p><div><hr></div><p>I want to introduce <a href=\\\"http://linkedin.com/in/stanislavkozlovski\\\">Stanislav Kozlovski</a> (\u201CThe Kafka Guy\u201D) as a guest author.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"http://linkedin.com/in/stanislavkozlovski\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!1YEl!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 424w, https://substackcdn.com/image/fetch/$s_!1YEl!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 848w, https://substackcdn.com/image/fetch/$s_!1YEl!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 1272w, https://substackcdn.com/image/fetch/$s_!1YEl!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!1YEl!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png\\\" width=\\\"1200\\\" height=\\\"630\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:630,&quot;width&quot;:1200,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:263255,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:&quot;http://linkedin.com/in/stanislavkozlovski&quot;,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!1YEl!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 424w, https://substackcdn.com/image/fetch/$s_!1YEl!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 848w, https://substackcdn.com/image/fetch/$s_!1YEl!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 1272w, https://substackcdn.com/image/fetch/$s_!1YEl!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F88c3c102-45da-4e5d-a559-5b0b14036e98_1200x630.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a></figure></div><p>He\u2019s an Apache Kafka committer and software engineer who worked at Confluent (the Kafka company) during its hypergrowth period. </p><p>Check out his newsletter and social media:</p><ul><li><p><a href=\\\"https://blog.2minutestreaming.com/\\\">2 Minute Streaming</a> (Flagship newsletter)</p></li><li><p><a href=\\\"https://bigdata.2minutestreaming.com/\\\">Big Data Stream</a></p></li><li><p><a href=\\\"http://linkedin.com/in/stanislavkozlovski\\\">LinkedIn</a></p></li><li><p><a href=\\\"https://x.com/BdKozlovski\\\">Twitter</a></p></li></ul><p>Currently, he has taken a break from engineering to consult companies and write extensively about Apache Kafka and data engineering.</p><div><hr></div><h4>Apache Kafka</h4><p>Apache Kafka is one of the most popular open-source projects in the data infrastructure space. It is a standard tool in every data engineer\u2019s catalog, used by over 70% of Fortune 500 companies and 150,000 organizations.<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-1\\\" href=\\\"#footnote-1\\\" target=\\\"_self\\\">1</a></p><p>Kafka is a messaging system that was originally developed by LinkedIn in 2010. In 2011, it was open-sourced and donated to the Apache Foundation.<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-2\\\" href=\\\"#footnote-2\\\" target=\\\"_self\\\">2</a></p><blockquote><p><strong>\uD83D\uDCA1 </strong><em><strong>open-source (1/8)</strong></em></p></blockquote><p>Today, Confluent is a public company and widely known as the company behind Kafka. It has expanded its business to offer a more complete data streaming platform on top of Kafka.</p><p>Nowadays, Kafka is more than a simple messaging system: it\u2019s a larger ecosystem of components that form a<em><strong> </strong></em><strong>streaming platform</strong><a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-3\\\" href=\\\"#footnote-3\\\" target=\\\"_self\\\">3</a>. It is frequently called the swiss army knife of data infrastructure.</p><p>Onward.</p><div><hr></div><h3><strong><a href=\\\"https://coderabbit.link/neo\\\">CodeRabbit: Free AI Code Reviews in CLI (Sponsor)</a></strong></h3><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"https://coderabbit.link/neo\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!5LSQ!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 424w, https://substackcdn.com/image/fetch/$s_!5LSQ!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 848w, https://substackcdn.com/image/fetch/$s_!5LSQ!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 1272w, https://substackcdn.com/image/fetch/$s_!5LSQ!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!5LSQ!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png\\\" width=\\\"1456\\\" height=\\\"880\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:880,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:118178,&quot;alt&quot;:&quot;CodeRabbit CLI&quot;,&quot;title&quot;:&quot;CodeRabbit CLI&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:&quot;https://coderabbit.link/neo&quot;,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/173381826?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"CodeRabbit CLI\\\" title=\\\"CodeRabbit CLI\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!5LSQ!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 424w, https://substackcdn.com/image/fetch/$s_!5LSQ!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 848w, https://substackcdn.com/image/fetch/$s_!5LSQ!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 1272w, https://substackcdn.com/image/fetch/$s_!5LSQ!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0df5bd04-5caf-4644-bf13-41d11dbf2cb3_1999x1208.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a></figure></div><p><strong><a href=\\\"https://coderabbit.link/neo\\\">CodeRabbit CLI</a></strong> is an AI code review tool that runs directly in your terminal. It provides intelligent code analysis, catches issues early, and integrates seamlessly with AI coding agents like Claude Code, Codex CLI, Cursor CLI, and Gemini to ensure your code is production-ready before it ships.</p><ul><li><p>Enables pre-commit reviews of both staged and unstaged changes, creating a multi-layered review process.</p></li><li><p>Fits into existing Git workflows. Review uncommitted changes, staged files, specific commits, or entire branches without disrupting your current development process.</p></li><li><p>Reviews specific files, directories, uncommitted changes, staged changes, or entire commits based on your needs.</p></li><li><p>Supports programming languages including JavaScript, TypeScript, Python, Java, C#, C++, Ruby, Rust, Go, PHP, and more.</p></li><li><p>Offers free AI code reviews with rate limits so developers can experience senior-level reviews at no cost.</p></li><li><p>Flags hallucinations, code smells, security issues, and performance problems.</p></li><li><p>Supports guidelines for other AI generators, AST Grep rules, and path-based instructions.</p></li></ul><p class=\\\"button-wrapper\\\" data-attrs=\\\"{&quot;url&quot;:&quot;https://coderabbit.link/neo&quot;,&quot;text&quot;:&quot;Install CodeRabbit CLI&quot;,&quot;action&quot;:null,&quot;class&quot;:&quot;button-wrapper&quot;}\\\" data-component-name=\\\"ButtonCreateButton\\\"><a class=\\\"button primary button-wrapper\\\" href=\\\"https://coderabbit.link/neo\\\"><span>Install CodeRabbit CLI</span></a></p><div><hr></div><h4>Kafka\u2019s Story</h4><p>Why did Kafka become so widely used?</p><p>It solved a very important problem - the problem of data integration at scale. LinkedIn had to connect different services to one another. A naive way of achieving this would be to create many custom point-to-point integrations (called <strong>data pipelines</strong>) between each service. That would have resulted in an <strong>O (N^2)</strong> mess that would break often and be impossible to maintain when N is in the hundreds<strong>.</strong></p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!-az8!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!-az8!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 424w, https://substackcdn.com/image/fetch/$s_!-az8!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 848w, https://substackcdn.com/image/fetch/$s_!-az8!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 1272w, https://substackcdn.com/image/fetch/$s_!-az8!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!-az8!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png\\\" width=\\\"1456\\\" height=\\\"546\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:546,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:337882,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!-az8!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 424w, https://substackcdn.com/image/fetch/$s_!-az8!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 848w, https://substackcdn.com/image/fetch/$s_!-az8!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 1272w, https://substackcdn.com/image/fetch/$s_!-az8!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F44381f1d-2081-42cf-b9b7-b1200d42284d_1999x750.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><p>Apache Kafka flips this problem on its head. Instead of creating custom pipelines per connection, it encourages organizations to:</p><ol><li><p>Store their data in a central location (Kafka)</p></li><li><p>Use a single standard API (the Kafka API)</p></li><li><p>Have applications subscribe and consume this data in real time</p></li></ol><p>This decouples writers from readers, as writers simply publish to Kafka, and readers subscribe to Kafka.</p><p>The data gets durably persisted to disk for a limited amount of time (e.g., 7 days). Kafka is ideal and was built with read-fanout use cases in mind, where the same message needs to get read by multiple systems. As such, it\u2019s common for the system\u2019s read throughput to be a multiple of its write throughput.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!xlWg!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!xlWg!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!xlWg!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!xlWg!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!xlWg!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!xlWg!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png\\\" width=\\\"1456\\\" height=\\\"801\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:801,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:142750,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!xlWg!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!xlWg!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!xlWg!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!xlWg!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F86c7c46a-ccb0-45b0-b69d-b007a8fbb270_1600x880.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><blockquote><p>\uD83D\uDCA1 <em><strong>pub-sub messaging system (2/8)</strong></em> - this is what a pub/sub messaging system is</p></blockquote><p>With Kafka, organizations don\u2019t need to maintain dozens of fragile custom point-to-point pipelines that break whenever a single VM restarts. The data can be written to Kafka once and read as many times as necessary by whatever system needs it.</p><blockquote><p>In this article, we won\u2019t talk further about the use cases of Kafka. If you\u2019re more interested in the reason behind Kafka, I recently covered in-depth why LinkedIn created Kafka. It made the front page of Hacker News.</p></blockquote><blockquote><p>\u2705 Check it out <a href=\\\"https://bigdatastream.substack.com/p/why-was-apache-kafka-created\\\">here</a>.</p></blockquote><div><hr></div><h2>The Basic Kafka Concepts</h2><p>Okay, let\u2019s dive into Kafka now! To truly understand the system, we need to start from the basics.</p><p>Let\u2019s examine its core data structure:</p><h3>The Log Data Structure</h3><p>Kafka is built upon the <a href=\\\"https://topicpartition.io/definitions/the-log\\\">simple log data structure</a>.</p><p>It is append-only; you can only add records to the end of the log (no deletes or updates allowed). Reads go from left to right, in the order the records were added.</p><p>Each record in the log has a unique monotonically increasing number called an <strong>offset</strong>. The offset refers to the record and denotes its order.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!nCew!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!nCew!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!nCew!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!nCew!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!nCew!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!nCew!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png\\\" width=\\\"1456\\\" height=\\\"819\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:819,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:273365,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!nCew!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!nCew!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!nCew!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!nCew!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F412801e6-4a1b-4311-ab1a-68fa1d42129b_1456x819.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><p>The API of the log data structure is very simple:</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!UMlg!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!UMlg!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 424w, https://substackcdn.com/image/fetch/$s_!UMlg!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 848w, https://substackcdn.com/image/fetch/$s_!UMlg!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 1272w, https://substackcdn.com/image/fetch/$s_!UMlg!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!UMlg!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png\\\" width=\\\"1456\\\" height=\\\"717\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:717,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:467748,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!UMlg!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 424w, https://substackcdn.com/image/fetch/$s_!UMlg!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 848w, https://substackcdn.com/image/fetch/$s_!UMlg!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 1272w, https://substackcdn.com/image/fetch/$s_!UMlg!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7cbb6cc7-00ab-4566-8848-3053e2baa234_1999x984.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><p>Kafka keeps the log structure on disk. The log\u2019s sequential operations work very well with HDDs. Hard drives offer very high throughput for sequential<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-4\\\" href=\\\"#footnote-4\\\" target=\\\"_self\\\">4</a> reads and writes. This differs from random reads and writes, where HDDs don\u2019t perform well.</p><h4>Records</h4><ul><li><p><em><strong>{record, message, event}</strong></em>: an entry in the log. I use these words interchangeably when describing data in Kafka.</p></li></ul><p>Each message is essentially a key-value pair; it consists of a `<code>byte[] key</code>` and a `<code>byte[] value</code>` (although other metadata like offset, timestamp, and custom headers exist too). The key is optional; it is valid for a message to only have a value.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!yFwB!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!yFwB!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 424w, https://substackcdn.com/image/fetch/$s_!yFwB!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 848w, https://substackcdn.com/image/fetch/$s_!yFwB!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 1272w, https://substackcdn.com/image/fetch/$s_!yFwB!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!yFwB!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png\\\" width=\\\"1456\\\" height=\\\"653\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/b21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:653,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:454476,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!yFwB!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 424w, https://substackcdn.com/image/fetch/$s_!yFwB!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 848w, https://substackcdn.com/image/fetch/$s_!yFwB!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 1272w, https://substackcdn.com/image/fetch/$s_!yFwB!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb21a0081-a5da-4e34-9203-7efd6d37eb1d_1999x897.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><p>The key thing to remember is that the key/value pairs are <strong>raw bytes</strong>.</p><p>Kafka does not inherently support types (e.g., int64, string, etc.) nor schemas (specific message structures).</p><p>It is the client-side code\u2019s responsibility to apply schemas:</p><ul><li><p><strong>When writing</strong>: producer clients convert (serialize) the objects into bytes.</p></li><li><p><strong>When reading</strong>: consumer clients parse (deserialize) the raw bytes from the network into the object.</p></li></ul><h3>Topics &amp; Partitions</h3><h4>Topics</h4><p>One log is not enough. You want to separate your data into categories. Just as in a database, you would create separate tables for user accounts and customer orders; in Kafka, you would create separate topics.</p><p>It\u2019s common for a Kafka cluster to have hundreds to thousands of topics.</p><h4>Partitions</h4><p>Kafka is a distributed system designed to scale much further than what a single machine can handle. As such, it uses <strong>sharding</strong>.</p><p>A topic is sharded into one or more partitions.</p><p>Each partition is a separate instance of the log data structure.</p><p>While a topic can have just one partition, it\u2019s very common for it to have dozens, since this helps with parallelization of reads (more on that later).</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!kVL_!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!kVL_!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!kVL_!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!kVL_!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!kVL_!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!kVL_!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png\\\" width=\\\"1456\\\" height=\\\"801\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/97951e01-e10d-479c-9022-840a40706cb2_1600x880.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:801,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:223569,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!kVL_!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!kVL_!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!kVL_!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!kVL_!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F97951e01-e10d-479c-9022-840a40706cb2_1600x880.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><h3>Clients &amp; The API</h3><p>Kafka doesn\u2019t use HTTP. It uses its own TCP-based protocol. This means that you need more custom code to send and receive requests; you can\u2019t just use any HTTP library.</p><p>Kafka provides its own libraries that implement the underlying protocol. The main clients you\u2019d care about are the <strong>Producer</strong> and the <strong>Consumer</strong>.</p><ul><li><p>Producer: the class that\u2019s used for writing data to Kafka</p></li><li><p>Consumer: the class that\u2019s used for reading data from Kafka</p></li></ul><p>The Apache Kafka project offers a Java library that implements these:</p><pre><code>import org.apache.kafka.clients.producer.KafkaProducer;\\n\\nimport org.apache.kafka.clients.consumer.KafkaConsumer;</code></pre><p>The Producer class allows you to <strong>send messages</strong> to a topic. You can explicitly choose the partition or allow Kafka to do it automatically for you.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!CeRS!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!CeRS!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 424w, https://substackcdn.com/image/fetch/$s_!CeRS!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 848w, https://substackcdn.com/image/fetch/$s_!CeRS!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 1272w, https://substackcdn.com/image/fetch/$s_!CeRS!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!CeRS!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png\\\" width=\\\"1456\\\" height=\\\"340\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/f802585f-fda1-4fec-8142-3331044acf43_1999x467.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:340,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:308542,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!CeRS!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 424w, https://substackcdn.com/image/fetch/$s_!CeRS!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 848w, https://substackcdn.com/image/fetch/$s_!CeRS!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 1272w, https://substackcdn.com/image/fetch/$s_!CeRS!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Ff802585f-fda1-4fec-8142-3331044acf43_1999x467.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a></figure></div><p>The Consumer, on the other hand, lets you <strong>subscribe</strong> to and<strong> read</strong> the stream of messages coming in from a topic (or specific partition):</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!JGid!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!JGid!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 424w, https://substackcdn.com/image/fetch/$s_!JGid!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 848w, https://substackcdn.com/image/fetch/$s_!JGid!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 1272w, https://substackcdn.com/image/fetch/$s_!JGid!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!JGid!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png\\\" width=\\\"1456\\\" height=\\\"690\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/bb82d66a-0863-48f2-8327-234def847299_1999x948.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:690,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:553405,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!JGid!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 424w, https://substackcdn.com/image/fetch/$s_!JGid!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 848w, https://substackcdn.com/image/fetch/$s_!JGid!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 1272w, https://substackcdn.com/image/fetch/$s_!JGid!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbb82d66a-0863-48f2-8327-234def847299_1999x948.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><p>This is simply the most important API I can show you concisely; a lot more exist. Kafka may seem simple, but it has many details to learn to be effective with it.</p><div><hr></div><h2>Kafka as a Distributed System</h2><h3>Brokers</h3><p>Apache Kafka is designed to be a <em><strong>distributed</strong></em> system - one meant to scale horizontally by adding more nodes. As such, any normal deployment of Kafka consists of at least <em><strong>three nodes</strong></em>.</p><ul><li><p><em><strong>Broker</strong></em>: an instance of the Kafka server. This is what we call a node in the system.</p></li><li><p><em><strong>Cluster</strong></em>: all the brokers in the system.</p></li></ul><blockquote><p>\uD83D\uDCA1 <em><strong>distributed (3/8)</strong></em></p></blockquote><h3>Scalability</h3><p>Kafka has a ton of interesting performance optimizations (more on this in another article). Its greatest strength is its horizontal scalability.</p><blockquote><p>\uD83D\uDCA1 <em><strong>scalable (4/8)</strong></em></p></blockquote><p>The <a href=\\\"https://topicpartition.io/definitions/the-log\\\">Log data structure</a> is key to Kafka\u2019s scalability - writes on it are O(1) and lock-free. This is because records are simply <strong>appended to the end</strong> and cannot be updated, nor individually deleted.</p><p>Messages within a partition are independent of each other. They have no higher-level guarantees like unique keys. This reduces the need for locking and allows Kafka to append to the Log structure as fast as the disk will allow.</p><p>Because each partition is a separate log, and you can add more brokers to the cluster, your scale is limited by how many brokers you can add.</p><p>Nothing theoretically stops you from having a Kafka cluster that accepts <strong>50 GiB/s of writes </strong>and then scaling it 2x to <strong>100 GiB/s</strong>.<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-5\\\" href=\\\"#footnote-5\\\" target=\\\"_self\\\">5</a></p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!2T4U!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!2T4U!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 424w, https://substackcdn.com/image/fetch/$s_!2T4U!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 848w, https://substackcdn.com/image/fetch/$s_!2T4U!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 1272w, https://substackcdn.com/image/fetch/$s_!2T4U!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!2T4U!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png\\\" width=\\\"1456\\\" height=\\\"819\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:819,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:432754,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!2T4U!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 424w, https://substackcdn.com/image/fetch/$s_!2T4U!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 848w, https://substackcdn.com/image/fetch/$s_!2T4U!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 1272w, https://substackcdn.com/image/fetch/$s_!2T4U!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F468a703f-19d0-471d-a783-efcf71bd3c18_1600x900.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><h3>Replication</h3><p>A partition in Kafka doesn\u2019t live only on one broker - it is replicated across many.</p><p>A configurable setting (called <strong>replication factor</strong>) denotes how many copies should exist. The default and most common is <strong>three</strong>.</p><p>In other words, we have three copies (called <strong>replicas</strong>) of the Log data structure. These replicas live on the disks of different brokers.</p><p>Replication is done for many reasons, one of which is data durability<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-6\\\" href=\\\"#footnote-6\\\" target=\\\"_self\\\">6</a>: when three copies of the data exist, one disk failing won\u2019t lead to data loss.</p><p>In modern cloud deployments, brokers are spread across different <a href=\\\"https://blog.2minutestreaming.com/p/basic-aws-networking-costs#:~:text=AZ%20(Availability%20Zone)%20%2D%20a%20physically%20isolated%20location%20with%20one%20or%20more%20data%20centers%2C%20inside%20a%20region\\\">availability zones</a>. This ensures very high durability and availability. Even in the unlikely event of a whole data center burning down, the Kafka cluster would still survive.</p><blockquote><p>\uD83D\uDCA1 <em><strong>durable (5/8)</strong></em></p></blockquote><h3>Leaders</h3><p>Once you start maintaining copies of data in a distributed system, you open yourself to a lot of edge cases. Keeping new data in sync is tricky. The copies must match, and the system needs to somehow agree on the latest state.</p><blockquote><p>There is a whole class of complex algorithms in computer science called <a href=\\\"https://sre.google/sre-book/managing-critical-state/\\\">distributed consensus</a>, which handle this.</p></blockquote><p>Kafka uses a straightforward single-leader replication model. At any time, one replica serves as the leader. The other two replicas act as followers (i.e., hot standbys).</p><p>Only the leader accepts new writes - it serves as the source of truth of the log. The followers actively replicate data from the leader. Reads can be served from both the leader and its followers.</p><p>When a broker node goes offline, the system notices it. Other brokers then take over the leadership of the partitions the dead broker led. This is how Kafka offers high availability.</p><blockquote><p>\uD83D\uDCA1 <em><strong>fault-tolerant (6/8)</strong></em></p></blockquote><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!v4hU!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!v4hU!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!v4hU!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!v4hU!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!v4hU!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!v4hU!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png\\\" width=\\\"1456\\\" height=\\\"801\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:801,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:203694,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!v4hU!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!v4hU!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!v4hU!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!v4hU!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F82a3d9fb-bd86-4760-83ec-8ff82edd6dd4_1600x880.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">A topic with 4 partitions and a replication factor of 3, with different brokers leading different replicas of the partitions. Brokers with follower replicas send fetch requests to the brokers with leader replicas to replicate the data</figcaption></figure></div><h3>The Metadata Log</h3><p>In a distributed system, all nodes must agree on the latest state of the cluster. Brokers must coordinate on certain metadata changes, like electing a new leader. This is again a distributed consensus problem. Because it\u2019s too complex for the purposes of introducing Kafka, we will simply gloss over how Kafka solves it.</p><p>Kafka uses a <strong>centralized coordination model</strong><a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-7\\\" href=\\\"#footnote-7\\\" target=\\\"_self\\\">7</a>. The central coordinator is none other than\u2026 <strong>a log</strong>.</p><p>Kafka durably stores all metadata changes in a special <em><strong>single-partition</strong></em> topic called <code>__cluster_metadata</code>. This storage model inherits all the benefits from topics. It gets fault-tolerance, durability, and most importantly for metadata, <strong>ordering</strong>.</p><p>Each record in the log represents a <strong>single cluster event</strong> (a delta). When replayed fully in the same order, a node can deterministically rebuild the same cluster end state.<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-8\\\" href=\\\"#footnote-8\\\" target=\\\"_self\\\">8</a><br><br>Here is a visual example of how it works in Kafka:</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!YlTG!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!YlTG!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 424w, https://substackcdn.com/image/fetch/$s_!YlTG!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 848w, https://substackcdn.com/image/fetch/$s_!YlTG!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 1272w, https://substackcdn.com/image/fetch/$s_!YlTG!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!YlTG!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png\\\" width=\\\"1456\\\" height=\\\"1001\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:212789,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!YlTG!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 424w, https://substackcdn.com/image/fetch/$s_!YlTG!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 848w, https://substackcdn.com/image/fetch/$s_!YlTG!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 1272w, https://substackcdn.com/image/fetch/$s_!YlTG!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e6ffdc5-8d48-4a57-a3f3-ae58570b3e26_1600x1100.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">A representation of how cluster events represent changes in the cluster state, and how applying one after the other results in the same end-state</figcaption></figure></div><p>In other words, the cluster metadata topic partition is the source of truth for the latest metadata in Kafka.</p><p>Every broker in the cluster is subscribed to this topic. In real time, each broker pulls the latest committed updates. When a new record is fetched, the broker applies it to its in-memory metadata. This builds the broker\u2019s idea of the latest state of the cluster.</p><p>If every broker is a follower of the partition, a natural question arises - who is the leader? What node gets to decide what new metadata is written to this partition?</p><h3>Controllers</h3><p>Controllers serve as the control plane for a Kafka cluster. They\u2019re special kinds of brokers that don\u2019t host regular topics - they only do specific cluster-management operations. Usually, you\u2019d deploy three controller brokers.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!2FVQ!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!2FVQ!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 424w, https://substackcdn.com/image/fetch/$s_!2FVQ!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 848w, https://substackcdn.com/image/fetch/$s_!2FVQ!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 1272w, https://substackcdn.com/image/fetch/$s_!2FVQ!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!2FVQ!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png\\\" width=\\\"1456\\\" height=\\\"1001\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/b25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:856249,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!2FVQ!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 424w, https://substackcdn.com/image/fetch/$s_!2FVQ!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 848w, https://substackcdn.com/image/fetch/$s_!2FVQ!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 1272w, https://substackcdn.com/image/fetch/$s_!2FVQ!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb25eae72-8faf-49ea-b094-1441e36df720_1600x1100.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">Every broker reads the __cluster_metadata log and replays the event logs to recreate the latest cluster state, regardless of whether it\u2019s a controller broker or a regular broker.</figcaption></figure></div><p>At any one time, there is only one active controller - the leader of the log. Only the active controller can write to the log. The other controllers serve as hot standbys (followers).</p><p>The active controller is responsible for making all metadata decisions in the cluster, like electing new partition leaders (when a broker dies), creating new topics, changing configs at runtime, etc.</p><p>Most importantly, it\u2019s responsible for determining broker liveness.<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-9\\\" href=\\\"#footnote-9\\\" target=\\\"_self\\\">9</a></p><p>Every broker issues <strong><a href=\\\"https://martinfowler.com/articles/patterns-of-distributed-systems/heartbeat.html\\\">heartbeats</a></strong> to the active controller. If a broker does not send heartbeats for 6 seconds straight, it is fenced off from the cluster by the controller. The controller then assigns other brokers to act as the leaders for the partitions the fenced (dead) broker led.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!PgiQ!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!PgiQ!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 424w, https://substackcdn.com/image/fetch/$s_!PgiQ!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 848w, https://substackcdn.com/image/fetch/$s_!PgiQ!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 1272w, https://substackcdn.com/image/fetch/$s_!PgiQ!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!PgiQ!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png\\\" width=\\\"1456\\\" height=\\\"1001\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:554785,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!PgiQ!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 424w, https://substackcdn.com/image/fetch/$s_!PgiQ!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 848w, https://substackcdn.com/image/fetch/$s_!PgiQ!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 1272w, https://substackcdn.com/image/fetch/$s_!PgiQ!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8b2c3903-9d0f-4f80-b2eb-32678e9f71f3_1600x1100.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><p>The careful reader will now ask:</p><blockquote><p>If the active controller is responsible for electing partition leaders, who\u2019s responsible for electing the <code>__cluster_metadata</code> leader?</p></blockquote><p>The <code>__cluster_metadata</code> partition is special. A custom distributed consensus algorithm is used to elect its leader.</p><h3>KRaft</h3><p>Leader election in a distributed system is a subset of the consensus problem. Many consensus algorithms exist, like Raft, Paxos, Zab, and so on.</p><p>Kafka uses its own <a href=\\\"https://raft.github.io/\\\">Raft</a>-inspired algorithm called KRaft (Kafka Raft).</p><p>KRaft has two key roles:</p><ol><li><p>Elect the active controller \uD83D\uDC51</p><ol><li><p>The controller nodes comprise a Raft quorum</p></li><li><p>The quorum runs a Raft election protocol to elect a leader of the <code>__cluster_metadata</code> partition. The leader of that partition is the active controller</p></li></ol></li><li><p>Agree on the latest state of the metadata log</p><ol><li><p>Metadata updates are first appended to the Raft log on the active controller.</p></li><li><p>They are marked committed only when a majority of the quorum has persisted them.</p></li></ol></li></ol><p>The active controller determines the leaders for <strong>all the other</strong> regular topic partitions. It writes it to the metadata log, and once committed by the controller quorum, the decision is set in stone.</p><p>In other words, the way leader election in Kafka works is:</p><ul><li><p>Leader election <em><strong>between the controllers</strong></em> (picking the active one) is done through a variant of Raft (KRaft)</p></li><li><p>Leader election <em><strong>between regular brokers</strong></em> is done through the controller.</p></li></ul><p>KRaft is a relatively recent algorithm in Apache Kafka. For many years, Kafka <a href=\\\"https://stanislavkozlovski.medium.com/apache-kafkas-distributed-system-firefighter-the-controller-broker-1afca1eae302\\\">used ZooKeeper</a>. Back then, there was just one controller. It performed the same tasks as today, but critically also had the responsibilities of a regular broker. Its decisions were persisted in <a href=\\\"https://en.wikipedia.org/wiki/Apache_ZooKeeper\\\">ZooKeeper</a>, which used the Zab consensus algorithm behind the scenes.</p><p>This coordinator-based leader election model differs from other systems. For example, RedPanda<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-10\\\" href=\\\"#footnote-10\\\" target=\\\"_self\\\">10</a> uses a separate Raft quorum per partition.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!_BUE!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!_BUE!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!_BUE!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!_BUE!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!_BUE!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!_BUE!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png\\\" width=\\\"1456\\\" height=\\\"801\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:801,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:1510832,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!_BUE!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 424w, https://substackcdn.com/image/fetch/$s_!_BUE!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 848w, https://substackcdn.com/image/fetch/$s_!_BUE!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 1272w, https://substackcdn.com/image/fetch/$s_!_BUE!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F24484c2c-1764-47e9-a347-1eabea0fdf47_1600x880.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><div><hr></div><h2>Other Features That Set Kafka Apart</h2><h3>Data Retention</h3><p>A key motivation in Kafka\u2019s design was to add the ability to replay historical data and decouple data retention from clients. Alternative messaging systems would store messages as long as no client has consumed them, and once consumed, delete them.</p><p>Kafka flips this model - it offers a simple time-based SLA as the message retention policy. A message is automatically deleted if it has been retained in the broker longer than a certain period, typically 7 days. The fact that the Log data structure\u2019s O(1) performance doesn\u2019t degrade with a larger data size makes this feasible.</p><p>Through this model, Kafka offers the feature of <strong>replayability</strong> - the ability to reprocess old historical messages. That is extremely useful in cases where, for example, a consumer has had a dormant bug in it for a while and erroneously processed messages. When the bug is fixed, the correct logic can be rerun on the same messages.</p><h3>Tiered Storage</h3><p>Unfortunately, at scale, it becomes extremely tricky to manage so much historical data. A cluster with 1 GB/s of producer bandwidth would collect 1,772 TB worth of data across the cluster<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-11\\\" href=\\\"#footnote-11\\\" target=\\\"_self\\\">11</a>. Even spread across 100 brokers, it\u2019s still 17TB worth of data that each broker would have to host on its disk.</p><p>With so much state, <a href=\\\"https://blog.2minutestreaming.com/p/apache-kafka-kip-405-tiered-storage\\\">a lot of problems start piling up</a>:</p><ul><li><p>\u274C The system becomes inelastic. This happens because any action or incident requires a massive amount of data to be moved. That takes a long time.</p></li><li><p>\u274C Further, the way the cloud is priced - <a href=\\\"https://aiven.io/blog/16-ways-tiered-storage-makes-kafka-better#cost\\\">durably hosting data yourself</a> on&nbsp;<a href=\\\"https://getkafkanated.substack.com/p/how-to-size-your-kafka-tiered-storage-cluster\\\">HDDs tends to cost</a>&nbsp;<strong>10x more</strong> than storing it in S3.</p></li></ul><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!YwzE!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!YwzE!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!YwzE!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!YwzE!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!YwzE!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!YwzE!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png\\\" width=\\\"1456\\\" height=\\\"819\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:819,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:360794,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!YwzE!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!YwzE!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!YwzE!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!YwzE!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7b36d9ac-fff5-4881-81ab-3ce07b034a48_1456x819.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><p>The Kafka community found an ingenious way to solve <a href=\\\"https://aiven.io/blog/16-ways-tiered-storage-makes-kafka-better#1-simpler-operations\\\">all these problems</a> with one simple idea \u2192 outsource them to S3.</p><p>While it may sound overly simple or lazy, it is an <strong>extremely elegant solution</strong>. S3 is a <a href=\\\"https://bigdata.2minutestreaming.com/p/how-aws-s3-scales-with-tens-of-millions-of-hard-drives\\\">marvel of software engineering</a> - it is maintained by hundreds of bright Amazon engineers. It is most likely the largest scale storage system known to man.</p><p>Kafka uses a pluggable interface to store cold data in a secondary storage tier. All three cloud object stores <a href=\\\"https://github.com/Aiven-Open/tiered-storage-for-apache-kafka\\\">are supported</a> as the secondary tier, and you are free to extend it further.</p><p>In essence, the data path in modern Kafka looks like this:</p><ul><li><p><strong>Hotset Tier</strong>: Write a message to a Kafka broker, which gets replicated across the replicas in the cluster. The message is stored on disk across all three nodes.</p><ul><li><p>The message is asynchronously offloaded to S3 (the secondary cold tier)</p></li></ul></li><li><p><strong>Cold Tier</strong>: After a configurable amount of time (e.g., 12 hours), the message is deleted from the brokers. Its only source of truth is left in S3. It expires from S3 after a separate configurable period.</p></li></ul><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!pCb7!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!pCb7!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!pCb7!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!pCb7!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!pCb7!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!pCb7!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png\\\" width=\\\"1456\\\" height=\\\"819\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:819,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:481020,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!pCb7!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!pCb7!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!pCb7!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!pCb7!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F7864668e-90d6-4936-a644-be6e6ae63520_1456x819.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><p>You can still read the cold historical data from Kafka using the regular APIs. The only change is that the broker now fetches it from S3 instead of its own disk. </p><p>This results in slightly higher latencies when fetching historical data, but can be alleviated through caching. Latency for hot data can improve because it makes it cost-effective to deploy performant SSDs (instead of HDDs). Throughput remains the same very high number. Kafka as a system becomes much more elastic because it no longer needs to move massive amounts of data whenever new brokers are added or removed.</p><p>Storing large amounts of data in Kafka also ends up becoming more than 10x cheaper.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!nAHf!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!nAHf!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!nAHf!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!nAHf!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!nAHf!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!nAHf!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png\\\" width=\\\"1456\\\" height=\\\"819\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:819,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:1548192,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!nAHf!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 424w, https://substackcdn.com/image/fetch/$s_!nAHf!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 848w, https://substackcdn.com/image/fetch/$s_!nAHf!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 1272w, https://substackcdn.com/image/fetch/$s_!nAHf!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F64dbcef7-7855-4a77-bba2-79c9d59cc986_1456x819.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><h3>Consumer Groups &amp; Read Parallelization</h3><p>Recall that the log is read sequentially and in order:</p><ul><li><p>A topic is split into partitions because it\u2019s Big Data\u2122 - a single node shouldn\u2019t be able to consume the whole topic. You need many consumers to handle the high volume of topic data.</p></li><li><p><strong>Only one consumer</strong> is meant to read from a partition at a time. This is done to ensure message order without needing locks.</p></li><li><p>These consumers need to coordinate on how to split partitions between each other.</p></li><li><p>At the same time, Kafka\u2019s goal is to allow <strong>parallel</strong> consumption (multiple readers) of <strong>the same</strong> partition(s) for high read-fanout cases.</p></li></ul><p>Kafka addresses this through<strong> consumer</strong> <strong>groups</strong>. These groups are a set of consumer client instances (typically on separate nodes) that operate as one coherent unit. They distribute the work among themselves.</p><p>Each consumer group reads topics independently at its own pace. Consumers within the same group split the partitions between each other.</p><p>Consumer Groups support dynamic membership - you can scale consumption up or down by adding or removing members at runtime.</p><p>In essence, read throughput in Kafka can be scaled in two different ways:</p><ol><li><p>Add more <strong>consumers</strong> to your group</p><ul><li><p>e.g., your topic went from 10 MB/s to 20 MB/s of throughput, and your two existing consumers can\u2019t keep up. Add more so they take up the extra load.</p></li></ul></li><li><p>Add more consumer <strong>groups</strong></p><ul><li><p>e.g., your topic is being consumed, but you\u2019d like a new, separate application type to process the data too. For example, a nightly accounting job wants to catch up with the last day\u2019s worth of payments.</p></li></ul></li></ol><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!e37q!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!e37q!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!e37q!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!e37q!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!e37q!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!e37q!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png\\\" width=\\\"1456\\\" height=\\\"1001\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:566147,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!e37q!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!e37q!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!e37q!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!e37q!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F0eddea17-0b6e-40c9-ae07-a842b81817a9_1456x1001.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">Two different consumer groups reading the same Kafka topic. The \u201Cfraud detection\u201D group is expanding by adding a new consumer. A new \u201Caccounting\u201D consumer group consisting of two consumers is starting up too.</figcaption></figure></div><h3>The Consumer Group Membership Protocol</h3><p>Consumers within a group form a <em><strong>distributed processing system. </strong></em>Unsurprisingly, we hit more distributed systems\u2019 problems - how do we coordinate the consumers? They need to:</p><ul><li><p>Establish consensus on progress (up to what offset did they read to)</p></li><li><p>Handle liveness (did a consumer go offline, and how do we take over its work)</p></li><li><p>Handle dynamic membership (did a new consumer come online)</p></li><li><p>Distribute work between themselves (which consumer will take which partition)</p></li></ul><p>Kafka consumers within the same group don\u2019t talk to each other. They coordinate indirectly through a Kafka broker. The broker that leads a certain group is called the <strong>Group Coordinator</strong>.</p><p>Kafka again uses a <strong>centralized coordination model</strong> - the Group Coordinator makes the decisions. Consumers heartbeat to the coordinator and, through a pull-based model, inform themselves of what work they should do.</p><h4>The __consumer_offsets Topic</h4><p>The Group Coordinator also acts as the \u201Cdatabase\u201D which stores the progress of each consumer.</p><p>Consumer Groups store a simple mapping of <em><strong>`{partition, offset}</strong></em>` in a special Kafka topic called <em><strong>`__consumer_offsets`</strong></em>. This helps them save the progress on what record they have <em><strong>read up to.</strong></em></p><p>When a consumer reads messages, it commits the offset up to which it has processed the log via the coordinator broker. This regular checkpointing allows for smooth failovers. In the event of failure, the consumer can restart and resume from where it ended, or another consumer can come and pick the work back up.</p><p>The special offsets topic has many partitions spread throughout brokers. Each group is associated with a particular partition. The leader of the particular partition that the group is associated with acts as the Group Coordinator for that group. In that sense, every broker in the cluster can act as a coordinator for some consumer group. This prevents hot spots where one broker handles all the consumer groups in the cluster.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!fKBi!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!fKBi!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!fKBi!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!fKBi!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!fKBi!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!fKBi!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png\\\" width=\\\"1456\\\" height=\\\"1001\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/cfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:760599,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!fKBi!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!fKBi!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!fKBi!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!fKBi!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcfa1305a-7f3a-42a6-8779-552e351fbbef_1456x1001.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">Two different consumer groups reading the same Kafka topic</figcaption></figure></div><p>The consumer group protocol is a critical part of Kafka.</p><p>It is generic enough to support other use cases beyond consumer groups. It therefore provides<strong> a way for external distributed systems to establish leader election and durably persist state through Kafka</strong>.</p><p>Keep this in mind: the next three systems we\u2019ll discuss depend on the group protocol to work as distributed systems.</p><p>But first, a little about transactions:</p><h3>Transactions &amp; Exactly Once Processing</h3><p>I will try to keep this brief because it can get pretty complicated - Kafka supports <strong>transactions</strong>. But they aren\u2019t quite like database transactions - it\u2019s more about message visibility control.</p><p>A transaction in Kafka means that:</p><ul><li><p>A producer can send many messages. Those messages can go to different topics or partitions. They can also reach various brokers.</p></li><li><p>Those messages will <strong>atomically</strong> either be committed or aborted across all brokers.</p></li></ul><p>Technically, this happens <em>from the perspective</em> <em>of a consumer. </em>In other words, the messages are still written to the topics, but consumers can be configured to skip non-committed ones. This is client-side filtering at work.</p><p>Marking transactions as committed or aborted is achieved through a two-phase commit protocol. It again relies on a centralized coordination model. A Transaction Coordinator broker makes this work. It\u2019s pretty complex.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!h6st!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!h6st!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!h6st!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!h6st!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!h6st!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!h6st!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png\\\" width=\\\"1456\\\" height=\\\"1001\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/badb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:1017211,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!h6st!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!h6st!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!h6st!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!h6st!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fbadb53ae-4d07-4c02-821e-8e41856e9731_1456x1001.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">A producer writing messages to multiple topics and partitions in the same transaction. It manages and commits the transaction via the broker acting as the Transaction Coordinator</figcaption></figure></div><p>The important thing with transactions is that they enable message deduplication in common cases.</p><ul><li><p><strong>\u26A1\uFE0F Network/broker blips</strong>: if the network drops the broker response packets, or the broker restarts, the same producer client will idempotently<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-12\\\" href=\\\"#footnote-12\\\" target=\\\"_self\\\">12</a> write its message without creating duplicates.</p></li><li><p><strong>\uD83D\uDCA5 Producer client blips</strong>: if the producer itself restarts from a clean state, it will fetch its monotonically increasing ID and bump an epoch. This way, a potentially old zombie instance with the old epoch can\u2019t interfere with the transaction.</p></li></ul><p>This doesn\u2019t remove all cases of duplicates. Edge cases from external systems can still exist.<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-13\\\" href=\\\"#footnote-13\\\" target=\\\"_self\\\">13</a></p><p>However, when reads and writes only involve Kafka (and no other external system), exactly once processing is possible.\uD83D\uDCA1</p><p>This is actively supported and used in Kafka Streams, as we will cover shortly \uD83D\uDC47</p><div><hr></div><h3>Other Kafka Components</h3><p>The <a href=\\\"https://github.com/apache/kafka\\\">Apache Kafka GitHub project</a> consists of a few components, two of which we already covered:</p><ul><li><p><strong>Kafka Core</strong>: the brokers, controllers, and coordinators (back-end).</p></li><li><p><strong>Kafka Clients</strong>: the Kafka client libraries (producer, consumer).</p></li></ul><p>These are two more that we will focus on now:</p><ul><li><p><strong>Kafka Streams</strong></p></li><li><p><strong>Kafka Connect</strong></p></li></ul><h4>Kafka Streams</h4><p>A <em><strong>stream processor</strong></em> is an application that:</p><ul><li><p>continuously processes messages</p></li><li><p>works performantly and at scale</p></li><li><p>emits the results in real-time</p></li><li><p>supports complex stateful operations like windowed aggregations and joins of multiple streams of data<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-14\\\" href=\\\"#footnote-14\\\" target=\\\"_self\\\">14</a></p></li></ul><p><strong>Kafka Streams</strong> is a high-level <a href=\\\"https://github.com/apache/kafka/blob/trunk/streams/src/main/java/org/apache/kafka/streams/KafkaStreams.java\\\">client-side stream processing</a> Java library for Kafka. It offers rich higher-level stream processing APIs that basically do this:</p><ol><li><p>continuously read a stream of messages from a set of Kafka input topics</p></li><li><p>perform processing on these messages (map, filter, joins, sums, stateful window aggregations, etc.)</p></li><li><p>continuously write the results into an output topic</p></li></ol><p>Here is a simple pseudocode example of its declarative API:</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!uKgV!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!uKgV!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 424w, https://substackcdn.com/image/fetch/$s_!uKgV!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 848w, https://substackcdn.com/image/fetch/$s_!uKgV!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 1272w, https://substackcdn.com/image/fetch/$s_!uKgV!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!uKgV!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png\\\" width=\\\"1456\\\" height=\\\"779\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/b5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:779,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:558397,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!uKgV!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 424w, https://substackcdn.com/image/fetch/$s_!uKgV!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 848w, https://substackcdn.com/image/fetch/$s_!uKgV!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 1272w, https://substackcdn.com/image/fetch/$s_!uKgV!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fb5c3b7c8-9425-489d-a201-ec4d8a1c53ba_1999x1069.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><p>This code continuously counts the sum of human page views over the last minute and produces it in a new topic. Here is an example of what the Kafka topics would look like:</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!Ee47!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!Ee47!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!Ee47!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!Ee47!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!Ee47!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!Ee47!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png\\\" width=\\\"1456\\\" height=\\\"1001\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:652482,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!Ee47!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!Ee47!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!Ee47!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!Ee47!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F5cdaf677-5aca-4458-b1bb-8fb0d8d6d53f_1456x1001.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">An example of how the records in the source page view topic get processed into page traffic sums</figcaption></figure></div><p>This API is intended to be used within your own Java applications. It works like the consumer. It helps you scale by spreading the stream processing work over multiple applications (just like consumer groups do). One difference is that it also lets you spread the work through <strong>threads</strong>. It uses the same consumer group protocol underneath to coordinate work between instances.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!76zL!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!76zL!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!76zL!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!76zL!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!76zL!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!76zL!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png\\\" width=\\\"1456\\\" height=\\\"1001\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:637472,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!76zL!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!76zL!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!76zL!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!76zL!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F92b1f285-20ee-41d7-acd3-8c2757b7be56_1456x1001.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">An example two-node stream processing job</figcaption></figure></div><p>It is technically possible to achieve this with your own code using the simple producer/consumer libraries, but it\u2019d be a lot of work. Kafka Streams is a higher-level abstraction above both clients with a ton of extra processing, orchestration, and stateful logic on top. \uD83D\uDC4C</p><p>Kafka Streams only works with Kafka. It takes input from a Kafka topic and sends output to another Kafka topic. This setup allows Kafka Streams to guarantee exactly once processing by using Kafka Transactions. Practically speaking, this means that it can <em><strong>atomically</strong></em> process data.</p><p>For example, it could read a set of payment messages in a Kafka topic, calculate the sum, and persist the result in another Kafka topic, with a 100% guarantee that no message was lost or double-counted in the process.</p><blockquote><p>If interested in more, here is a quick introduction to <a href=\\\"https://bigdata.2minutestreaming.com/p/what-is-kafka-streams-api-guide\\\">Kafka Streams</a>.</p></blockquote><h4>Schema Registry</h4><p>Kafka does not support types (e.g., int64) nor schemas<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-15\\\" href=\\\"#footnote-15\\\" target=\\\"_self\\\">15</a>. Messages are just raw bytes<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-16\\\" href=\\\"#footnote-16\\\" target=\\\"_self\\\">16</a>. To process a message, like summing order payment values, you need to be able to parse the message structure and the exact value field. How is this achieved, then?</p><p>There\u2019s no \u201Cofficial\u201D way, because the open source Apache project does not support schemas. There is a common convention, though. That is to use an external HTTP service with a database that stores the schemas.</p><p>In practice, a Kafka topic acts as this database. It stores a simple pair of <em><strong>{schema, topic}</strong></em>. Kafka clients connect to the service, download the schema, and use it whenever they serialize/deserialize messages.</p><p>The first such registry was a <a href=\\\"https://github.com/confluentinc/schema-registry\\\">source-available project</a> by Confluent called Schema Registry. However, without official Apache support or a truly open-source license, the ecosystem has fragmented. There are many different service implementations<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-17\\\" href=\\\"#footnote-17\\\" target=\\\"_self\\\">17</a> today. Many Kafka users also opt to manage schemas in their own unconventional ways.</p><p>The way the end-to-end path conventionally works with schemas:</p><ol><li><p>Producers decide on a schema, associate it with a topic, and register it in the registry</p></li><li><p>Producers then serialize the message in the correct structure (including the unique schema ID in the message) and write it to Kafka</p></li><li><p>Consumers download the message, parse the schema ID, then fetch (and cache) the schema from the registry</p></li><li><p>Consumers use the schema to deserialize the message</p></li></ol><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!be6u!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!be6u!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!be6u!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!be6u!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!be6u!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!be6u!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png\\\" width=\\\"1456\\\" height=\\\"1001\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/e7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:517026,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!be6u!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!be6u!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!be6u!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!be6u!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fe7617c20-bf48-4c91-aa6c-031d19d21620_1456x1001.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><h4>Kafka Connect</h4><p>Kafka <a href=\\\"https://bigdatastream.substack.com/p/why-was-apache-kafka-created\\\">was created to solve LinkedIn\u2019s data integration problem</a>. It is meant to move data between different systems. This can be difficult because each system can have its own API, its own protocol (TCP, HTTP, JDBC, etc.), its own format (XML, JSON, Protobuf, Avro), and different compatibility guarantees.</p><p>Kafka Connect helps standardize this. Connect is both a framework (set of APIs) and a <strong>runtime</strong> for plugins that connect Kafka with external systems<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-18\\\" href=\\\"#footnote-18\\\" target=\\\"_self\\\">18</a>.</p><p>For the end user, it\u2019s a no-code/low-code framework to plumb popular systems to Kafka and back (think ElasticSearch, Snowflake, PostgreSQL, BigQuery).</p><p>This ensures a single, standardized way to integrate systems together. The tricky bits of code that guarantee fault-tolerance, ordering, and exactly-once processing are written once (in the form of plugins) and battle-tested.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!aKO3!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!aKO3!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!aKO3!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!aKO3!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!aKO3!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!aKO3!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png\\\" width=\\\"1456\\\" height=\\\"1001\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/d4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1001,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:552140,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/174189967?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!aKO3!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 424w, https://substackcdn.com/image/fetch/$s_!aKO3!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 848w, https://substackcdn.com/image/fetch/$s_!aKO3!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 1272w, https://substackcdn.com/image/fetch/$s_!aKO3!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd4d18c16-872c-4e57-af3f-9b5e409ad95a_1456x1001.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">An example of Kafka Connect integrating data into Kafka. Source Connectors read data from MongoDB and write to Kafka. Sink Connectors read data from Kafka and write it to Snowflake.</figcaption></figure></div><p>Connect has three main terms one should know about:</p><ul><li><p><strong>Connect Workers</strong>: the simple nodes that form a distributed Connect Cluster</p></li><li><p><strong>Connect Herder</strong>: a worker that acts as the manager of the cluster. It exposes a REST API with which users can check the status of tasks, start new ones, etc</p></li><li><p><strong>Connectors</strong>: the plugins (or libraries) that run on the workers. They contain the code needed to integrate with other systems</p><ul><li><p>A <strong>Source</strong> Connector reads data from an external system and writes it to Kafka (System-&gt;Kafka)</p></li><li><p>A <strong>Sink</strong> Connector reads data from Kafka and writes it to an external system (Kafka-&gt;System)</p></li></ul></li></ul><p>The end user spins up a cluster with several Worker nodes. They install the particular Connector plugin jars on these nodes. Then, they start the integration with a simple HTTP POST request.</p><p>This again forms another distributed processing system. The Herder leader election, general cluster membership, and the distribution of new tasks throughout the group of Workers are all done transparently via Kafka\u2019s Consumer Group protocol.</p><p>Essentially, Connect is a lot of plugin-specific integration logic on top of the regular KafkaProducer and KafkaConsumer APIs. <a href=\\\"https://www.confluent.io/hub/\\\">Hundreds of Connector plugins</a>&nbsp;exist, which give Kafka its incredibly rich integration capabilities.</p><blockquote><p><strong>\uD83D\uDCA1 </strong><em><strong>rich integration (8/8)</strong></em></p></blockquote><div><hr></div><h3>\uD83C\uDFAC Conclusion</h3><p>With that, we\u2019ve gone over all the important internals of Apache Kafka. I repeat the introductory sentence, which you can now hopefully understand much better:</p><blockquote><p>\uD83D\uDCA1 Kafka is an open-source, distributed, durable, very scalable, fault-tolerant pub/sub messaging system with rich integration and stream processing capabilities.</p></blockquote><p>It achieves this through many internal details, including but not limited to:</p><ul><li><p>The Producer &amp; Consumer libraries &amp; APIs</p></li><li><p>Topics, Partitions, and Replicas</p></li><li><p>Brokers and KRaft Controller Quorums</p></li><li><p>Idempotency, Transactions, and Exactly-Once Processing</p></li><li><p>Tiered Storage</p></li><li><p>Consumer Groups &amp; the Consumer Group Protocol</p></li><li><p>Kafka Streams</p></li><li><p>Kafka Connect</p></li><li><p>Schema Registry</p></li></ul><p>This is why Kafka is the Swiss army knife of data engineering.</p><p>It is a very active open-source project that is constantly evolving. A few notable features that are currently being worked on are:</p><ul><li><p><a href=\\\"https://blog.2minutestreaming.com/p/apache-kafka-share-group-queues-kip-932\\\">Queues</a>: the ability to read a partition with queue-like semantics. Queues have no ordering but allow for multiple consumers to read from the same log with per-record acknowledgement. This is different from Kafka\u2019s exclusive one-consumer-per-partition model. In that model, consumers read data in order and only know \u201CI\u2019ve read <strong>up until</strong> this message\u201D.</p></li><li><p><a href=\\\"https://blog.2minutestreaming.com/p/diskless-kafka-topics-kip-1150\\\">Diskless Topics</a>: the ability to host topic partitions in a leaderless way. This happens by leveraging object storage (S3) as the data layer instead of brokers\u2019 disks. This feature can cut cloud costs by <strong>90%</strong>+ (!), further boost scalability, and simplify managing Kafka.</p></li><li><p><a href=\\\"https://aiven.io/blog/iceberg-topics-for-apache-kafka-zero-etl-zero-copy\\\">Iceberg Topics</a>: the ability to store your Kafka data in an <a href=\\\"https://bigdata.2minutestreaming.com/p/meet-your-new-data-lakehouse-s3-iceberg\\\">open table format</a> (Iceberg) in a zero-copy way.</p></li></ul><p>Many alternative proprietary systems compete with Apache Kafka. The one common denominator is that they all use the same Kafka protocol and API. They just implement it differently. These include, but are not limited to, Confluent Kora, AWS MSK, RedPanda, WarpStream, BufStream, Aiven Inkless, AutoMQ, and more.</p><p>The space is incredibly rich and rapidly evolving. If you\u2019re further interested in the world of event streaming and Apache Kafka, make sure to stay in touch. \uD83D\uDE42</p><div><hr></div><p>\uD83D\uDC4B I'd like to thank <a href=\\\"http://linkedin.com/in/stanislavkozlovski\\\">Stanislav</a> for writing this newsletter!</p><ul><li><p>Also subscribe to his newsletters: <strong><a href=\\\"https://blog.2minutestreaming.com/\\\">2 Minute Streaming</a></strong> and <strong><a href=\\\"https://bigdata.2minutestreaming.com/\\\">Big Data Stream</a></strong>.</p></li></ul><p>It\u2019ll help you master Kafka quickly.</p><div><hr></div><p>Subscribe to get simplified case studies delivered straight to your inbox:</p><p class=\\\"button-wrapper\\\" data-attrs=\\\"{&quot;url&quot;:&quot;https://newsletter.systemdesign.one/subscribe?&quot;,&quot;text&quot;:&quot;Subscribe now&quot;,&quot;action&quot;:null,&quot;class&quot;:null}\\\" data-component-name=\\\"ButtonCreateButton\\\"><a class=\\\"button primary\\\" href=\\\"https://newsletter.systemdesign.one/subscribe?\\\"><span>Subscribe now</span></a></p><div><hr></div><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"https://www.linkedin.com/in/nk-systemdesign-one/\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!bEFk!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 424w, https://substackcdn.com/image/fetch/$s_!bEFk!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 848w, https://substackcdn.com/image/fetch/$s_!bEFk!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 1272w, https://substackcdn.com/image/fetch/$s_!bEFk!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!bEFk!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png\\\" width=\\\"152\\\" height=\\\"152\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:320,&quot;width&quot;:320,&quot;resizeWidth&quot;:152,&quot;bytes&quot;:74009,&quot;alt&quot;:&quot;Author Neo Kim; System design case studies&quot;,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:&quot;https://www.linkedin.com/in/nk-systemdesign-one/&quot;,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"Author Neo Kim; System design case studies\\\" title=\\\"Author Neo Kim; System design case studies\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!bEFk!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 424w, https://substackcdn.com/image/fetch/$s_!bEFk!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 848w, https://substackcdn.com/image/fetch/$s_!bEFk!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 1272w, https://substackcdn.com/image/fetch/$s_!bEFk!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F8f94ab8c-0d67-4775-992e-05e09ab710db_320x320.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a><figcaption class=\\\"image-caption\\\"><strong>\uD83D\uDC4B Find me on <a href=\\\"https://www.linkedin.com/in/nk-systemdesign-one/\\\">LinkedIn</a> | <a href=\\\"https://x.com/intent/follow?screen_name=systemdesignone\\\">Twitter</a> | <a href=\\\"https://www.threads.net/@systemdesignone\\\">Threads</a> | <a href=\\\"https://www.instagram.com/systemdesignone/\\\">Instagram</a></strong></figcaption></figure></div><div><hr></div><p><strong>Want to advertise in this newsletter? </strong>\uD83D\uDCF0</p><p>If your company wants to reach a 170K+ tech audience, <a href=\\\"https://newsletter.systemdesign.one/p/sponsorship\\\">advertise with me</a>.</p><div><hr></div><p>Thank you for supporting this newsletter.</p><p>You are now 170,001+ readers strong, very close to 171k. Let\u2019s try to get 171k readers by 28 September. Consider sharing this post with your friends and get rewards.</p><p>Y\u2019all are the best.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/$s_!6oWl!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!6oWl!,w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 424w, https://substackcdn.com/image/fetch/$s_!6oWl!,w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 848w, https://substackcdn.com/image/fetch/$s_!6oWl!,w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 1272w, https://substackcdn.com/image/fetch/$s_!6oWl!,w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/$s_!6oWl!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png\\\" width=\\\"590\\\" height=\\\"368.75\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://substack-post-media.s3.amazonaws.com/public/images/2e739087-a910-4643-be36-997b6dd5b4af_800x500.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:500,&quot;width&quot;:800,&quot;resizeWidth&quot;:590,&quot;bytes&quot;:87878,&quot;alt&quot;:&quot;system design newsletter&quot;,&quot;title&quot;:&quot;system design newsletter&quot;,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:&quot;https://newsletter.systemdesign.one/i/163380418?img=https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png&quot;,&quot;isProcessing&quot;:false,&quot;align&quot;:null,&quot;offset&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"system design newsletter\\\" title=\\\"system design newsletter\\\" srcset=\\\"https://substackcdn.com/image/fetch/$s_!6oWl!,w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 424w, https://substackcdn.com/image/fetch/$s_!6oWl!,w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 848w, https://substackcdn.com/image/fetch/$s_!6oWl!,w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 1272w, https://substackcdn.com/image/fetch/$s_!6oWl!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2e739087-a910-4643-be36-997b6dd5b4af_800x500.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-refresh-cw\\\"><path d=\\\"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8\\\"></path><path d=\\\"M21 3v5h-5\\\"></path><path d=\\\"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16\\\"></path><path d=\\\"M8 16H3v5\\\"></path></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2 lucide-maximize-2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a></figure></div><p class=\\\"button-wrapper\\\" data-attrs=\\\"{&quot;url&quot;:&quot;https://newsletter.systemdesign.one/p/how-kafka-works?utm_source=substack&utm_medium=email&utm_content=share&action=share&quot;,&quot;text&quot;:&quot;Share&quot;,&quot;action&quot;:null,&quot;class&quot;:null}\\\" data-component-name=\\\"ButtonCreateButton\\\"><a class=\\\"button primary\\\" href=\\\"https://newsletter.systemdesign.one/p/how-kafka-works?utm_source=substack&utm_medium=email&utm_content=share&action=share\\\"><span>Share</span></a></p><div><hr></div><p>Apache\u00AE, Apache Kafka\u00AE, Kafka, and the Kafka logo are either registered trademarks or trademarks of the Apache Software Foundation in the United States and/or other countries. No endorsement by The Apache Software Foundation is implied by the use of these marks.</p><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-1\\\" href=\\\"#footnote-anchor-1\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">1</a><div class=\\\"footnote-content\\\"><p>This adoption data is an estimation by Confluent, the company founded by the creators of Kafka. I have no good way to confirm it.</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-2\\\" href=\\\"#footnote-anchor-2\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">2</a><div class=\\\"footnote-content\\\"><p>That\u2019s why its official name is \u201CApache Kafka\u201D, although we still often say Kafka for short.</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-3\\\" href=\\\"#footnote-anchor-3\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">3</a><div class=\\\"footnote-content\\\"><p>A Streaming Platform means a system that allows you to store and process a large volume of streams of data. For example, a company like Uber has millions of drivers constantly streaming their GPS coordinates to Uber\u2019s backend systems. A streaming platform can scale this data and process it in real time as it comes. This helps Uber make use of the data (e.g, recompute the route, figure out where there is traffic, etc).</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-4\\\" href=\\\"#footnote-anchor-4\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">4</a><div class=\\\"footnote-content\\\"><p>A sequential read means reading bytes laid out contiguously on the physical drive. Random reads mean the opposite - you have to jump to different parts of the drive to read the bytes.</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-5\\\" href=\\\"#footnote-anchor-5\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">5</a><div class=\\\"footnote-content\\\"><p>Theoretically, you can do this by using very good high-end hardware with ample networking capacity. An example could be 75 brokers each accepting 512 MiB/s of writes. Modern SSDs can do this without a problem. Practically speaking, it would be very hard to operate and require custom code. Therefore most prefer to split such workloads into many clusters.</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-6\\\" href=\\\"#footnote-anchor-6\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">6</a><div class=\\\"footnote-content\\\"><p><strong>Durability</strong> refers to long-term data protection - ensuring that data never gets lost or corrupted.</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-7\\\" href=\\\"#footnote-anchor-7\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">7</a><div class=\\\"footnote-content\\\"><p><strong>Centralized coordination</strong> in distributed systems means all the nodes rely on a single authority, like a coordinator or a leader. This authority makes decisions, enforces rules, and keeps the state consistent. Alternative interesting models include things like quorums, gossip, and CRDTs.</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-8\\\" href=\\\"#footnote-anchor-8\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">8</a><div class=\\\"footnote-content\\\"><p><strong>Stream-table duality</strong> is the simple idea that a stream of events and a table are two sides of the same coin. Any mutation to a table (update/delete/insert) is in itself an event. The table simply represents the end state of all events. If you start from scratch and replay all the events, you reach the same table.<br><em><strong>Event-sourcing</strong></em>, on the other hand, is the design of a system around this log-based stream of events.<br>The ideas have their roots in <strong>materialized view theory</strong> in databases and in <strong>change data capture</strong>. (Some sources, if you\u2019re extra curious:<a href=\\\"https://medium.com/event-driven-utopia/the-duality-of-streams-and-tables-why-it-matters-ed9bb17e7505\\\"> stream-table duality</a> and <a href=\\\"https://martinfowler.com/eaaDev/EventSourcing.html\\\">event-sourcing</a>)</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-9\\\" href=\\\"#footnote-anchor-9\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">9</a><div class=\\\"footnote-content\\\"><p><strong>Liveness</strong> is a tricky distributed systems term that basically means that the system will eventually make progress (won\u2019t freeze up). In the context of broker liveness, it means that a dead broker will get fenced, so partitions don\u2019t get stuck on a dead node. This allows the cluster to move forward. Liveliness technically also means that an alive broker will eventually be unfenced.</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-10\\\" href=\\\"#footnote-anchor-10\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">10</a><div class=\\\"footnote-content\\\"><p><a href=\\\"https://github.com/redpanda-data/redpanda\\\">RedPanda</a> is a C++ rewrite of Kafka, purpose-built to offer ultra-low latencies. It is fully compatible with the Kafka protocol &amp; API. However, it takes some different design choices. For example, it uses a Raft quorum for each partition. It features a thread-per-core execution model based on the <a href=\\\"https://seastar.io/\\\">Seastar</a> library (similar to <a href=\\\"https://www.scylladb.com/\\\">Scylla</a>, the C++ <a href=\\\"https://cassandra.apache.org/_/index.html\\\">Cassandra</a> rewrite). It is also simpler because it directly ships with a schema registry and HTTP proxy.</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-11\\\" href=\\\"#footnote-anchor-11\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">11</a><div class=\\\"footnote-content\\\"><p>1 GiB/s * 60 (seconds) * 60 (minutes) * 24 (hours) * 7 (days) * 3 (replication) == 1,814,400 GiB == 1,771.875 TiB; Not to mention you want to run your disks with ample free space capacity (e.g., 50%) - you\u2019d need to provision ~3500TB worth of disks!</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-12\\\" href=\\\"#footnote-anchor-12\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">12</a><div class=\\\"footnote-content\\\"><p><strong>Idempotency</strong> means not repeating the same action twice. If a \u201CCreate User Bob\u201D request is sent twice, an idempotent system would create the user only once. In Kafka, this is achieved by associating a unique monotonically increasing ID with each message. So you could send the message (\u201CCreate-User-Bob, 1\u201D) twice, but Kafka will accept it only once because of the unique ID. This is not foolproof, though, because the unique ID comes from the Kafka Producer client. Two producers can therefore create the same message with different IDs.</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-13\\\" href=\\\"#footnote-anchor-13\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">13</a><div class=\\\"footnote-content\\\"><p>Most simply said, imagine you have an HTTP service receiving requests. The service processes the request \u201CCreate user Bob\u201D and successfully produces the message to Kafka. Before the service responds with an HTTP response to the user, it crashes. The user then retries the same HTTP request, and the new service produces the same \u201CCreate user Bob\u201D into Kafka. From Kafka\u2019s PoV, this is fine because it sees both as separate messages. The HTTP service evidently does not support handling idempotent requests and exactly-once processing.</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-14\\\" href=\\\"#footnote-anchor-14\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">14</a><div class=\\\"footnote-content\\\"><p><strong>Stream processing</strong> - the easiest way to understand it is through the opposite extreme - <strong>batch processing</strong>. Imagine you are Tesla and are collecting data from your fleet of cars. At the end of each business day, you run a big report. The report joins data from multiple sources and creates a dashboard that an executive in Tesla sees. They use it to see summaries like the number of kilometers crossed, times they had to charge the Tesla, how often X feature was used. It runs once a day and calculates data after a cut-off date (e.g., end of day). Stream Processing would be the opposite - it would have the cars continuously emit data like their tire pressure (psi). It would then perform windowed aggregations on this data to understand, in real time, what\u2019s happening to the car. If the tire pressure went from 45psi to 41psi over the course of 15 minutes, you\u2019d know <strong>the tire is losing pressure</strong>. If the tire pressure went from 45psi to 20psi over the course of <em><strong>10 seconds</strong></em>, you\u2019d know you <strong>blew out a tire</strong>. Tesla could implement this example by deploying a lot of Kafka Stream jobs in their back-end. (assuming the data exists in Kafka)</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-15\\\" href=\\\"#footnote-anchor-15\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">15</a><div class=\\\"footnote-content\\\"><p>A <em><strong>schema</strong></em> basically means the expected structure of your data. A database table has a very strict schema - you know what type each field is and what fields there are (e.g id BIGINT, name VARCHAR, cost DECIMAL, is_premium BOOLEAN). You can\u2019t add fields or types that don\u2019t match, like a string for an ID. A JSON object by itself is schemaless - you can modify it however you want and it\u2019s still a valid JSON object (the only question is whether your server will accept it, and that depends on the modification). In the same way, a blob of bytes doesn\u2019t have a strict structure - you can add any garbage in there. There is a project that adds a strict structure to JSON objects called <a href=\\\"https://json-schema.github.io/json-schema/example1.html\\\">JSON Schema</a>. Similarly, there are projects that add strict structure to blobs of bytes (<a href=\\\"https://protobuf.dev/\\\">Protobuf</a>, <a href=\\\"https://avro.apache.org/\\\">Avro</a>). It\u2019s important to have schemas because they are critical to validating and catching bugs in your data early.</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-16\\\" href=\\\"#footnote-anchor-16\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">16</a><div class=\\\"footnote-content\\\"><p>I believe this was a<a href=\\\"https://bigdata.2minutestreaming.com/i/170964904/schemaless-kafka\\\"> big mistake</a> by the project. Every important use case, like Connect, Streams, and general processing, must understand the data\u2019s structure.</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-17\\\" href=\\\"#footnote-anchor-17\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">17</a><div class=\\\"footnote-content\\\"><p>A few schema registry implementations are<a href=\\\"https://github.com/Aiven-Open/karapace\\\"> Karaspace</a> (Apache-licensed),<a href=\\\"https://docs.aws.amazon.com/glue/latest/dg/schema-registry-integrations.html\\\"> AWS Glue</a> (proprietary),<a href=\\\"https://github.com/Apicurio/apicurio-registry\\\"> ApiCurio</a> (Apache-licensed),<a href=\\\"https://buf.build/product/bsr\\\"> Buf Schema Registry</a> (proprietary),<a href=\\\"https://github.com/redpanda-data/redpanda\\\"> and Redpanda</a> (mixed licenses).</p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-18\\\" href=\\\"#footnote-anchor-18\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">18</a><div class=\\\"footnote-content\\\"><p>A <strong>runtime</strong> here means that you deploy the Connect software, and then, via `curl`, schedule extra pre-defined code to run on top of it (plugins). A <em><strong>framework</strong></em> means that you\u2019re free to write your own plugins that use the API if you\u2019d like.</p></div></div>\",\"truncated_body_text\":\"Get my system design playbook for FREE on newsletter signup:\",\"wordcount\":5403,\"postTags\":[],\"postCountryBlocks\":[],\"headlineTest\":null,\"coverImagePalette\":{\"Vibrant\":{\"rgb\":[124,218,84],\"population\":117},\"DarkVibrant\":{\"rgb\":[77,121,57],\"population\":31},\"LightVibrant\":{\"rgb\":[172,220,144],\"population\":12},\"Muted\":{\"rgb\":[140,137,135],\"population\":118},\"DarkMuted\":{\"rgb\":[61,82,51],\"population\":37},\"LightMuted\":{\"rgb\":[196,220,180],\"population\":4}},\"publishedBylines\":[{\"id\":135589200,\"name\":\"Neo Kim\",\"handle\":\"systemdesignone\",\"previous_name\":\"NK\",\"photo_url\":\"https://substack-post-media.s3.amazonaws.com/public/images/c103940f-0d8b-47e7-9a33-013202e17bb8_389x389.jpeg\",\"bio\":\"I Teach You System Design \u2022 400K+ Audience\",\"profile_set_up_at\":\"2023-03-21T17:36:12.205Z\",\"reader_installed_at\":\"2023-04-22T15:59:48.999Z\",\"publicationUsers\":[{\"id\":1479364,\"user_id\":135589200,\"publication_id\":1511845,\"role\":\"admin\",\"public\":true,\"is_primary\":true,\"publication\":{\"id\":1511845,\"name\":\"The System Design Newsletter\",\"subdomain\":\"systemdesignone\",\"custom_domain\":\"newsletter.systemdesign.one\",\"custom_domain_optional\":false,\"hero_text\":\"Download my system design playbook on newsletter signup for FREE\",\"logo_url\":\"https://substack-post-media.s3.amazonaws.com/public/images/c307af20-7930-4c70-9a4b-1e800617ef9e_256x256.png\",\"author_id\":135589200,\"primary_user_id\":135589200,\"theme_var_background_pop\":\"#FF0000\",\"created_at\":\"2023-03-21T17:36:42.769Z\",\"email_from_name\":\"Neo Kim\",\"copyright\":\"Neo Kim\",\"founding_plan_name\":\"Founding Member\",\"community_enabled\":true,\"invite_only\":false,\"payments_state\":\"enabled\",\"language\":null,\"explicit\":false,\"homepage_type\":\"newspaper\",\"is_personal_mode\":false}}],\"is_guest\":false,\"bestseller_tier\":100,\"status\":{\"bestsellerTier\":100,\"subscriberTier\":null,\"leaderboard\":null,\"vip\":false,\"badge\":{\"type\":\"bestseller\",\"tier\":100},\"paidPublicationIds\":[]}},{\"id\":1057029,\"name\":\"Stanislav Kozlovski\",\"handle\":\"stanislavkozlovski\",\"previous_name\":null,\"photo_url\":\"https://substackcdn.com/image/fetch/$s_!0lM5!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F03bc8810-0db9-40c9-a28b-1a4752b7a135_800x800.jpeg\",\"bio\":\"7yr experience with Kafka; committer; writes concisely about kafka and big data engineering\",\"profile_set_up_at\":\"2021-04-17T09:21:53.515Z\",\"reader_installed_at\":\"2024-04-19T11:47:31.716Z\",\"is_guest\":true,\"bestseller_tier\":null,\"status\":{\"bestsellerTier\":null,\"subscriberTier\":null,\"leaderboard\":null,\"vip\":false,\"badge\":null,\"paidPublicationIds\":[]},\"primaryPublicationId\":2762947,\"primaryPublicationName\":\"Stanislav\u2019s Big Data Stream\",\"primaryPublicationUrl\":\"https://bigdata.2minutestreaming.com\",\"primaryPublicationSubscribeUrl\":\"https://bigdata.2minutestreaming.com/subscribe?\"}],\"reaction\":null,\"reaction_count\":356,\"comment_count\":6,\"child_comment_count\":5,\"audio_items\":[{\"post_id\":174189967,\"voice_id\":\"en-US-AlloyTurboMultilingualNeural\",\"audio_url\":\"https://substack-video.s3.amazonaws.com/video_upload/post/174189967/tts/8e026e89-d8f5-4725-af23-846116b03cbb/en-US-AlloyTurboMultilingualNeural.mp3\",\"type\":\"tts\",\"status\":\"completed\"}],\"is_geoblocked\":false,\"hasCashtag\":false},\"comments\":[{\"id\":160124876,\"body\":\"This article is so comprehensive. One can find their way round kafka with this .\",\"body_json\":{\"type\":\"doc\",\"attrs\":{\"schemaVersion\":\"v1\"},\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"This article is so comprehensive. One can find their way round kafka with this .\"}]}]},\"publication_id\":1511845,\"post_id\":174189967,\"user_id\":99824971,\"ancestor_path\":\"\",\"type\":\"comment\",\"deleted\":false,\"date\":\"2025-09-26T13:29:40.770Z\",\"edited_at\":null,\"status\":\"published\",\"pinned_by_user_id\":null,\"restacks\":0,\"name\":\"Favour Lawrence\",\"photo_url\":\"https://substack-post-media.s3.amazonaws.com/public/images/fe4e7bbf-970f-43c4-82a5-f09694961251_720x1256.jpeg\",\"handle\":\"favxlaw\",\"reactor_names\":[\"Stanislav Kozlovski\",\"Neo Kim\"],\"reaction\":null,\"reactions\":{\"\u2764\":4},\"reaction_count\":4,\"children\":[],\"bans\":[],\"suppressed\":false,\"user_banned\":false,\"user_banned_for_comment\":false,\"user_slug\":\"favxlaw\",\"metadata\":{\"is_author\":false,\"membership_state\":\"free_signup\",\"eligibleForGift\":true,\"author_on_other_pub\":{\"name\":\"Favour Lawrence\",\"id\":4387353,\"base_url\":\"https://favxlaw.substack.com\"}},\"country_blocks\":[],\"user_bestseller_tier\":null,\"can_dm\":true,\"userStatus\":{\"bestsellerTier\":null,\"subscriberTier\":null,\"leaderboard\":null,\"vip\":false,\"badge\":null,\"paidPublicationIds\":[]},\"score\":9,\"children_count\":0,\"reported_by_user\":false,\"restacked\":false},{\"id\":160022994,\"body\":\"This article is awesome. Explaining every capabilities of the tool so that we can go deeper as needed. As a beginner in kafka, this is very helpful. Thanks!\",\"body_json\":{\"type\":\"doc\",\"attrs\":{\"schemaVersion\":\"v1\"},\"content\":[{\"type\":\"paragraph\",\"content\":[{\"type\":\"text\",\"text\":\"This article is awesome. Explaining every capabilities of the tool so that we can go deeper as needed. As a beginner in kafka, this is very helpful. Thanks!\"}]}]},\"publication_id\":1511845,\"post_id\":174189967,\"user_id\":327876431,\"ancestor_path\":\"\",\"type\":\"comment\",\"deleted\":false,\"date\":\"2025-09-26T03:33:00.972Z\",\"edited_at\":null,\"status\":\"published\",\"pinned_by_user_id\":null,\"restacks\":0,\"name\":\"Dinesh Solanki\",\"photo_url\":\"https://substack-post-media.s3.amazonaws.com/public/images/b5a7bfb7-c08f-4f05-bceb-5da669d7e823_96x96.png\",\"handle\":\"dinsoo\",\"reactor_names\":[\"Stanislav Kozlovski\",\"Neo Kim\"],\"reaction\":null,\"reactions\":{\"\u2764\":4},\"reaction_count\":4,\"children\":[],\"bans\":[],\"suppressed\":false,\"user_banned\":false,\"user_banned_for_comment\":false,\"user_slug\":\"dinsoo\",\"metadata\":{\"is_author\":false,\"membership_state\":\"free_signup\",\"eligibleForGift\":true},\"country_blocks\":[],\"user_bestseller_tier\":null,\"can_dm\":true,\"userStatus\":{\"bestsellerTier\":null,\"subscriberTier\":null,\"leaderboard\":null,\"vip\":false,\"badge\":null,\"paidPublicationIds\":[]},\"score\":9,\"children_count\":0,\"reported_by_user\":false,\"restacked\":false}],\"canonicalUrl\":\"https://newsletter.systemdesign.one/p/how-kafka-works\",\"inlineComments\":false,\"readerIsSearchCrawler\":false,\"ogUrl\":\"https://newsletter.systemdesign.one/p/how-kafka-works\",\"bannedFromNotes\":false,\"themeVariables\":{\"color_theme_bg_pop\":\"#538cfa\",\"background_pop\":\"#538cfa\",\"color_theme_bg_web\":\"#ffffff\",\"cover_bg_color\":\"#ffffff\",\"background_pop_darken\":\"#3a7bf9\",\"print_on_pop\":\"#ffffff\",\"color_theme_bg_pop_darken\":\"#3a7bf9\",\"color_theme_print_on_pop\":\"#ffffff\",\"color_theme_bg_pop_20\":\"rgba(83, 140, 250, 0.2)\",\"color_theme_bg_pop_30\":\"rgba(83, 140, 250, 0.3)\",\"border_subtle\":\"rgba(204, 204, 204, 0.5)\",\"background_subtle\":\"rgba(229, 238, 254, 0.4)\",\"print_pop\":\"#538cfa\",\"color_theme_accent\":\"#538cfa\",\"cover_print_primary\":\"#363737\",\"cover_print_secondary\":\"#757575\",\"cover_print_tertiary\":\"#b6b6b6\",\"cover_border_color\":\"#538cfa\",\"font_family_headings_preset\":\"'Roboto Slab',sans-serif\",\"font_weight_headings_preset\":700,\"font_family_body_preset\":\"'SF Pro Display', -apple-system, system-ui, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'\",\"font_weight_body_preset\":400,\"font_preset_heading\":\"slab\",\"font_preset_body\":\"sans\",\"home_hero\":\"newspaper\",\"home_posts\":\"custom\",\"home_show_top_posts\":true,\"web_bg_color\":\"#ffffff\",\"background_contrast_1\":\"#f0f0f0\",\"color_theme_bg_contrast_1\":\"#f0f0f0\",\"background_contrast_2\":\"#dddddd\",\"color_theme_bg_contrast_2\":\"#dddddd\",\"background_contrast_3\":\"#b7b7b7\",\"color_theme_bg_contrast_3\":\"#b7b7b7\",\"background_contrast_4\":\"#929292\",\"color_theme_bg_contrast_4\":\"#929292\",\"background_contrast_5\":\"#515151\",\"color_theme_bg_contrast_5\":\"#515151\",\"color_theme_bg_elevated\":\"#ffffff\",\"color_theme_bg_elevated_secondary\":\"#f0f0f0\",\"color_theme_detail\":\"#e6e6e6\",\"background_contrast_pop\":\"rgba(83, 140, 250, 0.4)\",\"color_theme_bg_contrast_pop\":\"rgba(83, 140, 250, 0.4)\",\"input_background\":\"#ffffff\",\"cover_input_background\":\"#ffffff\",\"tooltip_background\":\"#191919\",\"web_bg_color_h\":\"0\",\"web_bg_color_s\":\"0%\",\"web_bg_color_l\":\"100%\",\"print_on_web_bg_color\":\"#363737\",\"print_secondary_on_web_bg_color\":\"#868787\",\"selected_comment_background_color\":\"#fdf9f3\",\"background_pop_rgb\":\"83, 140, 250\",\"background_pop_rgb_pc\":\"83 140 250\",\"color_theme_bg_pop_rgb\":\"83, 140, 250\",\"color_theme_bg_pop_rgb_pc\":\"83 140 250\",\"color_theme_accent_rgb\":\"83, 140, 250\",\"color_theme_accent_rgb_pc\":\"83 140 250\"},\"recentEpisodes\":null,\"trackFrontendVisit\":true,\"activeLiveStream\":null,\"freeTrialCoupon\":null,\"isChatActive\":false,\"isMeetingsActive\":false,\"hasViralGiftsCount\":0,\"features\":{},\"browser\":{},\"showCookieBanner\":false,\"disabledCookies\":[],\"dd_env\":\"prod\",\"dd_ti\":true}")</script>
        <script>window._analyticsConfig = JSON.parse("{\"properties\":{\"subdomain\":\"systemdesignone\",\"publication_id\":1511845,\"has_plans\":true,\"pub_community_enabled\":true,\"is_personal_publication\":false,\"is_subscribed\":false,\"is_free_subscribed\":false,\"is_author\":false,\"is_contributor\":false,\"is_admin\":false,\"is_founding\":false},\"adwordsAccountId\":\"AW-316245675\",\"adwordsEventSendTo\":\"Tf76CKqcyL4DEKuN5pYB\"}")</script>

        
        
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/4314.3ac7b691.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/2196.7affb6d3.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/9679.4d6eca85.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/8117.8222379f.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/main.63a5b328.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/2098.c4089ca0.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/5923.7e5f284f.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/3636.b8f6b143.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/386.8a747b23.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/5714.d46583cc.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/4179.237f929f.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/3734.455401c0.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/8018.16d8c76a.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/2816.a5f42fc9.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/3424.dc78dd22.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/9282.d10d8501.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/4932.8b46ba8e.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/8268.b9d95bf8.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/6722.2f22f77c.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/9233.532408ae.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7337.d4eca00f.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/8528.355c23cb.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/2839.37a46d5a.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/565.a55f1176.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/550.5ab4c770.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/5924.78fb1361.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/2035.58660d40.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/2889.4f7789f0.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/1697.16cf9de0.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/8721.aeb9df13.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/1354.47971ce3.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7342.74bfd802.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7656.0ba77bda.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7065.18c0dbcf.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/546.1e81f03f.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/6042.8ebed607.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7648.57104179.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/5759.13d040a1.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/4405.88ee6abc.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/3237.227e28bb.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/6924.c04f272b.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/4303.1fa8081a.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/2656.f8e6097a.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7015.287eb515.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7408.1cd7a553.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/5479.29c5a9f7.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7299.274e09c6.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/1620.4b486ee1.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/2044.3b1b03b0.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/3331.b4fb035e.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/1421.b9a6841c.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/5581.757e4a2f.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/6388.d8df4093.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/2937.33e9832b.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/6029.ec4e116d.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/4238.6588dd3b.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/3844.10bbf0e3.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/1709.15d99411.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/6100.07c8fc61.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/9593.3352c8e2.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/2888.56da7d5e.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/5817.10006df2.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7833.6ef47e13.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7613.bec17ee2.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7758.67c9b219.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7232.212a3a70.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/4466.02aabe48.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/4121.68f2aaae.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/8336.14ca7cd8.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/5813.0de698b5.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7696.56ca6acc.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7698.4d8349c5.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/4903.bd262ac4.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/9669.41147939.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/4937.81dd1a92.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/1003.c9dce3df.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7466.29db253c.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/6855.9e001a1a.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/2274.3378dabc.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/7895.090d7136.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/4043.991803a8.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/6930.dc2717fb.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/6247.078b07a1.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/6158.047a240e.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/1262.ffddcea8.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/5340.515ae490.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/1076.9c770ccd.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/6296.73a3cfd3.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/8538.1c0b7289.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/9075.7cdba9bc.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/5399.afeec607.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/5133.eb31ad4f.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/8383.773215a9.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/2909.97509e9d.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/9236.73119887.js" charset="utf-8"></script>
            
                <script defer type="module" src="https://substackcdn.com/bundle/static/js/837.a8effddd.js" charset="utf-8"></script>
            
        
        <script nomodule>
            (function() {
                var message = 'Your browser does not support modern JavaScript modules. Please upgrade your browser for the best experience.';
                var warningDiv = document.createElement('div');
                warningDiv.style.color = 'red';
                warningDiv.style.padding = '10px';
                warningDiv.style.margin = '10px 0';
                warningDiv.style.border = '1px solid red';
                warningDiv.style.backgroundColor = 'lightyellow';
                warningDiv.innerText = message;
                document.body.prepend(warningDiv);
            })();
        </script>

        
            <!-- Datadog Analytics -->
            <script>
              (function(h,o,u,n,d) {
                h=h[d]=h[d]||{q:[],onReady:function(c){h.q.push(c)}}
                d=o.createElement(u);d.async=1;d.src=n
                n=o.getElementsByTagName(u)[0];n.parentNode.insertBefore(d,n)
              })(window,document,'script','https://www.datadoghq-browser-agent.com/us1/v5/datadog-rum.js','DD_RUM')
              window.DD_RUM.onReady(function() {
                window.DD_RUM.init({
                  clientToken: 'puba71073f072643721169b68f352438710',
                  applicationId: '2e321b35-c76b-4073-8d04-cc9a10461793',
                  site: 'datadoghq.com',
                  service: 'substack-web',
                  env: window._preloads.dd_env,
                  version: '6f63582e3fc3e20f0ce089b40c44e5c5f86930ab',
                  sessionSampleRate: 1,
                  sessionReplaySampleRate: 100,
                  trackUserInteractions: window._preloads.dd_ti,
                  trackResources: true,
                  trackLongTasks: true,
                  defaultPrivacyLevel: 'mask-user-input',
                  allowedTracingUrls: [/https?:\/\/(.+\/.)?substack(cdn)?\.com/]
                });
              })
            </script>
            <!-- End Datadog Analytics -->

            <!-- Cloudflare Web Analytics -->
            <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "216309cffb464db4b0e02daf0b8e8060"}'></script>
            <!-- End Cloudflare Web Analytics -->
        

        <!-- Fallback tracking pixels -->
        

        

        <noscript>
    <style>
        #nojs-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            padding: 16px 16px 16px 32px;
            width: 100%;
            box-sizing: border-box;
            background: red;
            color: white;
            font-family: -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            font-size: 13px;
            line-height: 13px;
        }
        #nojs-banner a {
            color: inherit;
            text-decoration: underline;
        }
    </style>

    <div id="nojs-banner">
        This site requires JavaScript to run correctly. Please <a href="https://enable-javascript.com/" target="_blank">turn on JavaScript</a> or unblock scripts
    </div>
</noscript>


        

        

        
        
    </body>
</html>
